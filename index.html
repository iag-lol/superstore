<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Bodega</title>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!-- ApexCharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.40.0/apexcharts.min.js"></script>
    <style>
        /* Colores principales */
        :root {
            --primary-color: #4f46e5;
            --primary-color-light: #818cf8;
            --primary-color-dark: #3730a3;
            --secondary-color: #06b6d4;
            --accent-color: #f97316;

            /* Colores de estado */
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;

            /* Colores neutros */
            --light-color: #f9fafb;
            --dark-color: #111827;
            --surface-color: #ffffff;
            --background-color: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;

            /* RGB para transparencias */
            --primary-rgb: 79, 70, 229;
            --secondary-rgb: 6, 182, 212;
            --success-rgb: 16, 185, 129;
            --warning-rgb: 245, 158, 11;
            --danger-rgb: 239, 68, 68;

            /* Sombras y bordes */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --border-radius-sm: 0.375rem;
            --border-radius: 0.5rem;
            --border-radius-md: 0.75rem;
            --border-radius-lg: 1rem;
            --border-radius-full: 9999px;

            /* Transiciones */
            --transition-fast: all 0.2s ease;
            --transition: all 0.3s ease;
            --transition-slow: all 0.5s ease;

            /* Tipografía */
            --font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        /* Configuración base */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        /* Tema oscuro */
        body.dark-theme {
            --background-color: #0f172a;
            --surface-color: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --primary-color-light: #6366f1;
        }


/* Enhanced Responsive CSS for Warehouse Management System */

/* Base layout adjustments with high specificity */
html body .layout {
    width: 100%;
    overflow-x: hidden;
    position: relative;
}

html body .main-content {
    width: 100%;
    transition: all 0.3s ease;
}

/* ===================== MOBILE DEVICES (< 768px) ===================== */
@media (max-width: 767px) {
    /* Main layout structure */
    html body .layout {
        flex-direction: column-reverse;
        height: 100vh;
        padding-bottom: 70px; /* Space for bottom navigation */
    }
    
    /* Transform sidebar into bottom navigation */
    html body .sidebar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        top: auto;
        width: 100%;
        height: 70px;
        flex-direction: row;
        justify-content: space-between;
        padding: 0.5rem;
        z-index: 1000;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        overflow-x: auto;
        overflow-y: hidden;
    }
    
    /* Hide non-essential elements */
    html body .sidebar .logo,
    html body .sidebar .sidebar-section-title,
    html body .sidebar .toggle-sidebar {
        display: none !important;
    }
    
    /* Reset sidebar sections for mobile */
    html body .sidebar .sidebar-section {
        display: flex;
        margin: 0;
        height: 100%;
    }
    
    /* KEY CHANGE: Show only important navigation items */
    html body .sidebar .sidebar-item {
        display: none !important; /* Hide all by default */
    }
    
    /* Explicitly show only the six important navigation items */
    html body .sidebar .sidebar-item[data-section="dashboard"],
    html body .sidebar .sidebar-item[data-section="inventory"],
    html body .sidebar .sidebar-item[data-section="transactions"],
    html body .sidebar .sidebar-item[data-section="staff"],
    html body .sidebar .sidebar-item[data-section="loans"],
    html body .sidebar .sidebar-item[data-section="alerts"] {
        display: flex !important; /* Force display for important items */
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 0;
        padding: 0.5rem 0.25rem;
        height: 100%;
        width: 16.66%; /* Evenly distribute the 6 items */
        min-width: 60px;
        border-radius: 0;
    }
    
    /* Style navigation items */
    html body .sidebar .sidebar-item-icon {
        margin: 0;
        font-size: 1.2rem;
    }
    
    html body .sidebar .sidebar-item-text {
        font-size: 0.65rem;
        margin-top: 0.25rem;
        text-align: center;
        white-space: nowrap;
    }
    
    /* Content area adjustments */
    html body .main-content {
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding: 0.75rem;
    }
    
    /* Header adjustments */
    html body .header {
        padding: 0.75rem 0;
        margin-bottom: 1rem;
    }
    
    html body .page-title {
        font-size: 1.25rem;
    }
    
    /* Responsive tables */
    html body .table-container {
        overflow-x: auto;
    }
    
    html body table {
        min-width: 100%;
    }
    
    html body th,
    html body td {
        padding: 0.5rem 0.25rem;
        font-size: 0.8rem;
    }
    
    /* Grid components */
    html body .stats-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
    
    html body .inventory-analysis {
        grid-template-columns: 1fr;
    }
    
    /* Form components */
    html body .form-grid {
        grid-template-columns: 1fr;
    }
    
    /* Notification badge positioning */
    html body .sidebar .notification-badge {
        position: absolute;
        top: 5px;
        right: 5px;
        min-width: 18px;
        height: 18px;
        font-size: 0.65rem;
    }
}

/* ===================== TABLETS (768px - 1023px) ===================== */
@media (min-width: 768px) and (max-width: 1023px) {
    /* Sidebar in mini mode */
    html body .sidebar {
        width: 70px;
    }
    
    html body .sidebar-item-text,
    html body .logo-text,
    html body .sidebar-section-title {
        display: none;
    }
    
    html body .sidebar-item {
        justify-content: center;
        padding: 0.75rem;
    }
    
    /* Main content */
    html body .main-content {
        margin-left: 70px;
        padding: 1.5rem;
    }
    
    /* Adjusting grids */
    html body .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* ===================== COMPONENT-SPECIFIC ADJUSTMENTS ===================== */

/* Improved table responsiveness */
@media (max-width: 767px) {
    /* Action buttons in tables */
    html body .table-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
    }
    
    html body .table-actions .btn {
        padding: 0.5rem;
        margin: 0;
    }
    
    /* Modal adjustments */
    html body .modal {
        width: 95%;
        max-width: 400px;
        max-height: 85vh;
    }
    
    /* Improved touch targets */
    html body .btn {
        min-height: 44px;
        min-width: 44px;
    }
    
    html body input[type="text"],
    html body input[type="number"],
    html body input[type="email"],
    html body input[type="password"],
    html body input[type="date"],
    html body input[type="datetime-local"],
    html body select,
    html body textarea {
        height: 44px;
        font-size: 16px; /* Prevents zoom on iOS */
    }
}

/* Dark theme adjustments */
@media (max-width: 767px) {
    html body.dark-theme .sidebar {
        background-color: var(--surface-color);
    }
}

        

        /* Layout principal */
        .layout {
            display: flex;
            min-height: 100vh;
        }

        /* Barra lateral */
        .sidebar {
            width: 260px;
            background-color: var(--surface-color);
            border-right: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            z-index: 40;
            transition: var(--transition);
            box-shadow: var(--shadow);
            overflow-y: auto;
        }

        .sidebar.collapsed {
            width: 70px;
            padding: 1.5rem 0.75rem;
        }

        .sidebar.collapsed .sidebar-item-text,
        .sidebar.collapsed .logo-text {
            display: none;
        }

        .sidebar.collapsed .sidebar-item {
            justify-content: center;
            padding: 0.75rem;
        }

        .logo {
            display: flex;
            align-items: center;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 2rem;
            gap: 0.75rem;
        }

        .logo i {
            font-size: 1.5rem;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-section-title {
            text-transform: uppercase;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            letter-spacing: 0.05em;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            margin-bottom: 0.25rem;
            transition: var(--transition-fast);
            cursor: pointer;
            gap: 0.75rem;
        }

        .sidebar-item:hover {
            background-color: rgba(var(--primary-rgb), 0.05);
            color: var(--primary-color);
        }

        .sidebar-item.active {
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary-color);
            font-weight: 500;
        }

        .sidebar-item-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 1.5rem;
            height: 1.5rem;
            font-size: 1.2rem;
        }

        .notification-badge {
            background-color: var(--danger-color);
            color: white;
            font-size: 0.75rem;
            min-width: 1.25rem;
            height: 1.25rem;
            border-radius: var(--border-radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 0.25rem;
            margin-left: auto;
        }

        /* Contenido principal */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 2rem;
            transition: var(--transition);
        }

        .main-content.expanded {
            margin-left: 70px;
        }

        /* Cabecera */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: var(--border-radius);
            transition: var(--transition-fast);
        }

        .user-profile:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius-full);
            object-fit: cover;
            border: 2px solid var(--primary-color-light);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Botones */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1.25rem;
            font-weight: 500;
            border-radius: var(--border-radius);
            transition: var(--transition-fast);
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            gap: 0.5rem;
            height: 38px;
        }

        .btn-icon {
            padding: 0.5rem;
            width: 38px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-color-dark);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #0891b2;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #059669;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #d97706;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-light {
            background-color: var(--light-color);
            color: var(--text-primary);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .btn-light:hover {
            background-color: #e5e7eb;
        }

        .btn-outline-primary {
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            background-color: transparent;
        }

        .btn-outline-primary:hover {
            background-color: rgba(var(--primary-rgb), 0.05);
        }

        /* Tarjetas */
        .card {
            background-color: var(--surface-color);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
            margin-bottom: 1.5rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title i {
            font-size: 1.25rem;
            color: var(--primary-color);
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Grid para dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background-color: var(--surface-color);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-card.primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-color-dark));
            color: white;
        }

        .stat-card.success {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
        }

        .stat-card.warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: white;
        }

        .stat-card.danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
        }

        .stat-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.2);
            font-size: 1.5rem;
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .stat-card:not(.primary):not(.success):not(.warning):not(.danger) .stat-label {
            color: var(--text-secondary);
        }

        .stat-trend {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .trend-up {
            color: var(--success-color);
        }

        .trend-down {
            color: var(--danger-color);
        }

        .stat-card.primary .stat-trend,
        .stat-card.success .stat-trend,
        .stat-card.warning .stat-trend,
        .stat-card.danger .stat-trend {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Gráficos */
        .chart-container {
            height: 300px;
            width: 100%;
        }

        .inventory-analysis {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1024px) {
            .inventory-analysis {
                grid-template-columns: 1fr;
            }
        }

        /* Tablas */
        .table-container {
            overflow-x: auto;
            border-radius: var(--border-radius);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        thead {
            background-color: rgba(var(--primary-rgb), 0.05);
        }

        th {
            text-align: left;
            padding: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            white-space: nowrap;
        }

        td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            color: var(--text-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background-color: rgba(var(--primary-rgb), 0.02);
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: var(--border-radius-full);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-primary {
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary-color);
        }

        .badge-success {
            background-color: rgba(var(--success-rgb), 0.1);
            color: var(--success-color);
        }

        .badge-warning {
            background-color: rgba(var(--warning-rgb), 0.1);
            color: var(--warning-color);
        }

        .badge-danger {
            background-color: rgba(var(--danger-rgb), 0.1);
            color: var(--danger-color);
        }

        /* Formularios */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 0.625rem 0.875rem;
            font-size: 0.875rem;
            border-radius: var(--border-radius);
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: var(--surface-color);
            color: var(--text-primary);
            transition: var(--transition-fast);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
        }

        .form-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.25rem;
        }

        /* Barra de búsqueda */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-input {
            padding-left: 2.5rem;
            background-color: var(--surface-color);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            height: 40px;
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1rem;
            pointer-events: none;
        }

        /* Filtros */
        .filter-bar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter {
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-full);
            font-size: 0.875rem;
            background-color: var(--surface-color);
            border: 1px solid rgba(0, 0, 0, 0.05);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .filter:hover {
            border-color: rgba(var(--primary-rgb), 0.5);
            color: var(--primary-color);
        }

        .filter.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Paginación */
        .pagination {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .page-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .page-item:hover {
            background-color: rgba(var(--primary-rgb), 0.05);
            color: var(--primary-color);
        }

        .page-item.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Modales */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            width: 100%;
            max-width: 500px;
            background-color: var(--surface-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: all 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-backdrop.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius);
            transition: var(--transition-fast);
        }

        .close-modal:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--danger-color);
        }

        /* Notificaciones */
        .notification-container {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-width: 350px;
        }

        .notification {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 1rem;
            animation: slideInRight 0.3s ease-out forwards;
            border-left: 4px solid var(--primary-color);
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            position: relative;
        }

        @keyframes slideInRight {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }

            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        .notification.danger {
            border-left-color: var(--danger-color);
        }

        .notification-icon {
            font-size: 1.25rem;
            color: var(--primary-color);
        }

        .notification.success .notification-icon {
            color: var(--success-color);
        }

        .notification.warning .notification-icon {
            color: var(--warning-color);
        }

        .notification.danger .notification-icon {
            color: var(--danger-color);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .notification-message {
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        .close-notification {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: none;
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: var(--transition-fast);
        }

        .close-notification:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--danger-color);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
                padding: 1.5rem 0.75rem;
            }

            .sidebar-item-text,
            .logo-text,
            .sidebar-section-title {
                display: none;
            }

            .sidebar-item {
                justify-content: center;
                padding: 0.75rem;
            }

            .main-content {
                margin-left: 70px;
            }

            .main-content.expanded {
                margin-left: 0;
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        @media (max-width: 768px) {

            .main-content,
            .main-content.expanded {
                padding: 1.5rem 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .user-info {
                display: none;
            }
        }

        /* Loader */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .loader-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loader {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(var(--primary-rgb), 0.1);
            border-top-color: var(--primary-color);
            animation: loader-spin 1s infinite linear;
        }

        @keyframes loader-spin {
            100% {
                transform: rotate(360deg);
            }
        }

        /* Estilos adicionales */
        .low-stock {
            color: var(--danger-color) !important;
            font-weight: 500;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .activity-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .activity-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius);
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary-color);
            font-size: 1rem;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .activity-time {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .activity-user {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            gap: 0.25rem;
        }

        .tab {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition-fast);
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--primary-color);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Alertas */
        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .alert-icon {
            font-size: 1.25rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .alert-primary {
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary-color);
        }

        .alert-success {
            background-color: rgba(var(--success-rgb), 0.1);
            color: var(--success-color);
        }

        .alert-warning {
            background-color: rgba(var(--warning-rgb), 0.1);
            color: var(--warning-color);
        }

        .alert-danger {
            background-color: rgba(var(--danger-rgb), 0.1);
            color: var(--danger-color);
        }

        /* Secciones ocultas */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Botón de colapsar sidebar */
        .toggle-sidebar {
            position: fixed;
            bottom: 1.5rem;
            left: 0.75rem;
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 50;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .toggle-sidebar:hover {
            background-color: var(--primary-color-dark);
        }

        /* Switch para tema oscuro */
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 24px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .theme-switch-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.theme-switch-slider {
            background-color: var(--primary-color);
        }

        input:checked+.theme-switch-slider:before {
            transform: translateX(22px);
        }

        /* Animaciones */
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Elementos adicionales para el dashboard */
        .info-card {
            background-color: rgba(var(--primary-rgb), 0.05);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .info-card-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-card-content {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Progressbar */
        .progress {
            height: 8px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: var(--border-radius-full);
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: var(--border-radius-full);
        }

        .progress-bar.success {
            background-color: var(--success-color);
        }

        .progress-bar.warning {
            background-color: var(--warning-color);
        }

        .progress-bar.danger {
            background-color: var(--danger-color);
        }
    </style>
</head>

<body>
    <!-- Loader -->
    <div class="loader-overlay" id="loader">
        <div class="loader"></div>
    </div>

    <!-- Contenedor de Notificaciones -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="layout">
        <!-- Barra Lateral -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <i class="fas fa-warehouse"></i>
                <span class="logo-text">SistemaBodega</span>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">General</div>
                <div class="sidebar-item active" data-section="dashboard">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <span class="sidebar-item-text">Dashboard</span>
                </div>
                <div class="sidebar-item" data-section="inventory">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-boxes-stacked"></i>
                    </div>
                    <span class="sidebar-item-text">Inventario</span>
                </div>
                <div class="sidebar-item" data-section="transactions">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <span class="sidebar-item-text">Transacciones</span>
                </div>
                <div class="sidebar-item" data-section="staff">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <span class="sidebar-item-text">Personal</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Gestión</div>
                <div class="sidebar-item" data-section="loans">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <span class="sidebar-item-text">Préstamos</span>
                </div>
                <div class="sidebar-item" data-section="alerts">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <span class="sidebar-item-text">Alertas</span>
                    <div class="notification-badge" id="alertsCount">0</div>
                </div>
                <div class="sidebar-item" data-section="reports">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <span class="sidebar-item-text">Reportes</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Configuración</div>
                <div class="sidebar-item" data-section="settings">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <span class="sidebar-item-text">Configuración</span>
                </div>
                <div class="sidebar-item" data-section="profile">
                    <div class="sidebar-item-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="sidebar-item-text">Perfil</span>
                </div>
            </div>

            <div class="toggle-sidebar" id="toggleSidebar">
                <i class="fas fa-chevron-left" id="toggleIcon"></i>
            </div>
        </div>

        <!-- Contenido Principal -->
        <div class="main-content" id="mainContent">
            <!-- Cabecera -->
            <div class="header">
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                <div class="header-actions">
                    <label class="theme-switch">
                        <input type="checkbox" id="themeSwitch">
                        <span class="theme-switch-slider"></span>
                    </label>
                    <div class="user-profile">
                        <img src="https://ui-avatars.com/api/?name=Admin&background=4f46e5&color=fff" alt="Usuario"
                            class="user-avatar">
                        <div class="user-info">
                            <div class="user-name">Administrador</div>
                            <div class="user-role">Super Admin</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección de Dashboard -->
            <section id="dashboard-section" class="section active">
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-boxes-stacked"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalItemsValue">0</div>
                            <div class="stat-label">Artículos en Inventario</div>
                        </div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i> 12%
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalTransactionsValue">0</div>
                            <div class="stat-label">Transacciones del Mes</div>
                        </div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i> 8%
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="activeLoansValue">0</div>
                            <div class="stat-label">Préstamos Activos</div>
                        </div>
                        <div class="stat-trend trend-down">
                            <i class="fas fa-arrow-down"></i> 3%
                        </div>
                    </div>
                    <div class="stat-card danger animate-pulse">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="lowStockItemsValue">0</div>
                            <div class="stat-label">Artículos con Stock Bajo</div>
                        </div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i> 5%
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-area"></i>
                            Movimiento de Inventario
                        </h2>
                        <div class="card-actions">
                            <button class="btn btn-outline-primary btn-icon" id="refreshInventoryChart"
                                title="Actualizar datos">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn btn-light btn-icon" id="downloadInventoryChart"
                                title="Descargar gráfico">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" id="inventoryMovementChart"></div>
                    </div>
                </div>

                <div class="inventory-analysis">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-exclamation-circle"></i>
                                Artículos con Stock Bajo
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-outline-primary btn-icon" id="refreshLowStockTable"
                                    title="Actualizar tabla">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table id="lowStockTable">
                                    <thead>
                                        <tr>
                                            <th>Código</th>
                                            <th>Artículo</th>
                                            <th>Categoría</th>
                                            <th>Stock</th>
                                            <th>Mínimo</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Datos generados dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" id="requestItemsBtn">
                                <i class="fas fa-clipboard-list"></i> Solicitar Reposición
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                Distribución del Inventario
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" id="inventoryDistributionChart"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-history"></i>
                            Actividad Reciente
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="activity-list">
                            <!-- Actividad reciente generada dinámicamente -->
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-light" id="viewAllActivitiesBtn">
                            Ver toda la actividad
                        </button>
                    </div>
                </div>
            </section>

            <!-- Sección de Inventario -->
            <section id="inventory-section" class="section">
                <div class="section-header">
                    <div class="filter-bar">
                        <button class="btn btn-primary" id="addNewItemBtn">
                            <i class="fas fa-plus"></i> Nuevo Artículo
                        </button>
                        <button class="btn btn-light" id="importInventoryBtn">
                            <i class="fas fa-file-import"></i> Importar
                        </button>
                        <button class="btn btn-light" id="exportInventoryBtn">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                        <button class="btn btn-light" id="manageCategoriesBtn">
                            <i class="fas fa-tags"></i> Categorías
                        </button>
                    </div>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control search-input" id="inventorySearchInput"
                            placeholder="Buscar por código, nombre o categoría...">
                    </div>
                    <div class="tabs" id="inventoryTabs">
                        <div class="tab active" data-category="all">Todos</div>
                        <div class="tab" data-category="cleaning">Aseo</div>
                        <div class="tab" data-category="tools">Herramientas</div>
                        <div class="tab" data-category="office">Insumos Oficina</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-container">
                            <table id="inventoryTable">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Categoría</th>
                                        <th>Stock</th>
                                        <th>Mínimo</th>
                                        <th>Período de Vida</th>
                                        <th>Última Actualización</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="pagination" id="inventoryPagination">
                            <!-- Paginación generada dinámicamente -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-truck"></i>
                            Descarga de Camión
                        </h2>
                    </div>
                    <div class="card-body">
                        <form id="truckUnloadForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="truckUnloadDate">Fecha de Descarga</label>
                                    <input type="datetime-local" id="truckUnloadDate" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="truckUnloadReference">Referencia</label>
                                    <input type="text" id="truckUnloadReference" class="form-control"
                                        placeholder="Número de guía o referencia" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Artículos Recibidos</label>
                                <div id="truckUnloadItems">
                                    <div class="form-row">
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label class="form-label" for="item1">Artículo</label>
                                                <select id="item1" class="form-control form-select" required>
                                                    <option value="">Seleccionar artículo</option>
                                                    <!-- Opciones generadas dinámicamente -->
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label" for="quantity1">Cantidad</label>
                                                <input type="number" id="quantity1" class="form-control" min="1"
                                                    required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label" for="lifeCycle1">Período de Vida</label>
                                                <select id="lifeCycle1" class="form-control form-select" required>
                                                    <option value="daily">Diario</option>
                                                    <option value="1week">1 Semana</option>
                                                    <option value="2weeks">2 Semanas</option>
                                                    <option value="3weeks">3 Semanas</option>
                                                    <option value="1month">1 Mes</option>
                                                    <option value="indefinite">Indefinido</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-light" id="addTruckItemBtn"
                                    style="margin-top: 1rem;">
                                    <i class="fas fa-plus"></i> Agregar Artículo
                                </button>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="truckUnloadNotes">Observaciones</label>
                                <textarea id="truckUnloadNotes" class="form-control" rows="3"
                                    placeholder="Observaciones sobre la descarga"></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Registrar Descarga
                                </button>
                                <button type="reset" class="btn btn-light">
                                    Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Sección de Transacciones -->
            <section id="transactions-section" class="section">
                <div class="section-header">
                    <div class="filter-bar">
                        <button class="btn btn-primary" id="addNewTransactionBtn">
                            <i class="fas fa-plus"></i> Nueva Transacción
                        </button>
                        <button class="btn btn-light" id="exportTransactionsBtn">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control search-input" id="transactionsSearchInput"
                            placeholder="Buscar por ID, artículo o personal...">
                    </div>
                    <div class="tabs" id="transactionsTabs">
                        <div class="tab active" data-type="all">Todas</div>
                        <div class="tab" data-type="out">Entregas</div>
                        <div class="tab" data-type="in">Ingresos</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-container">
                            <table id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Fecha</th>
                                        <th>Tipo</th>
                                        <th>Artículo</th>
                                        <th>Cantidad</th>
                                        <th>Responsable</th>
                                        <th>Terminal</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="pagination" id="transactionsPagination">
                            <!-- Paginación generada dinámicamente -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-user"></i>
                            Resumen por Persona
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label" for="personSummarySelect">Seleccionar Persona</label>
                            <select id="personSummarySelect" class="form-control form-select">
                                <option value="">Seleccionar persona</option>
                                <!-- Opciones generadas dinámicamente -->
                            </select>
                        </div>

                        <div id="personSummaryContent" style="display: none;">
                            <div class="alert alert-primary" id="personInfoAlert">
                                <div class="alert-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="alert-content">
                                    <div class="alert-title" id="personName">Nombre de la Persona</div>
                                    <div id="personRole">Cargo</div>
                                </div>
                            </div>

                            <div class="table-container">
                                <table id="personTransactionsTable">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Artículo</th>
                                            <th>Categoría</th>
                                            <th>Cantidad</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Datos generados dinámicamente -->
                                    </tbody>
                                </table>
                            </div>

                            <button class="btn btn-primary" id="downloadPersonReportBtn" style="margin-top: 1rem;">
                                <i class="fas fa-download"></i> Descargar Reporte
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sección de Personal -->
            <section id="staff-section" class="section">
                <div class="section-header">
                    <div class="filter-bar">
                        <button class="btn btn-primary" id="addNewStaffBtn">
                            <i class="fas fa-user-plus"></i> Nuevo Personal
                        </button>
                        <button class="btn btn-light" id="exportStaffBtn">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                        <button class="btn btn-light" id="importStaffBtn">
                            <i class="fas fa-file-import"></i> Importar
                        </button>
                    </div>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control search-input" id="staffSearchInput"
                            placeholder="Buscar por nombre, cargo o terminal...">
                    </div>
                    <div class="tabs" id="staffTabs">
                        <div class="tab active" data-role="all">Todos</div>
                        <div class="tab" data-role="cleaner">Cleaners</div>
                        <div class="tab" data-role="inspector">Inspectores</div>
                        <div class="tab" data-role="supervisor">Supervisores</div>
                        <div class="tab" data-role="cabezal">Cabezales</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-container">
                            <table id="staffTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Cargo</th>
                                        <th>Terminal</th>
                                        <th>Contacto</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="pagination" id="staffPagination">
                            <!-- Paginación generada dinámicamente -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Distribución del Personal
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" id="staffDistributionChart"></div>
                    </div>
                </div>

                <div class="inventory-analysis">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-building"></i>
                                Personal por Terminal
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Terminal</th>
                                            <th>Total Personal</th>
                                            <th>Cleaners</th>
                                            <th>Inspectores</th>
                                            <th>Supervisores</th>
                                            <th>Cabezales</th>
                                        </tr>
                                    </thead>
                                    <tbody id="terminalStaffTable">
                                        <!-- Datos generados dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-calendar-alt"></i>
                                Últimas Incorporaciones
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="activity-list" id="recentStaffList">
                                <!-- Datos generados dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modal para Nuevo Personal -->
            <div class="modal-backdrop" id="newStaffModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Nuevo Personal</h3>
                        <button class="close-modal" id="closeNewStaffModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="newStaffForm">
                            <div class="form-group">
                                <label class="form-label" for="staffName">Nombre Completo</label>
                                <input type="text" id="staffName" class="form-control" required>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="staffRole">Cargo</label>
                                    <select id="staffRole" class="form-control form-select" required>
                                        <option value="">Seleccionar cargo</option>
                                        <option value="cleaner">Cleaner</option>
                                        <option value="inspector">Inspector</option>
                                        <option value="supervisor">Supervisor</option>
                                        <option value="cabezal">Cabezal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="staffTerminal">Terminal</label>
                                    <select id="staffTerminal" class="form-control form-select" required>
                                        <option value="">Seleccionar terminal</option>
                                        <option value="ER">EL ROBLE</option>
                                        <option value="LR">LA REINA</option>
                                        <option value="MA">MARIA ANGELICA</option>
                                        <option value="ED">EL DESCANSO</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="staffContact">Contacto</label>
                                    <input type="tel" id="staffContact" class="form-control"
                                        placeholder="Teléfono o correo">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="staffId">ID Empleado</label>
                                    <input type="text" id="staffId" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="staffStartDate">Fecha de Inicio</label>
                                <input type="date" id="staffStartDate" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="staffNotes">Observaciones</label>
                                <textarea id="staffNotes" class="form-control" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelNewStaffBtn">Cancelar</button>
                        <button class="btn btn-primary" id="saveNewStaffBtn">Guardar</button>
                    </div>
                </div>
            </div>

            <!-- Sección de Préstamos -->
            <section id="loans-section" class="section">
                <div class="section-header">
                    <div class="filter-bar">
                        <button class="btn btn-primary" id="addNewLoanBtn">
                            <i class="fas fa-plus"></i> Nuevo Préstamo
                        </button>
                        <button class="btn btn-light" id="exportLoansBtn">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control search-input" id="loansSearchInput"
                            placeholder="Buscar por ID, artículo o responsable...">
                    </div>
                    <div class="tabs" id="loansTabs">
                        <div class="tab active" data-status="all">Todos</div>
                        <div class="tab" data-status="active">Activos</div>
                        <div class="tab" data-status="returned">Devueltos</div>
                        <div class="tab" data-status="overdue">Vencidos</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-container">
                            <table id="loansTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Fecha</th>
                                        <th>Artículo</th>
                                        <th>Cantidad</th>
                                        <th>Responsable</th>
                                        <th>Terminal</th>
                                        <th>Fecha Devolución</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="pagination" id="loansPagination">
                            <!-- Paginación generada dinámicamente -->
                        </div>
                    </div>
                </div>

                <div class="inventory-analysis">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-building"></i>
                                Resumen por Terminal
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table id="terminalSummaryTable">
                                    <thead>
                                        <tr>
                                            <th>Terminal</th>
                                            <th>Préstamos Activos</th>
                                            <th>Total Préstamos</th>
                                            <th>Préstamos Vencidos</th>
                                            <th>% Devolución a Tiempo</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Datos generados dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                Distribución de Estados
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" id="loansStatusChart"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-clock"></i>
                            Próximas Devoluciones
                        </h2>
                        <div class="card-actions">
                            <button class="btn btn-outline-primary btn-icon" title="Actualizar lista">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Artículo</th>
                                        <th>Responsable</th>
                                        <th>Terminal</th>
                                        <th>Fecha Devolución</th>
                                        <th>Tiempo Restante</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="upcomingReturnsTable">
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modal para Nuevo Préstamo -->
            <div class="modal-backdrop" id="newLoanModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Nuevo Préstamo</h3>
                        <button class="close-modal" id="closeNewLoanModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="newLoanForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="loanDate">Fecha de Préstamo</label>
                                    <input type="datetime-local" id="loanDate" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="loanReturnDate">Fecha de Devolución</label>
                                    <input type="datetime-local" id="loanReturnDate" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="loanPerson">Responsable</label>
                                <select id="loanPerson" class="form-control form-select" required>
                                    <option value="">Seleccionar persona</option>
                                    <!-- Opciones generadas dinámicamente -->
                                </select>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="loanItem">Artículo</label>
                                    <select id="loanItem" class="form-control form-select" required>
                                        <option value="">Seleccionar artículo</option>
                                        <!-- Opciones generadas dinámicamente -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="loanQuantity">Cantidad</label>
                                    <input type="number" id="loanQuantity" class="form-control" min="1" value="1"
                                        required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="loanNotes">Observaciones</label>
                                <textarea id="loanNotes" class="form-control" rows="3"
                                    placeholder="Detalles del préstamo"></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="loanSendReminder">
                                    <span class="switch"></span>
                                    <span class="switch-label">Enviar recordatorio de devolución</span>
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelNewLoanBtn">Cancelar</button>
                        <button class="btn btn-primary" id="saveNewLoanBtn">Guardar</button>
                    </div>
                </div>
            </div>

            <!-- Modal para registrar devolución -->
            <div class="modal-backdrop" id="returnLoanModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Registrar Devolución</h3>
                        <button class="close-modal" id="closeReturnLoanModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="returnLoanForm">
                            <div class="form-group">
                                <label class="form-label" for="returnLoanId">ID del Préstamo</label>
                                <input type="text" id="returnLoanId" class="form-control" readonly>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="returnLoanDate">Fecha de Devolución</label>
                                <input type="datetime-local" id="returnLoanDate" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="returnLoanCondition">Estado del Artículo</label>
                                <select id="returnLoanCondition" class="form-control form-select" required>
                                    <option value="good">Bueno</option>
                                    <option value="damaged">Dañado</option>
                                    <option value="lost">Perdido</option>
                                </select>
                            </div>

                            <div id="damageDescriptionContainer" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label" for="returnLoanDamageDescription">Descripción del
                                        Daño</label>
                                    <textarea id="returnLoanDamageDescription" class="form-control" rows="3"></textarea>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="returnLoanNotes">Observaciones</label>
                                <textarea id="returnLoanNotes" class="form-control" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelReturnLoanBtn">Cancelar</button>
                        <button class="btn btn-success" id="confirmReturnLoanBtn">Confirmar Devolución</button>
                    </div>
                </div>
            </div>

            <!-- Sección de Alertas -->
            <section id="alerts-section" class="section">
                <div class="section-header">
                    <div class="filter-bar">
                        <button class="btn btn-primary" id="refreshAlertsBtn">
                            <i class="fas fa-sync-alt"></i> Actualizar Alertas
                        </button>
                        <button class="btn btn-light" id="markAllReadBtn">
                            <i class="fas fa-check-double"></i> Marcar Todo como Leído
                        </button>
                        <button class="btn btn-light" id="alertSettingsBtn">
                            <i class="fas fa-cog"></i> Configuración
                        </button>
                    </div>
                    <div class="tabs" id="alertsTabs">
                        <div class="tab active" data-type="all">Todas</div>
                        <div class="tab" data-type="low_stock">Stock Bajo</div>
                        <div class="tab" data-type="loan_due">Préstamos por Vencer</div>
                        <div class="tab" data-type="loan_overdue">Préstamos Vencidos</div>
                        <div class="tab" data-type="system">Sistema</div>
                    </div>
                </div>

                <div class="inventory-analysis">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-exclamation-circle"></i>
                                Alertas Activas
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-outline-primary btn-icon" id="exportAlertsBtn"
                                    title="Exportar alertas">
                                    <i class="fas fa-file-export"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table id="activeAlertsTable">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Tipo</th>
                                            <th>Descripción</th>
                                            <th>Prioridad</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Datos generados dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="pagination" id="activeAlertsPagination">
                                <!-- Paginación generada dinámicamente -->
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                Distribución de Alertas
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" id="alertsDistributionChart"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Alertas de Stock Bajo
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="alertsLowStockTable">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Categoría</th>
                                        <th>Stock Actual</th>
                                        <th>Stock Mínimo</th>
                                        <th>Solicitud</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-primary" id="requestAllItemsBtn">
                            <i class="fas fa-shopping-cart"></i> Solicitar Todos los Artículos
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-clock"></i>
                            Préstamos por Vencer
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="alertsLoansTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Artículo</th>
                                        <th>Responsable</th>
                                        <th>Terminal</th>
                                        <th>Fecha Devolución</th>
                                        <th>Días Restantes</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-primary" id="notifyAllLoansBtn">
                            <i class="fas fa-bell"></i> Notificar a Todos
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-history"></i>
                            Historial de Alertas
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="alertsHistoryTable">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Tipo</th>
                                        <th>Descripción</th>
                                        <th>Estado</th>
                                        <th>Resolución</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="pagination" id="alertsHistoryPagination">
                            <!-- Paginación generada dinámicamente -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modal de Configuración de Alertas -->
            <div class="modal-backdrop" id="alertSettingsModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Configuración de Alertas</h3>
                        <button class="close-modal" id="closeAlertSettingsModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="alertSettingsForm">
                            <div class="form-group">
                                <label class="form-label">Notificaciones Sonoras</label>
                                <label class="form-switch">
                                    <input type="checkbox" id="enableSoundAlerts" checked>
                                    <span class="switch"></span>
                                    <span class="switch-label">Activar alertas de sonido</span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="lowStockThreshold">Umbral de Stock Bajo</label>
                                <div class="form-grid">
                                    <input type="number" id="lowStockThreshold" class="form-control" min="1" value="10">
                                    <div class="form-text">Cantidad por debajo de la cual se considera stock bajo.</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="loanDueThreshold">Días de Anticipación para
                                    Préstamos</label>
                                <div class="form-grid">
                                    <input type="number" id="loanDueThreshold" class="form-control" min="1" value="3">
                                    <div class="form-text">Días antes del vencimiento para mostrar alertas de préstamos.
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="alertDuration">Duración de Notificaciones</label>
                                <select id="alertDuration" class="form-control form-select">
                                    <option value="3000">3 segundos</option>
                                    <option value="5000" selected>5 segundos</option>
                                    <option value="8000">8 segundos</option>
                                    <option value="10000">10 segundos</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Tipos de Alertas a Mostrar</label>
                                <div class="checkbox-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showLowStockAlerts" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Stock Bajo</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showLoanDueAlerts" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Préstamos por Vencer</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showLoanOverdueAlerts" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Préstamos Vencidos</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showSystemAlerts" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Sistema</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Notificaciones por Correo</label>
                                <label class="form-switch">
                                    <input type="checkbox" id="enableEmailAlerts">
                                    <span class="switch"></span>
                                    <span class="switch-label">Enviar alertas por correo</span>
                                </label>
                            </div>

                            <div id="emailSettingsContainer" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label" for="emailRecipients">Destinatarios</label>
                                    <input type="text" id="emailRecipients" class="form-control"
                                        placeholder="email@ejemplo.com, otro@ejemplo.com">
                                    <div class="form-text">Separe múltiples direcciones con comas.</div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Frecuencia de Resumen por Correo</label>
                                    <select id="emailFrequency" class="form-control form-select">
                                        <option value="daily">Diario</option>
                                        <option value="weekly" selected>Semanal</option>
                                        <option value="monthly">Mensual</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelAlertSettingsBtn">Cancelar</button>
                        <button class="btn btn-primary" id="saveAlertSettingsBtn">Guardar</button>
                    </div>
                </div>
            </div>

            <!-- Modal para resolver alerta -->
            <div class="modal-backdrop" id="resolveAlertModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Resolver Alerta</h3>
                        <button class="close-modal" id="closeResolveAlertModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="resolveAlertForm">
                            <div class="form-group">
                                <label class="form-label" for="alertId">ID de Alerta</label>
                                <input type="text" id="alertId" class="form-control" readonly>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="alertDescription">Descripción</label>
                                <div class="form-control" id="alertDescription" style="min-height: 60px;"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="resolutionType">Tipo de Resolución</label>
                                <select id="resolutionType" class="form-control form-select" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="completed">Acción Completada</option>
                                    <option value="notRequired">Acción No Requerida</option>
                                    <option value="postponed">Pospuesto</option>
                                    <option value="other">Otro</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="resolutionNotes">Notas de Resolución</label>
                                <textarea id="resolutionNotes" class="form-control" rows="3" required></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelResolveAlertBtn">Cancelar</button>
                        <button class="btn btn-success" id="confirmResolveAlertBtn">Resolver</button>
                    </div>
                </div>
            </div>

            <!-- Sección de Reportes -->
            <section id="reports-section" class="section">
                <div class="section-header">
                    <div class="filter-bar">
                        <button class="btn btn-primary" id="generateReportBtn">
                            <i class="fas fa-file-alt"></i> Generar Reporte
                        </button>
                        <button class="btn btn-light" id="scheduleReportBtn">
                            <i class="fas fa-calendar-alt"></i> Programar Reporte
                        </button>
                        <button class="btn btn-light" id="savedReportsBtn">
                            <i class="fas fa-save"></i> Reportes Guardados
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-file-alt"></i>
                            Generador de Reportes
                        </h2>
                    </div>
                    <div class="card-body">
                        <form id="reportGeneratorForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="reportType">Tipo de Reporte</label>
                                    <select id="reportType" class="form-control form-select" required>
                                        <option value="">Seleccionar tipo</option>
                                        <option value="inventory">Inventario</option>
                                        <option value="transactions">Transacciones</option>
                                        <option value="staff">Personal</option>
                                        <option value="loans">Préstamos</option>
                                        <option value="stock">Stock Bajo</option>
                                        <option value="activity">Actividad del Sistema</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="reportFormat">Formato</label>
                                    <select id="reportFormat" class="form-control form-select" required>
                                        <option value="pdf">PDF</option>
                                        <option value="excel">Excel</option>
                                        <option value="csv">CSV</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="reportDateRange">Rango de Fechas</label>
                                    <select id="reportDateRange" class="form-control form-select">
                                        <option value="today">Hoy</option>
                                        <option value="yesterday">Ayer</option>
                                        <option value="thisWeek">Esta Semana</option>
                                        <option value="lastWeek">Semana Pasada</option>
                                        <option value="thisMonth" selected>Este Mes</option>
                                        <option value="lastMonth">Mes Pasado</option>
                                        <option value="thisYear">Este Año</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </div>
                                <div class="form-group" id="customDateRangeContainer" style="display: none;">
                                    <div class="form-grid">
                                        <div>
                                            <label class="form-label" for="reportStartDate">Fecha Inicio</label>
                                            <input type="date" id="reportStartDate" class="form-control">
                                        </div>
                                        <div>
                                            <label class="form-label" for="reportEndDate">Fecha Fin</label>
                                            <input type="date" id="reportEndDate" class="form-control">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="reportOptionsContainer">
                                <!-- Opciones específicas por tipo de reporte (cargadas dinámicamente) -->
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="reportTitle">Título del Reporte</label>
                                <input type="text" id="reportTitle" class="form-control"
                                    placeholder="Título personalizado (opcional)">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="reportNotes">Notas</label>
                                <textarea id="reportNotes" class="form-control" rows="3"
                                    placeholder="Notas adicionales para incluir en el reporte"></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="saveReportTemplate">
                                    <span class="switch"></span>
                                    <span class="switch-label">Guardar como plantilla</span>
                                </label>
                            </div>

                            <div id="saveTemplateContainer" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label" for="reportTemplateName">Nombre de la Plantilla</label>
                                    <input type="text" id="reportTemplateName" class="form-control"
                                        placeholder="Nombre para identificar esta plantilla">
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-file-download"></i> Generar y Descargar
                                </button>
                                <button type="button" class="btn btn-light" id="previewReportBtn">
                                    <i class="fas fa-eye"></i> Vista Previa
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="inventory-analysis">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-history"></i>
                                Historial de Reportes
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table id="reportsHistoryTable">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Tipo</th>
                                            <th>Formato</th>
                                            <th>Generado por</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Datos generados dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="pagination" id="reportsHistoryPagination">
                                <!-- Paginación generada dinámicamente -->
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-calendar-alt"></i>
                                Reportes Programados
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-outline-primary btn-icon" id="addScheduledReportBtn"
                                    title="Programar reporte">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table id="scheduledReportsTable">
                                    <thead>
                                        <tr>
                                            <th>Nombre</th>
                                            <th>Tipo</th>
                                            <th>Frecuencia</th>
                                            <th>Próxima Ejecución</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Datos generados dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Análisis de Datos
                        </h2>
                        <div class="card-actions">
                            <button class="btn btn-outline-primary btn-icon" id="refreshAnalysisBtn"
                                title="Actualizar análisis">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="tabs" id="analysisTabs">
                            <div class="tab active" data-analysis="inventory">Inventario</div>
                            <div class="tab" data-analysis="transactions">Transacciones</div>
                            <div class="tab" data-analysis="loans">Préstamos</div>
                            <div class="tab" data-analysis="performance">Rendimiento</div>
                        </div>

                        <div class="analysis-container" id="inventoryAnalysisContainer">
                            <div class="inventory-analysis">
                                <div class="chart-container" id="inventoryAnalysisChart1"></div>
                                <div class="chart-container" id="inventoryAnalysisChart2"></div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">
                                    <i class="fas fa-info-circle"></i>
                                    Análisis de Inventario
                                </div>
                                <div class="info-card-content">
                                    <p>El análisis muestra la distribución y estado actual del inventario. Las
                                        categorías con mayor rotación son <strong>Aseo</strong> y
                                        <strong>Herramientas</strong>.
                                    </p>
                                    <p>Se recomienda revisar los artículos con baja rotación y considerar ajustar los
                                        niveles de stock mínimo.</p>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-container" id="transactionsAnalysisContainer" style="display: none;">
                            <div class="inventory-analysis">
                                <div class="chart-container" id="transactionsAnalysisChart1"></div>
                                <div class="chart-container" id="transactionsAnalysisChart2"></div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">
                                    <i class="fas fa-info-circle"></i>
                                    Análisis de Transacciones
                                </div>
                                <div class="info-card-content">
                                    <p>El análisis muestra la distribución de transacciones por tipo y por terminal. La
                                        <strong>Terminal EL ROBLE</strong> presenta el mayor número de transacciones.
                                    </p>
                                    <p>Se observa un incremento del 15% en el volumen de transacciones respecto al mes
                                        anterior.</p>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-container" id="loansAnalysisContainer" style="display: none;">
                            <div class="inventory-analysis">
                                <div class="chart-container" id="loansAnalysisChart1"></div>
                                <div class="chart-container" id="loansAnalysisChart2"></div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">
                                    <i class="fas fa-info-circle"></i>
                                    Análisis de Préstamos
                                </div>
                                <div class="info-card-content">
                                    <p>El análisis muestra la tasa de devolución a tiempo por terminal y categoría de
                                        artículo. Los <strong>Inspectores</strong> tienen la mayor tasa de devolución a
                                        tiempo.</p>
                                    <p>Se recomienda implementar recordatorios adicionales para la <strong>Terminal
                                            Sur</strong> que presenta la mayor tasa de préstamos vencidos.</p>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-container" id="performanceAnalysisContainer" style="display: none;">
                            <div class="inventory-analysis">
                                <div class="chart-container" id="performanceAnalysisChart1"></div>
                                <div class="chart-container" id="performanceAnalysisChart2"></div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-title">
                                    <i class="fas fa-info-circle"></i>
                                    Análisis de Rendimiento
                                </div>
                                <div class="info-card-content">
                                    <p>El análisis muestra métricas de eficiencia en la gestión de bodega. El tiempo
                                        promedio de procesamiento de solicitudes ha mejorado un <strong>12%</strong>
                                        respecto al trimestre anterior.</p>
                                    <p>La categoría con mayor eficiencia en rotación es <strong>Insumos de
                                            Oficina</strong>.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modal para programar reportes -->
            <div class="modal-backdrop" id="scheduleReportModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Programar Reporte</h3>
                        <button class="close-modal" id="closeScheduleReportModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="scheduleReportForm">
                            <div class="form-group">
                                <label class="form-label" for="scheduledReportName">Nombre</label>
                                <input type="text" id="scheduledReportName" class="form-control" required
                                    placeholder="Nombre para identificar este reporte">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="scheduledReportType">Tipo de Reporte</label>
                                <select id="scheduledReportType" class="form-control form-select" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="inventory">Inventario</option>
                                    <option value="transactions">Transacciones</option>
                                    <option value="staff">Personal</option>
                                    <option value="loans">Préstamos</option>
                                    <option value="stock">Stock Bajo</option>
                                    <option value="activity">Actividad del Sistema</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="scheduledReportFormat">Formato</label>
                                <select id="scheduledReportFormat" class="form-control form-select" required>
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="scheduledReportFrequency">Frecuencia</label>
                                <select id="scheduledReportFrequency" class="form-control form-select" required>
                                    <option value="daily">Diario</option>
                                    <option value="weekly">Semanal</option>
                                    <option value="biweekly">Quincenal</option>
                                    <option value="monthly">Mensual</option>
                                    <option value="quarterly">Trimestral</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="scheduledReportTime">Hora de Ejecución</label>
                                <input type="time" id="scheduledReportTime" class="form-control" required value="08:00">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="scheduledReportEmail">Enviar por Correo a</label>
                                <input type="text" id="scheduledReportEmail" class="form-control"
                                    placeholder="email@ejemplo.com, otro@ejemplo.com">
                                <div class="form-text">Deje en blanco para guardar solo en el sistema. Separe múltiples
                                    correos con comas.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="scheduledReportNotes">Notas</label>
                                <textarea id="scheduledReportNotes" class="form-control" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelScheduleReportBtn">Cancelar</button>
                        <button class="btn btn-primary" id="saveScheduleReportBtn">Programar</button>
                    </div>
                </div>
            </div>

            <!-- Modal de reportes guardados -->
            <div class="modal-backdrop" id="savedReportsModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Reportes Guardados</h3>
                        <button class="close-modal" id="closeSavedReportsModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="search-container">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="form-control search-input" id="savedReportsSearchInput"
                                placeholder="Buscar reportes guardados...">
                        </div>

                        <div class="table-container">
                            <table id="savedReportsTable">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Tipo</th>
                                        <th>Formato</th>
                                        <th>Fecha</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos generados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="closeSavedReportsBtn">Cerrar</button>
                    </div>
                </div>
            </div>

            <!-- Sección de Configuración -->
            <section id="settings-section" class="section">
                <div class="section-header">
                    <div class="filter-bar">
                        <button class="btn btn-primary" id="saveAllSettingsBtn">
                            <i class="fas fa-save"></i> Guardar Cambios
                        </button>
                        <button class="btn btn-light" id="resetAllSettingsBtn">
                            <i class="fas fa-undo"></i> Restablecer
                        </button>
                        <button class="btn btn-light" id="exportSettingsBtn">
                            <i class="fas fa-file-export"></i> Exportar Configuración
                        </button>
                        <button class="btn btn-light" id="importSettingsBtn">
                            <i class="fas fa-file-import"></i> Importar Configuración
                        </button>
                    </div>
                    <div class="tabs" id="settingsTabs">
                        <div class="tab active" data-setting="general">General</div>
                        <div class="tab" data-setting="appearance">Apariencia</div>
                        <div class="tab" data-setting="notifications">Notificaciones</div>
                        <div class="tab" data-setting="database">Base de Datos</div>
                        <div class="tab" data-setting="advanced">Avanzado</div>
                    </div>
                </div>

                <!-- Configuración General -->
                <div class="settings-container" id="generalSettingsContainer">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-sliders-h"></i>
                                Configuración General
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label" for="companyName">Nombre de la Empresa</label>
                                <input type="text" id="companyName" class="form-control" value="Mi Empresa">
                                <div class="form-text">Se mostrará en reportes e informes.</div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="defaultView">Vista Predeterminada</label>
                                    <select id="defaultView" class="form-control form-select">
                                        <option value="dashboard" selected>Dashboard</option>
                                        <option value="inventory">Inventario</option>
                                        <option value="transactions">Transacciones</option>
                                        <option value="alerts">Alertas</option>
                                    </select>
                                    <div class="form-text">Sección que se mostrará al iniciar.</div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="itemsPerPage">Elementos por Página</label>
                                    <select id="itemsPerPage" class="form-control form-select">
                                        <option value="10">10</option>
                                        <option value="20" selected>20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                    <div class="form-text">Número de elementos a mostrar en tablas.</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="dateFormat">Formato de Fecha</label>
                                <select id="dateFormat" class="form-control form-select">
                                    <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                </select>
                                <div class="form-text">Formato para mostrar fechas en el sistema.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="timeZone">Zona Horaria</label>
                                <select id="timeZone" class="form-control form-select">
                                    <option value="UTC-3">UTC-3 (Santiago)</option>
                                    <option value="UTC-4">UTC-4 (La Paz, Santo Domingo)</option>
                                    <option value="UTC-5">UTC-5 (Bogotá, Lima, Quito)</option>
                                    <option value="UTC-6">UTC-6 (Ciudad de México, Guatemala)</option>
                                    <option value="UTC+0">UTC+0 (Londres, Dublín, Lisboa)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="compactMode">
                                    <span class="switch"></span>
                                    <span class="switch-label">Modo Compacto</span>
                                </label>
                                <div class="form-text">Reduce el espaciado en tablas para mostrar más datos.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="confirmActions" checked>
                                    <span class="switch"></span>
                                    <span class="switch-label">Confirmar Acciones Importantes</span>
                                </label>
                                <div class="form-text">Mostrar diálogos de confirmación para acciones como eliminar.
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="language">Idioma</label>
                                <select id="language" class="form-control form-select">
                                    <option value="es" selected>Español</option>
                                    <option value="en">English</option>
                                    <option value="pt">Português</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuración de Apariencia -->
                <div class="settings-container" id="appearanceSettingsContainer" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-palette"></i>
                                Tema y Apariencia
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Tema de Color</label>
                                <div class="theme-selector-container">
                                    <button class="theme-selector-btn blue active" data-theme="blue">
                                        <div class="theme-circle"></div>
                                        <span>Azul</span>
                                    </button>
                                    <button class="theme-selector-btn green" data-theme="green">
                                        <div class="theme-circle"></div>
                                        <span>Verde</span>
                                    </button>
                                    <button class="theme-selector-btn red" data-theme="red">
                                        <div class="theme-circle"></div>
                                        <span>Rojo</span>
                                    </button>
                                    <button class="theme-selector-btn pink" data-theme="pink">
                                        <div class="theme-circle"></div>
                                        <span>Rosa</span>
                                    </button>
                                    <button class="theme-selector-btn dark" data-theme="dark">
                                        <div class="theme-circle"></div>
                                        <span>Oscuro</span>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="darkModeSystem">
                                    <span class="switch"></span>
                                    <span class="switch-label">Usar tema del sistema</span>
                                </label>
                                <div class="form-text">Cambiar automáticamente entre modo claro y oscuro según el tema
                                    del sistema.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="fontSize">Tamaño de Fuente</label>
                                <select id="fontSize" class="form-control form-select">
                                    <option value="small">Pequeño</option>
                                    <option value="medium" selected>Mediano</option>
                                    <option value="large">Grande</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="fontFamily">Fuente</label>
                                <select id="fontFamily" class="form-control form-select">
                                    <option value="Inter" selected>Inter</option>
                                    <option value="Roboto">Roboto</option>
                                    <option value="Poppins">Poppins</option>
                                    <option value="Open Sans">Open Sans</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="borderRadius">Estilo de Bordes</label>
                                <select id="borderRadius" class="form-control form-select">
                                    <option value="sharp">Angulares</option>
                                    <option value="rounded" selected>Redondeados</option>
                                    <option value="extraRounded">Muy Redondeados</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Personalización del Dashboard</label>
                                <div class="form-grid">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showStatsCards" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Mostrar tarjetas de estadísticas</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showInventoryChart" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Mostrar gráfico de inventario</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showLowStockTable" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Mostrar tabla de stock bajo</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showRecentActivity" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Mostrar actividad reciente</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Logo Personalizado</label>
                                <div class="input-group">
                                    <input type="file" id="logoFile" class="form-control" accept="image/*">
                                    <button class="btn btn-outline-primary" id="resetLogoBtn">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                </div>
                                <div class="form-text">Imagen PNG o SVG recomendada (máximo 2MB).</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuración de Notificaciones -->
                <div class="settings-container" id="notificationsSettingsContainer" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-bell"></i>
                                Configuración de Notificaciones
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="enableNotifications" checked>
                                    <span class="switch"></span>
                                    <span class="switch-label">Activar Notificaciones</span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="enableSoundAlerts" checked>
                                    <span class="switch"></span>
                                    <span class="switch-label">Alertas Sonoras</span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="notificationDuration">Duración de Notificaciones</label>
                                <select id="notificationDuration" class="form-control form-select">
                                    <option value="3000">3 segundos</option>
                                    <option value="5000" selected>5 segundos</option>
                                    <option value="8000">8 segundos</option>
                                    <option value="10000">10 segundos</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Tipos de Alertas</label>
                                <div class="form-grid">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showLowStockAlerts" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Stock Bajo</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showTransactionAlerts" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Transacciones</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showLoanAlerts" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Préstamos</span>
                                    </label>
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="showSystemAlerts" checked>
                                        <span class="checkbox-custom"></span>
                                        <span>Sistema</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="lowStockThreshold">Umbral de Stock Bajo</label>
                                <input type="number" id="lowStockThreshold" class="form-control" min="1" value="10">
                                <div class="form-text">Cantidad por debajo de la cual se considera stock bajo.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="loanReminderDays">Recordatorio de Préstamos</label>
                                <input type="number" id="loanReminderDays" class="form-control" min="1" value="3">
                                <div class="form-text">Días antes para recordar préstamos por vencer.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="enableEmailNotifications">
                                    <span class="switch"></span>
                                    <span class="switch-label">Notificaciones por Correo</span>
                                </label>
                            </div>

                            <div id="emailNotificationsContainer" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label" for="emailRecipients">Destinatarios</label>
                                    <input type="text" id="emailRecipients" class="form-control"
                                        placeholder="email@ejemplo.com, otro@ejemplo.com">
                                    <div class="form-text">Separe múltiples correos con comas.</div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Frecuencia de Resumen</label>
                                    <select id="emailFrequency" class="form-control form-select">
                                        <option value="daily">Diario</option>
                                        <option value="weekly" selected>Semanal</option>
                                        <option value="monthly">Mensual</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Tipos de Correos</label>
                                    <div class="form-grid">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="emailLowStock" checked>
                                            <span class="checkbox-custom"></span>
                                            <span>Stock Bajo</span>
                                        </label>
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="emailLoanReminders" checked>
                                            <span class="checkbox-custom"></span>
                                            <span>Préstamos por Vencer</span>
                                        </label>
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="emailSystemReports" checked>
                                            <span class="checkbox-custom"></span>
                                            <span>Reportes de Sistema</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuración de Base de Datos -->
                <div class="settings-container" id="databaseSettingsContainer" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-database"></i>
                                Configuración de Base de Datos
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <div class="alert-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="alert-content">
                                    <div class="alert-title">Información Importante</div>
                                    <p>Cambiar la configuración de base de datos puede causar pérdida de conexión con
                                        los datos. Asegúrese de tener las credenciales correctas antes de guardar los
                                        cambios.</p>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="supabaseUrl">URL de Supabase</label>
                                <div class="input-group">
                                    <input type="text" id="supabaseUrl" class="form-control"
                                        value="https://tcmtxvuucjttngcazgff.supabase.co">
                                    <button class="btn btn-outline-primary" id="testConnection">
                                        <i class="fas fa-vial"></i> Probar
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="supabaseKey">Clave Anónima</label>
                                <div class="input-group">
                                    <input type="password" id="supabaseKey" class="form-control"
                                        value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjbXR4dnV1Y2p0dG5nY2F6Z2ZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTExNjIxMjIsImV4cCI6MjAyNjczODEyMn0.2lU7Jdi3Z7jcvNNLFnOkEYlYnuK0KgOe7rDpH7YwMQI">
                                    <button class="btn btn-outline-primary" id="toggleKeyVisibility">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="syncInterval">Intervalo de Sincronización</label>
                                <select id="syncInterval" class="form-control form-select">
                                    <option value="0">Manual</option>
                                    <option value="30000">30 segundos</option>
                                    <option value="60000" selected>1 minuto</option>
                                    <option value="300000">5 minutos</option>
                                    <option value="600000">10 minutos</option>
                                </select>
                                <div class="form-text">Frecuencia con la que se actualizan los datos automáticamente.
                                </div>
                            </div>

                            <div class="form-group">
                                <button class="btn btn-primary btn-icon-text" id="syncNowBtn">
                                    <i class="fas fa-sync-alt"></i> Sincronizar Ahora
                                </button>
                                <small class="form-text" id="lastSyncTime">Última sincronización: Nunca</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Exportar Base de Datos Local</label>
                                <button class="btn btn-light btn-icon-text" id="exportDatabaseBtn">
                                    <i class="fas fa-download"></i> Exportar Datos
                                </button>
                                <div class="form-text">Exporta una copia de los datos almacenados localmente en formato
                                    JSON.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Importar Base de Datos</label>
                                <div class="input-group">
                                    <input type="file" id="databaseFile" class="form-control" accept=".json">
                                    <button class="btn btn-warning" id="importDatabaseBtn">
                                        <i class="fas fa-upload"></i> Importar
                                    </button>
                                </div>
                                <div class="form-text">Restaura datos desde un archivo de respaldo JSON.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="offlineMode">
                                    <span class="switch"></span>
                                    <span class="switch-label">Habilitar Modo Offline</span>
                                </label>
                                <div class="form-text">Almacena datos localmente para uso sin conexión.</div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" id="saveDbSettings">Guardar Configuración</button>
                            <button class="btn btn-light" id="resetDbSettings">Restablecer</button>
                        </div>
                    </div>
                </div>

                <!-- Configuración Avanzada -->
                <div class="settings-container" id="advancedSettingsContainer" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-tools"></i>
                                Configuración Avanzada
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning">
                                <div class="alert-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="alert-content">
                                    <div class="alert-title">Advertencia</div>
                                    <p>Esta sección contiene configuraciones avanzadas que pueden afectar el
                                        funcionamiento del sistema. Solo cambie estos ajustes si sabe lo que está
                                        haciendo.</p>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="logLevel">Nivel de Registro</label>
                                <select id="logLevel" class="form-control form-select">
                                    <option value="error">Solo Errores</option>
                                    <option value="warn">Advertencias y Errores</option>
                                    <option value="info" selected>Información, Advertencias y Errores</option>
                                    <option value="debug">Todo (Debug)</option>
                                </select>
                                <div class="form-text">Define qué nivel de detalle se registra en los logs del sistema.
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="cacheTime">Tiempo de Caché (minutos)</label>
                                <input type="number" id="cacheTime" class="form-control" min="1" value="30">
                                <div class="form-text">Tiempo que se mantienen los datos en caché antes de recargarlos.
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="maxUploadSize">Tamaño Máximo de Archivos (MB)</label>
                                <input type="number" id="maxUploadSize" class="form-control" min="1" max="50"
                                    value="10">
                                <div class="form-text">Tamaño máximo para archivos subidos al sistema.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-switch">
                                    <input type="checkbox" id="debugMode">
                                    <span class="switch"></span>
                                    <span class="switch-label">Modo de Depuración</span>
                                </label>
                                <div class="form-text">Muestra información adicional para solución de problemas.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="customCSS">CSS Personalizado</label>
                                <textarea id="customCSS" class="form-control" rows="5"
                                    placeholder="/* Ingrese código CSS personalizado aquí */"></textarea>
                                <div class="form-text">Código CSS personalizado para modificar la apariencia del
                                    sistema.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Herramientas de Mantenimiento</label>
                                <div class="form-grid">
                                    <button class="btn btn-light btn-icon-text" id="clearCacheBtn">
                                        <i class="fas fa-eraser"></i> Limpiar Caché
                                    </button>
                                    <button class="btn btn-light btn-icon-text" id="optimizeDbBtn">
                                        <i class="fas fa-bolt"></i> Optimizar BD
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Reinicio y Restauración</label>
                                <div class="form-grid">
                                    <button class="btn btn-warning btn-icon-text" id="resetSettingsBtn">
                                        <i class="fas fa-undo"></i> Restablecer Configuración
                                    </button>
                                    <button class="btn btn-danger btn-icon-text" id="factoryResetBtn">
                                        <i class="fas fa-trash"></i> Restaurar Fábrica
                                    </button>
                                </div>
                                <div class="form-text">La restauración de fábrica eliminará todos los datos y ajustes.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modal de confirmación de restablecimiento -->
            <div class="modal-backdrop" id="resetConfirmModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Confirmar Restablecimiento</h3>
                        <button class="close-modal" id="closeResetConfirmModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-danger">
                            <div class="alert-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">Advertencia</div>
                                <p>Esta acción restablecerá todas las configuraciones a sus valores predeterminados.
                                    Esta acción no se puede deshacer.</p>
                            </div>
                        </div>

                        <p>Por favor, escriba "CONFIRMAR" para continuar:</p>
                        <div class="form-group">
                            <input type="text" id="resetConfirmText" class="form-control" placeholder="CONFIRMAR">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelResetBtn">Cancelar</button>
                        <button class="btn btn-danger" id="confirmResetBtn" disabled>Restablecer</button>
                    </div>
                </div>
            </div>

            <!-- Modal de confirmación de restauración de fábrica -->
            <div class="modal-backdrop" id="factoryResetConfirmModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Confirmar Restauración de Fábrica</h3>
                        <button class="close-modal" id="closeFactoryResetConfirmModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-danger">
                            <div class="alert-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">Advertencia</div>
                                <p>Esta acción eliminará <strong>todos los datos</strong> y restablecerá todas las
                                    configuraciones. Esta acción es irreversible.</p>
                                <p>Se recomienda hacer una copia de seguridad antes de continuar.</p>
                            </div>
                        </div>

                        <p>Por favor, escriba "RESTAURAR FÁBRICA" para continuar:</p>
                        <div class="form-group">
                            <input type="text" id="factoryResetConfirmText" class="form-control"
                                placeholder="RESTAURAR FÁBRICA">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelFactoryResetBtn">Cancelar</button>
                        <button class="btn btn-danger" id="confirmFactoryResetBtn" disabled>Restaurar Fábrica</button>
                    </div>
                </div>
            </div>

            <!-- Sección de Perfil -->
            <!-- Sección de Perfil -->
            <section id="profile-section" class="section">
                <div class="section-header">
                    <div class="filter-bar">
                        <button class="btn btn-primary" id="saveProfileBtn">
                            <i class="fas fa-save"></i> Guardar Cambios
                        </button>
                        <button class="btn btn-light" id="changePasswordBtn">
                            <i class="fas fa-key"></i> Cambiar Contraseña
                        </button>
                    </div>
                </div>

                <div class="inventory-analysis">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-user"></i>
                                Información Personal
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="profile-header">
                                <div class="profile-avatar-container">
                                    <img src="https://ui-avatars.com/api/?name=Admin&background=4f46e5&color=fff&size=200"
                                        alt="Foto de perfil" class="profile-avatar">
                                    <button class="profile-avatar-edit-btn">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                    <input type="file" id="profileImageInput" accept="image/*" style="display: none;">
                                </div>
                                <div class="profile-info">
                                    <h3 class="profile-name">Administrador</h3>
                                    <p class="profile-role">Super Admin</p>
                                    <p class="profile-since">Miembro desde: 10/03/2023</p>
                                </div>
                            </div>

                            <form id="profileForm">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label" for="profileName">Nombre Completo</label>
                                        <input type="text" id="profileName" class="form-control" value="Administrador"
                                            required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="profileEmail">Correo Electrónico</label>
                                        <input type="email" id="profileEmail" class="form-control"
                                            value="admin@example.com" required>
                                    </div>
                                </div>

                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label" for="profilePhone">Teléfono</label>
                                        <input type="tel" id="profilePhone" class="form-control"
                                            value="+56 9 1234 5678">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="profilePosition">Cargo</label>
                                        <input type="text" id="profilePosition" class="form-control"
                                            value="Administrador de Bodega" readonly>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="profileBio">Biografía</label>
                                    <textarea id="profileBio" class="form-control" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-shield-alt"></i>
                                Seguridad y Acceso
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label" for="lastLogin">Último Acceso</label>
                                <div class="form-control" id="lastLogin">29/03/2025 08:45:12</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="deviceInfo">Dispositivo Actual</label>
                                <div class="form-control" id="deviceInfo">Google Chrome en Windows 10</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Sesiones Activas</label>
                                <div class="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Dispositivo</th>
                                                <th>Ubicación</th>
                                                <th>Última Actividad</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Google Chrome en Windows 10</td>
                                                <td>Santiago, Chile</td>
                                                <td>Ahora</td>
                                                <td><span class="badge badge-success">Sesión Actual</span></td>
                                            </tr>
                                            <tr>
                                                <td>Safari en iPhone</td>
                                                <td>Santiago, Chile</td>
                                                <td>28/03/2025 15:30</td>
                                                <td>
                                                    <button class="btn btn-sm btn-danger">
                                                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Autenticación de Dos Factores</label>
                                <div class="form-switch-container">
                                    <label class="form-switch">
                                        <input type="checkbox" id="enable2FA">
                                        <span class="switch"></span>
                                        <span class="switch-label">Activar autenticación de dos factores</span>
                                    </label>
                                    <button class="btn btn-sm btn-light" id="setup2FABtn" style="display: none;">
                                        <i class="fas fa-qrcode"></i> Configurar
                                    </button>
                                </div>
                                <div class="form-text">Añade una capa adicional de seguridad a tu cuenta.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-cog"></i>
                            Preferencias de Cuenta
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Notificaciones por Correo</label>
                            <div class="checkbox-group">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="emailAlerts" checked>
                                    <span class="checkbox-custom"></span>
                                    <span>Alertas del Sistema</span>
                                </label>
                                <label class="form-checkbox">
                                    <input type="checkbox" id="emailReports" checked>
                                    <span class="checkbox-custom"></span>
                                    <span>Reportes Periódicos</span>
                                </label>
                                <label class="form-checkbox">
                                    <input type="checkbox" id="emailUpdates">
                                    <span class="checkbox-custom"></span>
                                    <span>Actualizaciones y Novedades</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="defaultLanguage">Idioma Predeterminado</label>
                            <select id="defaultLanguage" class="form-control form-select">
                                <option value="es" selected>Español</option>
                                <option value="en">English</option>
                                <option value="pt">Português</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="timezone">Zona Horaria</label>
                            <select id="timezone" class="form-control form-select">
                                <option value="UTC-3" selected>UTC-3 (Santiago)</option>
                                <option value="UTC-4">UTC-4 (La Paz, Santo Domingo)</option>
                                <option value="UTC-5">UTC-5 (Bogotá, Lima, Quito)</option>
                                <option value="UTC-6">UTC-6 (Ciudad de México, Guatemala)</option>
                                <option value="UTC+0">UTC+0 (Londres, Dublín, Lisboa)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Mostrar en Dashboard</label>
                            <div class="checkbox-group">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="showInventoryWidget" checked>
                                    <span class="checkbox-custom"></span>
                                    <span>Inventario</span>
                                </label>
                                <label class="form-checkbox">
                                    <input type="checkbox" id="showTransactionsWidget" checked>
                                    <span class="checkbox-custom"></span>
                                    <span>Transacciones</span>
                                </label>
                                <label class="form-checkbox">
                                    <input type="checkbox" id="showLoansWidget" checked>
                                    <span class="checkbox-custom"></span>
                                    <span>Préstamos</span>
                                </label>
                                <label class="form-checkbox">
                                    <input type="checkbox" id="showAlertsWidget" checked>
                                    <span class="checkbox-custom"></span>
                                    <span>Alertas</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-history"></i>
                            Actividad de la Cuenta
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="tabs" id="activityTabs">
                            <div class="tab active" data-activity="all">Toda la Actividad</div>
                            <div class="tab" data-activity="logins">Inicios de Sesión</div>
                            <div class="tab" data-activity="changes">Cambios Realizados</div>
                        </div>

                        <div class="activity-list">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-sign-in-alt"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Inicio de Sesión</div>
                                    <div class="activity-meta">
                                        <div class="activity-time">
                                            <i class="fas fa-clock"></i>
                                            29/03/2025 08:45:12
                                        </div>
                                        <div class="activity-device">
                                            <i class="fas fa-laptop"></i>
                                            Google Chrome en Windows 10
                                        </div>
                                        <div class="activity-location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            Santiago, Chile
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Actualización de Inventario</div>
                                    <div class="activity-meta">
                                        <div class="activity-time">
                                            <i class="fas fa-clock"></i>
                                            28/03/2025 14:30:45
                                        </div>
                                        <div class="activity-device">
                                            <i class="fas fa-laptop"></i>
                                            Google Chrome en Windows 10
                                        </div>
                                        <div class="activity-details">
                                            <i class="fas fa-info-circle"></i>
                                            5 artículos actualizados
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-file-export"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Exportación de Reportes</div>
                                    <div class="activity-meta">
                                        <div class="activity-time">
                                            <i class="fas fa-clock"></i>
                                            28/03/2025 11:15:22
                                        </div>
                                        <div class="activity-device">
                                            <i class="fas fa-laptop"></i>
                                            Google Chrome en Windows 10
                                        </div>
                                        <div class="activity-details">
                                            <i class="fas fa-info-circle"></i>
                                            Reporte de inventario mensual
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-sign-in-alt"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Inicio de Sesión</div>
                                    <div class="activity-meta">
                                        <div class="activity-time">
                                            <i class="fas fa-clock"></i>
                                            28/03/2025 09:05:33
                                        </div>
                                        <div class="activity-device">
                                            <i class="fas fa-mobile-alt"></i>
                                            Safari en iPhone
                                        </div>
                                        <div class="activity-location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            Santiago, Chile
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-cog"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Cambio de Configuración</div>
                                    <div class="activity-meta">
                                        <div class="activity-time">
                                            <i class="fas fa-clock"></i>
                                            27/03/2025 16:40:12
                                        </div>
                                        <div class="activity-device">
                                            <i class="fas fa-laptop"></i>
                                            Google Chrome en Windows 10
                                        </div>
                                        <div class="activity-details">
                                            <i class="fas fa-info-circle"></i>
                                            Notificaciones actualizadas
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-light btn-icon-text" id="loadMoreActivityBtn">
                                <i class="fas fa-plus"></i> Cargar Más
                            </button>
                            <button class="btn btn-light btn-icon-text" id="exportActivityBtn">
                                <i class="fas fa-download"></i> Exportar Historial
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modal para cambiar contraseña -->
            <div class="modal-backdrop" id="changePasswordModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Cambiar Contraseña</h3>
                        <button class="close-modal" id="closeChangePasswordModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="changePasswordForm">
                            <div class="form-group">
                                <label class="form-label" for="currentPassword">Contraseña Actual</label>
                                <input type="password" id="currentPassword" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="newPassword">Nueva Contraseña</label>
                                <input type="password" id="newPassword" class="form-control" required>
                                <div class="form-text">La contraseña debe tener al menos 8 caracteres y contener letras,
                                    números y al menos un carácter especial.</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="confirmPassword">Confirmar Contraseña</label>
                                <input type="password" id="confirmPassword" class="form-control" required>
                            </div>

                            <div class="password-strength" id="passwordStrength">
                                <div class="password-strength-label">Seguridad:</div>
                                <div class="password-strength-bar">
                                    <div class="password-strength-fill" style="width: 0%;"></div>
                                </div>
                                <div class="password-strength-text">Débil</div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancelChangePasswordBtn">Cancelar</button>
                        <button class="btn btn-primary" id="confirmChangePasswordBtn">Cambiar Contraseña</button>
                    </div>
                </div>
            </div>

            <!-- Modal para configurar 2FA -->
            <div class="modal-backdrop" id="setup2FAModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3 class="modal-title">Configurar Autenticación de Dos Factores</h3>
                        <button class="close-modal" id="closeSetup2FAModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <div class="alert-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">Instrucciones</div>
                                <p>1. Descargue una aplicación autenticadora como Google Authenticator o Authy en su
                                    teléfono.</p>
                                <p>2. Escanee el código QR o ingrese la clave manualmente en la aplicación.</p>
                                <p>3. Ingrese el código de verificación generado por la aplicación para confirmar.</p>
                            </div>
                        </div>

                        <div class="setup-2fa-container">
                            <div class="qr-code-container">
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=otpauth://totp/SistemaBodega:admin@example.com?secret=JBSWY3DPEHPK3PXP&issuer=SistemaBodega"
                                    alt="Código QR para 2FA" class="qr-code">
                            </div>

                            <div class="setup-2fa-key">
                                <label class="form-label">Clave Manual</label>
                                <div class="secret-key">JBSWY3 DPEHPK 3PXP</div>
                                <button class="btn btn-sm btn-light" id="copySecretKeyBtn">
                                    <i class="fas fa-copy"></i> Copiar
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="verificationCode">Código de Verificación</label>
                            <input type="text" id="verificationCode" class="form-control"
                                placeholder="Ingrese el código de 6 dígitos" required>
                        </div>

                        <div class="recovery-codes-container" style="display: none;">
                            <label class="form-label">Códigos de Recuperación</label>
                            <div class="recovery-codes">
                                <div class="recovery-code">1234-5678-9012</div>
                                <div class="recovery-code">3456-7890-1234</div>
                                <div class="recovery-code">5678-9012-3456</div>
                                <div class="recovery-code">7890-1234-5678</div>
                                <div class="recovery-code">9012-3456-7890</div>
                            </div>
                            <div class="form-text">Guarde estos códigos en un lugar seguro. Se utilizan para acceder a
                                su cuenta si pierde el acceso a su dispositivo de autenticación.</div>
                            <button class="btn btn-sm btn-light" id="downloadRecoveryCodesBtn">
                                <i class="fas fa-download"></i> Descargar Códigos
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" id="cancel2FASetupBtn">Cancelar</button>
                        <button class="btn btn-primary" id="verify2FABtn">Verificar</button>
                        <button class="btn btn-success" id="complete2FABtn" style="display: none;">Completar
                            Configuración</button>
                    </div>
                </div>
            </div>

            <style>
                /* Estilos específicos para la sección de perfil */
                .profile-header {
                    display: flex;
                    align-items: center;
                    margin-bottom: 2rem;
                    gap: 2rem;
                }

                .profile-avatar-container {
                    position: relative;
                }

                .profile-avatar {
                    width: 150px;
                    height: 150px;
                    border-radius: 50%;
                    object-fit: cover;
                    border: 4px solid var(--primary-color);
                    box-shadow: var(--shadow);
                }

                .profile-avatar-edit-btn {
                    position: absolute;
                    bottom: 10px;
                    right: 10px;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background-color: var(--primary-color);
                    color: white;
                    border: none;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    box-shadow: var(--shadow);
                    transition: var(--transition);
                }

                .profile-avatar-edit-btn:hover {
                    background-color: var(--primary-color-dark);
                    transform: scale(1.1);
                }

                .profile-info {
                    flex: 1;
                }

                .profile-name {
                    font-size: 1.75rem;
                    font-weight: 700;
                    color: var(--text-primary);
                    margin-bottom: 0.5rem;
                }

                .profile-role {
                    font-size: 1.1rem;
                    color: var(--primary-color);
                    margin-bottom: 0.5rem;
                }

                .profile-since {
                    font-size: 0.875rem;
                    color: var(--text-secondary);
                }

                .form-switch-container {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }

                .password-strength {
                    margin-top: 1rem;
                }

                .password-strength-label {
                    font-size: 0.875rem;
                    color: var(--text-secondary);
                    margin-bottom: 0.25rem;
                }

                .password-strength-bar {
                    height: 8px;
                    background-color: #e5e7eb;
                    border-radius: var(--border-radius-full);
                    overflow: hidden;
                    margin-bottom: 0.25rem;
                }

                .password-strength-fill {
                    height: 100%;
                    background-color: #ef4444;
                    border-radius: var(--border-radius-full);
                    transition: width 0.3s ease, background-color 0.3s ease;
                }

                .password-strength-text {
                    font-size: 0.75rem;
                    color: var(--text-secondary);
                }

                .setup-2fa-container {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    margin-bottom: 1.5rem;
                }

                .qr-code-container {
                    padding: 1rem;
                    background-color: white;
                    border-radius: var(--border-radius);
                    margin-bottom: 1rem;
                    box-shadow: var(--shadow-sm);
                }

                .qr-code {
                    width: 200px;
                    height: 200px;
                }

                .setup-2fa-key {
                    text-align: center;
                    margin-bottom: 1rem;
                }

                .secret-key {
                    font-family: monospace;
                    font-size: 1.25rem;
                    background-color: rgba(var(--primary-rgb), 0.1);
                    padding: 0.75rem 1.25rem;
                    border-radius: var(--border-radius);
                    margin: 0.5rem 0;
                    letter-spacing: 2px;
                }

                .recovery-codes-container {
                    margin-top: 1.5rem;
                    padding: 1rem;
                    background-color: rgba(var(--warning-rgb), 0.1);
                    border-radius: var(--border-radius);
                    border-left: 4px solid var(--warning-color);
                }

                .recovery-codes {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 0.5rem;
                    margin: 0.75rem 0;
                }

                .recovery-code {
                    font-family: monospace;
                    background-color: var(--surface-color);
                    padding: 0.5rem;
                    border-radius: var(--border-radius);
                    text-align: center;
                    border: 1px solid rgba(0, 0, 0, 0.1);
                }

                @media (max-width: 768px) {
                    .profile-header {
                        flex-direction: column;
                        align-items: center;
                        text-align: center;
                        gap: 1rem;
                    }

                    .setup-2fa-container {
                        padding: 0;
                    }

                    .qr-code {
                        width: 180px;
                        height: 180px;
                    }

                    .secret-key {
                        font-size: 1rem;
                        padding: 0.5rem;
                    }
                }
            </style>
        </div>
    </div>

    <!-- Modal para Nuevo Artículo -->
    <div class="modal-backdrop" id="newItemModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Nuevo Artículo</h3>
                <button class="close-modal" id="closeNewItemModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="newItemForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="itemCode">Código</label>
                            <input type="text" id="itemCode" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="itemName">Nombre</label>
                            <input type="text" id="itemName" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="itemCategory">Categoría</label>
                            <select id="itemCategory" class="form-control form-select" required>
                                <option value="cleaning">Aseo</option>
                                <option value="tools">Herramientas</option>
                                <option value="office">Insumos Oficina</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="itemStock">Stock Inicial</label>
                            <input type="number" id="itemStock" class="form-control" min="0" required>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="itemMinStock">Stock Mínimo</label>
                            <input type="number" id="itemMinStock" class="form-control" min="1" value="10" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="itemLifeCycle">Período de Vida</label>
                            <select id="itemLifeCycle" class="form-control form-select" required>
                                <option value="daily">Diario</option>
                                <option value="1week">1 Semana</option>
                                <option value="2weeks">2 Semanas</option>
                                <option value="3weeks">3 Semanas</option>
                                <option value="1month">1 Mes</option>
                                <option value="indefinite">Indefinido</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="itemDescription">Descripción</label>
                        <textarea id="itemDescription" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="cancelNewItemBtn">Cancelar</button>
                <button class="btn btn-primary" id="saveNewItemBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nueva Transacción -->
    <div class="modal-backdrop" id="newTransactionModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Nueva Transacción</h3>
                <button class="close-modal" id="closeNewTransactionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="newTransactionForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="transactionType">Tipo</label>
                            <select id="transactionType" class="form-control form-select" required>
                                <option value="out">Entrega</option>
                                <option value="in">Ingreso</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="transactionDate">Fecha</label>
                            <input type="datetime-local" id="transactionDate" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="transactionPerson">Responsable</label>
                        <select id="transactionPerson" class="form-control form-select" required>
                            <option value="">Seleccionar responsable</option>
                            <!-- Opciones generadas dinámicamente -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Artículos</label>
                        <div id="transactionItems">
                            <div class="form-row">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label" for="transItem1">Artículo</label>
                                        <select id="transItem1" class="form-control form-select transaction-item"
                                            required>
                                            <option value="">Seleccionar artículo</option>
                                             <option value="cleaning">Aseo</option>
                                <option value="tools">Herramientas</option>
                                <option value="office">Insumos Oficina</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="transQuantity1">Cantidad</label>
                                        <input type="number" id="transQuantity1" class="form-control" min="1" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-light" id="addTransactionItemBtn"
                            style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i> Agregar Artículo
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="transactionNotes">Observaciones</label>
                        <textarea id="transactionNotes" class="form-control" rows="3"
                            placeholder="Observaciones sobre la transacción"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="cancelNewTransactionBtn">Cancelar</button>
                <button class="btn btn-primary" id="saveNewTransactionBtn">Guardar</button>
            </div>
        </div>
    </div>

    <script>


        // =============== INICIALIZACIÓN Y CONFIGURACIÓN GLOBAL ===============

        // Configuración de Supabase
        const SUPABASE_URL = 'https://tcmtxvuucjttngcazgff.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjbXR4dnV1Y2p0dG5nY2F6Z2ZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA3MjUwMDEsImV4cCI6MjA1NjMwMTAwMX0.2WcIjMUEhSM6j9kYpbsYArQocZdHx86k7wXk-NyjIs0';

        // Variables globales
        let supabase;
        let inventory = [];
        let transactions = [];
        let staff = [];
        let loans = [];
        let alerts = [];
        let charts = {};
        let syncInterval;
        let isOnline = true;
        let currentSection = 'dashboard';

        // Referencias a elementos DOM comunes
        const elements = {
            loader: document.getElementById('loader'),
            sidebar: document.getElementById('sidebar'),
            mainContent: document.getElementById('mainContent'),
            notificationContainer: document.getElementById('notificationContainer'),
            pageTitle: document.getElementById('pageTitle'),
            alertsCount: document.getElementById('alertsCount')
        };

        // =============== FUNCIONES DE UTILIDAD ===============

        /**
         * Muestra u oculta el loader
         * @param {boolean} show - Indica si se debe mostrar el loader
         */
        function toggleLoader(show) {
            if (elements.loader) {
                if (show) {
                    elements.loader.classList.add('active');
                } else {
                    elements.loader.classList.remove('active');
                }
            }
        }

        /**
         * Muestra una notificación toast
         * @param {string} message - Mensaje a mostrar
         * @param {string} type - Tipo de notificación (success, warning, danger, info)
         */
        function showNotification(message, type = 'info') {
            if (!elements.notificationContainer) return;

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;

            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            if (type === 'danger') icon = 'fa-times-circle';

            notification.innerHTML = `
        <div class="notification-icon">
            <i class="fas ${icon}"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
            <div class="notification-message">${message}</div>
        </div>
        <button class="close-notification">
            <i class="fas fa-times"></i>
        </button>
    `;

            elements.notificationContainer.appendChild(notification);

            // Auto cerrar después de 5 segundos
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);

            // Cerrar manualmente
            const closeButton = notification.querySelector('.close-notification');
            closeButton.addEventListener('click', () => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            });
        }


        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;

            const options = {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            };

            return date.toLocaleString(undefined, options);
        }


        function getCategoryName(category) {
            const categories = {
                'cleaning': 'Aseo',
                'tools': 'Herramientas',
                'office': 'Insumos Oficina',
                'cleaner': 'Cleaner',
                'inspector': 'Inspector',
                'supervisor': 'Supervisor',
                'cabezal': 'Cabezal'
            };
            return categories[category] || category;
        }


        function getLifeCycleName(lifeCycle) {
            const cycles = {
                'daily': 'Diario',
                '1week': '1 Semana',
                '2weeks': '2 Semanas',
                '3weeks': '3 Semanas',
                '1month': '1 Mes',
                'indefinite': 'Indefinido'
            };
            return cycles[lifeCycle] || lifeCycle;
        }


        function getTerminalName(terminal) {
            const terminals = {
                'ER': 'EL ROBLE',
                'LR': 'LA REINA',
                'MA': 'MARIA ANGELICA',
                'ED': 'EL DESCANSO'
            };
            return terminals[terminal] || terminal;
        }


        function getAlertTypeName(type) {
            const types = {
                'low_stock': 'Stock Bajo',
                'loan_due': 'Préstamo por Vencer',
                'loan_overdue': 'Préstamo Vencido',
                'system': 'Sistema'
            };
            return types[type] || type;
        }


        function checkOnlineStatus() {
            return navigator.onLine;
        }

        /**
         * Genera un ID único
         * @returns {string} - ID único
         */
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }

        // =============== CONEXIÓN CON SUPABASE ===============

        /**
         * Inicializa la conexión con Supabase
         */
        function initializeSupabase() {
            try {
                console.log('Inicializando conexión con Supabase...');

                // Verifica si Supabase está disponible
                if (typeof window.supabase !== 'undefined') {
                    // Usando window.supabase.createClient
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    console.log('Conexión con Supabase inicializada usando window.supabase');
                } else if (typeof createClient !== 'undefined') {
                    // Usando createClient global
                    supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
                    console.log('Conexión con Supabase inicializada usando createClient global');
                } else if (typeof supabaseJs !== 'undefined') {
                    // Usando supabaseJs
                    supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);
                    console.log('Conexión con Supabase inicializada usando supabaseJs');
                } else {
                    // No se encontró Supabase
                    console.error('No se encontró Supabase en el contexto global');
                    throw new Error('Supabase no está disponible');
                }
            } catch (error) {
                console.error('Error al inicializar Supabase:', error);
                showNotification('Error al conectar con la base de datos', 'danger');
                isOnline = false;
            }
        }

        /**
         * Prueba la conexión con Supabase
         * @returns {Promise<boolean>} - true si la conexión es exitosa, false en caso contrario
         */
        /**
         * Prueba la conexión con Supabase
         * @returns {Promise<boolean>} - true si la conexión es exitosa, false en caso contrario
         */
        async function testSupabaseConnection() {
            try {
                if (!supabase) return false;

                // Intentamos usar una operación más simple para probar la conexión
                const { data, error } = await supabase
                    .from('superstore_items')
                    .select('*')
                    .limit(1);

                if (error) {
                    console.error('Error al probar conexión con Supabase:', error);
                    return false;
                }

                return true;
            } catch (error) {
                console.error('Error al probar conexión con Supabase:', error);
                return false;
            }
        }

        /**
         * Carga todos los datos desde Supabase
         */
        async function loadAllData() {
            toggleLoader(true);

            try {
                // Verificar estado de conexión
                isOnline = await testSupabaseConnection();

                if (!isOnline) {
                    showNotification('Trabajando en modo offline con datos locales', 'warning');
                    loadDataFromLocalStorage();
                    return;
                }

                // Cargar datos en paralelo
                const [
                    inventoryData,
                    transactionsData,
                    staffData,
                    loansData,
                    alertsData
                ] = await Promise.all([
                    loadInventory(),
                    loadTransactions(),
                    loadStaff(),
                    loadLoans(),
                    loadAlerts()
                ]);

                // Actualizar contadores y UI
                updateDashboard();
                updateAlertCount();

                // Guardar datos en localStorage para modo offline
                saveDataToLocalStorage();

                // Actualizar timestamp de última sincronización
                const lastSyncTimeElement = document.getElementById('lastSyncTime');
                if (lastSyncTimeElement) {
                    lastSyncTimeElement.textContent = 'Última sincronización: ' + new Date().toLocaleString();
                }

                showNotification('Datos cargados correctamente', 'success');
            } catch (error) {
                console.error('Error al cargar datos:', error);
                showNotification('Error al cargar datos. Cargando datos locales.', 'danger');
                loadDataFromLocalStorage();
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Carga inventario desde Supabase
         */
        async function loadInventory() {
            try {
                const { data, error } = await supabase
                    .from('superstore_items')
                    .select('*')
                    .order('id', { ascending: true });

                if (error) throw error;

                inventory = data || [];
                renderInventoryTable();

                return data;
            } catch (error) {
                console.error('Error al cargar inventario:', error);
                throw error;
            }
        }

        /**
         * Carga transacciones desde Supabase
         */
        async function loadTransactions() {
            try {
                const { data, error } = await supabase
                    .from('superstore_transactions')
                    .select('*')
                    .order('date', { ascending: false });

                if (error) throw error;

                transactions = data || [];
                renderTransactionsTable();

                return data;
            } catch (error) {
                console.error('Error al cargar transacciones:', error);
                throw error;
            }
        }

        /**
         * Carga personal desde Supabase
         */
        async function loadStaff() {
            try {
                const { data, error } = await supabase
                    .from('superstore_staff')
                    .select('*')
                    .order('id', { ascending: true });

                if (error) throw error;

                staff = data || [];
                renderStaffTable();

                return data;
            } catch (error) {
                console.error('Error al cargar personal:', error);
                throw error;
            }
        }

        /**
         * Carga préstamos desde Supabase
         */
        async function loadLoans() {
            try {
                const { data, error } = await supabase
                    .from('superstore_loans')
                    .select('*')
                    .order('date', { ascending: false });

                if (error) throw error;

                loans = data || [];
                renderLoansTable();

                return data;
            } catch (error) {
                console.error('Error al cargar préstamos:', error);
                throw error;
            }
        }

        /**
         * Carga alertas desde Supabase
         */
        async function loadAlerts() {
            try {
                const { data, error } = await supabase
                    .from('superstore_alerts')
                    .select('*')
                    .order('date', { ascending: false });

                if (error) throw error;

                alerts = data || [];
                renderAlertsTable();

                return data;
            } catch (error) {
                console.error('Error al cargar alertas:', error);
                throw error;
            }
        }

        /**
         * Guarda los datos en localStorage para modo offline
         */
        function saveDataToLocalStorage() {
            try {
                localStorage.setItem('inventoryData', JSON.stringify(inventory));
                localStorage.setItem('transactionsData', JSON.stringify(transactions));
                localStorage.setItem('staffData', JSON.stringify(staff));
                localStorage.setItem('loansData', JSON.stringify(loans));
                localStorage.setItem('alertsData', JSON.stringify(alerts));
                localStorage.setItem('lastSync', new Date().toISOString());
            } catch (error) {
                console.error('Error al guardar datos en localStorage:', error);
            }
        }

        /**
         * Carga los datos desde localStorage para modo offline
         */
        function loadDataFromLocalStorage() {
            try {
                const inventoryData = localStorage.getItem('inventoryData');
                const transactionsData = localStorage.getItem('transactionsData');
                const staffData = localStorage.getItem('staffData');
                const loansData = localStorage.getItem('loansData');
                const alertsData = localStorage.getItem('alertsData');

                if (inventoryData) inventory = JSON.parse(inventoryData);
                if (transactionsData) transactions = JSON.parse(transactionsData);
                if (staffData) staff = JSON.parse(staffData);
                if (loansData) loans = JSON.parse(loansData);
                if (alertsData) alerts = JSON.parse(alertsData);

                // Actualizar interfaz con datos cargados
                renderInventoryTable();
                renderTransactionsTable();
                renderStaffTable();
                renderLoansTable();
                renderAlertsTable();
                updateDashboard();
                updateAlertCount();

                const lastSync = localStorage.getItem('lastSync');
                if (lastSync) {
                    const lastSyncTimeElement = document.getElementById('lastSyncTime');
                    if (lastSyncTimeElement) {
                        lastSyncTimeElement.textContent = 'Última sincronización: ' + new Date(lastSync).toLocaleString() + ' (local)';
                    }
                }
            } catch (error) {
                console.error('Error al cargar datos de localStorage:', error);
                showNotification('Error al cargar datos locales', 'danger');
            }
        }

        /**
         * Configura el intervalo de sincronización automática
         */
        function setupSyncInterval() {
            // Limpiar intervalo existente
            if (syncInterval) {
                clearInterval(syncInterval);
            }

            // Obtener intervalo configurado o usar valor por defecto
            const interval = parseInt(localStorage.getItem('syncInterval') || '60000', 10);

            // Si el intervalo es mayor que 0, configurar sincronización automática
            if (interval > 0) {
                syncInterval = setInterval(() => {
                    if (checkOnlineStatus()) {
                        loadAllData();
                    }
                }, interval);

                console.log(`Sincronización automática configurada cada ${interval / 1000} segundos`);
            }
        }

        // =============== GESTIÓN DE INTERFAZ DE USUARIO (UI) ===============

        /**
         * Inicializa el dashboard con los datos actuales
         */
        function updateDashboard() {
            try {
                console.log('Actualizando dashboard...');

                // Actualizar contadores
                updateDashboardCounters();

                // Actualizar tabla de stock bajo
                updateLowStockTable();

                // Actualizar lista de actividad reciente
                updateRecentActivity();

                // Inicializar gráficos si estamos en la sección de dashboard
                if (currentSection === 'dashboard') {
                    initializeCharts();
                }
            } catch (error) {
                console.error('Error al actualizar dashboard:', error);
            }
        }

        /**
         * Actualiza los contadores del dashboard
         */
        function updateDashboardCounters() {
            // Total de artículos
            const totalItemsElement = document.getElementById('totalItemsValue');
            if (totalItemsElement) {
                totalItemsElement.textContent = inventory.length;
            }

            // Transacciones del mes
            const totalTransactionsElement = document.getElementById('totalTransactionsValue');
            if (totalTransactionsElement) {
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();

                const monthlyTransactions = transactions.filter(t => {
                    const tranDate = new Date(t.date);
                    return tranDate.getMonth() === currentMonth &&
                        tranDate.getFullYear() === currentYear;
                });

                totalTransactionsElement.textContent = monthlyTransactions.length;
            }

            // Préstamos activos
            const activeLoansElement = document.getElementById('activeLoansValue');
            if (activeLoansElement) {
                const activeLoans = loans.filter(l => l.status === 'active');
                activeLoansElement.textContent = activeLoans.length;
            }

            // Artículos con stock bajo
            const lowStockElement = document.getElementById('lowStockItemsValue');
            if (lowStockElement) {
                const lowStockItems = inventory.filter(item =>
                    item.stock < (item.min_stock || 10)
                );
                lowStockElement.textContent = lowStockItems.length;
            }
        }

        /**
         * Actualiza la tabla de artículos con stock bajo
         */
        function updateLowStockTable() {
            const lowStockTable = document.getElementById('lowStockTable');
            if (!lowStockTable) return;

            const tbody = lowStockTable.querySelector('tbody');
            if (!tbody) return;

            // Limpiar tabla
            tbody.innerHTML = '';

            // Filtrar artículos con stock bajo
            const lowStockItems = inventory.filter(item =>
                item.stock < (item.min_stock || 10)
            );

            if (lowStockItems.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="6" class="text-center">No hay artículos con stock bajo</td>';
                tbody.appendChild(tr);
                return;
            }

            // Renderizar filas
            lowStockItems.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${item.code || 'N/A'}</td>
            <td class="low-stock">${item.name || 'Sin nombre'}</td>
            <td>${getCategoryName(item.category)}</td>
            <td class="low-stock">${item.stock}</td>
            <td>${item.min_stock || 10}</td>
            <td>
                <button class="btn btn-sm btn-warning request-item-btn" data-id="${item.id}">
                    <i class="fas fa-shopping-cart"></i> Solicitar
                </button>
            </td>
        `;
                tbody.appendChild(tr);
            });

            // Agregar eventos a los botones
            tbody.querySelectorAll('.request-item-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const itemId = parseInt(this.dataset.id);
                    requestItem(itemId);
                });
            });
        }

        /**
         * Actualiza la lista de actividad reciente
         */
        function updateRecentActivity() {
            const activityList = document.querySelector('.activity-list');
            if (!activityList) return;

            // Limpiar lista
            activityList.innerHTML = '';

            // Combinar transacciones y préstamos
            const allActivities = [
                ...transactions.map(t => ({
                    date: t.date,
                    type: t.type === 'in' ? 'ingreso' : 'entrega',
                    icon: t.type === 'in' ? 'fa-arrow-down' : 'fa-arrow-up',
                    user: staff.find(s => s.id === t.person_id)?.name || 'Usuario Desconocido',
                    description: `${t.type === 'in' ? 'Ingreso' : 'Entrega'} de ${t.quantity} ${inventory.find(i => i.id === t.item_id)?.name || 'Artículo'}`
                })),
                ...loans.map(l => ({
                    date: l.date,
                    type: 'préstamo',
                    icon: 'fa-handshake',
                    user: staff.find(s => s.id === l.person_id)?.name || 'Usuario Desconocido',
                    description: `Préstamo de ${l.quantity} ${inventory.find(i => i.id === l.item_id)?.name || 'Artículo'}`
                }))
            ]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5); // Mostrar solo los 5 más recientes

            if (allActivities.length === 0) {
                activityList.innerHTML = '<div class="text-center">No hay actividad reciente</div>';
                return;
            }

            // Renderizar actividades
            allActivities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';

                activityItem.innerHTML = `
            <div class="activity-icon">
                <i class="fas ${activity.icon}"></i>
            </div>
            <div class="activity-content">
                <div class="activity-title">${activity.description}</div>
                <div class="activity-meta">
                    <div class="activity-time">
                        <i class="fas fa-clock"></i>
                        ${formatDate(activity.date)}
                    </div>
                    <div class="activity-user">
                        <i class="fas fa-user"></i>
                        ${activity.user}
                    </div>
                </div>
            </div>
        `;

                activityList.appendChild(activityItem);
            });
        }

        /**
         * Actualiza el contador de alertas
         */
        function updateAlertCount() {
            if (!elements.alertsCount) return;

            // Contar alertas activas
            const activeAlerts = alerts.filter(a => a.status === 'active').length;

            // Contar artículos con stock bajo
            const lowStockItems = inventory.filter(item =>
                item.stock < (item.min_stock || 10)
            ).length;

            // Contar préstamos por vencer
            const today = new Date();
            const dueLoans = loans.filter(loan => {
                if (loan.status !== 'active') return false;

                const returnDate = new Date(loan.return_date);
                const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                return daysRemaining >= 0 && daysRemaining <= 3;
            }).length;

            // Contar préstamos vencidos
            const overdueLoans = loans.filter(loan => {
                if (loan.status !== 'active') return false;

                const returnDate = new Date(loan.return_date);
                return returnDate < today;
            }).length;

            // Total de alertas
            const totalAlerts = activeAlerts + lowStockItems + dueLoans + overdueLoans;

            elements.alertsCount.textContent = totalAlerts;
            elements.alertsCount.style.display = totalAlerts > 0 ? 'flex' : 'none';

            // Actualizar título de la página para mostrar notificaciones
            document.title = totalAlerts > 0
                ? `(${totalAlerts}) Sistema de Gestión de Bodega`
                : 'Sistema de Gestión de Bodega';
        }

        /**
         * Renderiza la tabla de inventario
         */
        function renderInventoryTable() {
            const inventoryTable = document.getElementById('inventoryTable');
            if (!inventoryTable) return;

            const tbody = inventoryTable.querySelector('tbody');
            if (!tbody) return;

            // Limpiar tabla
            tbody.innerHTML = '';

            if (inventory.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="8" class="text-center">No hay artículos en el inventario</td>';
                tbody.appendChild(tr);
                return;
            }

            // Renderizar filas
            inventory.forEach(item => {
                const tr = document.createElement('tr');
                const isLowStock = item.stock < (item.min_stock || 10);

                tr.innerHTML = `
            <td>${item.code || 'N/A'}</td>
            <td>${item.name || 'Sin nombre'}</td>
            <td>${getCategoryName(item.category)}</td>
            <td class="${isLowStock ? 'low-stock' : ''}">${item.stock}</td>
            <td>${item.min_stock || 10}</td>
            <td>${getLifeCycleName(item.life_cycle)}</td>
            <td>${formatDate(item.updated_at)}</td>
            <td>
                <div class="table-actions">
                    <button class="btn btn-sm btn-light btn-icon view-item-btn" data-id="${item.id}" title="Ver detalle">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-primary btn-icon edit-item-btn" data-id="${item.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger btn-icon delete-item-btn" data-id="${item.id}" title="Eliminar">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
                tbody.appendChild(tr);
            });

            // Agregar eventos a los botones
            tbody.querySelectorAll('.view-item-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const itemId = parseInt(this.dataset.id);
                    viewItemDetails(itemId);
                });
            });

            tbody.querySelectorAll('.edit-item-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const itemId = parseInt(this.dataset.id);
                    editItem(itemId);
                });
            });

            tbody.querySelectorAll('.delete-item-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const itemId = parseInt(this.dataset.id);
                    deleteItem(itemId);
                });
            });

            // Actualizar selectores de artículos
            populateItemSelectors();
        }

        /**
         * Renderiza la tabla de transacciones
         */
        function renderTransactionsTable() {
            const transactionsTable = document.getElementById('transactionsTable');
            if (!transactionsTable) return;

            const tbody = transactionsTable.querySelector('tbody');
            if (!tbody) return;

            // Limpiar tabla
            tbody.innerHTML = '';

            if (transactions.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="8" class="text-center">No hay transacciones registradas</td>';
                tbody.appendChild(tr);
                return;
            }

            // Renderizar filas
            transactions.forEach(transaction => {
                const tr = document.createElement('tr');
                const item = inventory.find(i => i.id === transaction.item_id) || { name: 'Desconocido' };
                const person = staff.find(s => s.id === transaction.person_id) || { name: 'Desconocido', terminal: 'desconocido' };

                tr.innerHTML = `
            <td>${transaction.id}</td>
            <td>${formatDate(transaction.date)}</td>
            <td>
                <span class="badge ${transaction.type === 'in' ? 'badge-success' : 'badge-primary'}">
                    ${transaction.type === 'in' ? 'Ingreso' : 'Entrega'}
                </span>
            </td>
            <td>${item.name}</td>
            <td>${transaction.quantity}</td>
            <td>${person.name}</td>
            <td>${getTerminalName(person.terminal)}</td>
            <td>
                <div class="table-actions">
                    <button class="btn btn-sm btn-light btn-icon view-transaction-btn" data-id="${transaction.id}" title="Ver detalle">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-danger btn-icon delete-transaction-btn" data-id="${transaction.id}" title="Eliminar">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
                tbody.appendChild(tr);
            });

            // Agregar eventos a los botones
            tbody.querySelectorAll('.view-transaction-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const transactionId = parseInt(this.dataset.id);
                    viewTransactionDetails(transactionId);
                });
            });

            tbody.querySelectorAll('.delete-transaction-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const transactionId = parseInt(this.dataset.id);
                    deleteTransaction(transactionId);
                });
            });

            // Actualizar selector de personas
            populatePersonSelector();
        }

        /**
         * Renderiza la tabla de personal
         */
        function renderStaffTable() {
            const staffTable = document.getElementById('staffTable');
            if (!staffTable) return;

            const tbody = staffTable.querySelector('tbody');
            if (!tbody) return;

            // Limpiar tabla
            tbody.innerHTML = '';

            if (staff.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="6" class="text-center">No hay personal registrado</td>';
                tbody.appendChild(tr);
                return;
            }

            // Renderizar filas
            staff.forEach(person => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${person.id}</td>
            <td>${person.name || 'Sin nombre'}</td>
            <td>${getCategoryName(person.role)}</td>
            <td>${getTerminalName(person.terminal)}</td>
            <td>${person.contact || 'No disponible'}</td>
            <td>
                <div class="table-actions">
                    <button class="btn btn-sm btn-light btn-icon view-staff-btn" data-id="${person.id}" title="Ver detalle">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-primary btn-icon edit-staff-btn" data-id="${person.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger btn-icon delete-staff-btn" data-id="${person.id}" title="Eliminar">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
                tbody.appendChild(tr);
            });

            // Agregar eventos a los botones
            tbody.querySelectorAll('.view-staff-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const staffId = parseInt(this.dataset.id);
                    viewStaffDetails(staffId);
                });
            });

            tbody.querySelectorAll('.edit-staff-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const staffId = parseInt(this.dataset.id);
                    editStaff(staffId);
                });
            });

            tbody.querySelectorAll('.delete-staff-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const staffId = parseInt(this.dataset.id);
                    deleteStaff(staffId);
                });
            });

            // Actualizar terminal summary si está disponible
            updateTerminalStaffSummary();

            // Inicializar gráfico de distribución de personal si estamos en esa sección
            if (currentSection === 'staff') {
                initializeStaffChart();
            }
        }

        /**
         * Actualiza el resumen de personal por terminal
         */
        function updateTerminalStaffSummary() {
            const terminalStaffTable = document.getElementById('terminalStaffTable');
            if (!terminalStaffTable) return;

            const tbody = terminalStaffTable;
            tbody.innerHTML = '';

            // Definir terminales
            const terminals = ['ER', 'LR', 'MA', 'ED'];

            // Procesar datos
            terminals.forEach(terminal => {
                const terminalStaff = staff.filter(s => s.terminal === terminal);
                const cleaners = terminalStaff.filter(s => s.role === 'cleaner').length;
                const inspectors = terminalStaff.filter(s => s.role === 'inspector').length;
                const supervisors = terminalStaff.filter(s => s.role === 'supervisor').length;
                const cabezales = terminalStaff.filter(s => s.role === 'cabezal').length;

                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${getTerminalName(terminal)}</td>
            <td>${terminalStaff.length}</td>
            <td>${cleaners}</td>
            <td>${inspectors}</td>
            <td>${supervisors}</td>
            <td>${cabezales}</td>
        `;
                tbody.appendChild(tr);
            });
        }

        /**
         * Renderiza la tabla de préstamos
         */
        function renderLoansTable() {
            const loansTable = document.getElementById('loansTable');
            if (!loansTable) return;

            const tbody = loansTable.querySelector('tbody');
            if (!tbody) return;

            // Limpiar tabla
            tbody.innerHTML = '';

            if (loans.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="9" class="text-center">No hay préstamos registrados</td>';
                tbody.appendChild(tr);
                return;
            }

            // Fecha actual para calcular días restantes
            const today = new Date();

            // Renderizar filas
            loans.forEach(loan => {
                const tr = document.createElement('tr');
                const item = inventory.find(i => i.id === loan.item_id) || { name: 'Desconocido' };
                const person = staff.find(s => s.id === loan.person_id) || { name: 'Desconocido', terminal: 'desconocido' };

                // Calcular días restantes
                const returnDate = new Date(loan.return_date);
                const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                // Determinar estado visual
                let statusClass = '';
                let statusText = loan.status;

                if (loan.status === 'active') {
                    if (daysRemaining < 0) {
                        statusClass = 'badge-danger';
                        statusText = 'Vencido';
                    } else if (daysRemaining <= 3) {
                        statusClass = 'badge-warning';
                        statusText = 'Por vencer';
                    } else {
                        statusClass = 'badge-success';
                        statusText = 'Activo';
                    }
                } else if (loan.status === 'returned') {
                    statusClass = 'badge-info';
                    statusText = 'Devuelto';
                } else if (loan.status === 'overdue') {
                    statusClass = 'badge-danger';
                    statusText = 'Vencido';
                }

                tr.innerHTML = `
            <td>${loan.id}</td>
            <td>${formatDate(loan.date)}</td>
            <td>${item.name}</td>
            <td>${loan.quantity}</td>
            <td>${person.name}</td>
            <td>${getTerminalName(person.terminal)}</td>
            <td>${formatDate(loan.return_date)}</td>
            <td><span class="badge ${statusClass}">${statusText}</span></td>
            <td>
                <div class="table-actions">
                    <button class="btn btn-sm btn-light btn-icon view-loan-btn" data-id="${loan.id}" title="Ver detalle">
                        <i class="fas fa-eye"></i>
                    </button>
                    ${loan.status === 'active' ? `
                    <button class="btn btn-sm btn-success btn-icon return-loan-btn" data-id="${loan.id}" title="Marcar como devuelto">
                        <i class="fas fa-check"></i>
                    </button>
                    ` : ''}
                    <button class="btn btn-sm btn-danger btn-icon delete-loan-btn" data-id="${loan.id}" title="Eliminar">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
                tbody.appendChild(tr);
            });

            // Agregar eventos a los botones
            tbody.querySelectorAll('.view-loan-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const loanId = parseInt(this.dataset.id);
                    viewLoanDetails(loanId);
                });
            });

            tbody.querySelectorAll('.return-loan-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const loanId = parseInt(this.dataset.id);
                    returnLoan(loanId);
                });
            });

            tbody.querySelectorAll('.delete-loan-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const loanId = parseInt(this.dataset.id);
                    deleteLoan(loanId);
                });
            });

            // Actualizar terminal summary si está disponible
            updateTerminalLoansSummary();

            // Actualizar próximas devoluciones
            updateUpcomingReturns();

            // Inicializar gráfico de distribución de préstamos si estamos en esa sección
            if (currentSection === 'loans') {
                initializeLoansChart();
            }
        }

        /**
         * Actualiza el resumen de préstamos por terminal
         */
        function updateTerminalLoansSummary() {
            const terminalSummaryTable = document.getElementById('terminalSummaryTable');
            if (!terminalSummaryTable) return;

            const tbody = terminalSummaryTable.querySelector('tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            // Definir terminales
            const terminals = ['ER', 'LR', 'MA', 'ED'];
            const today = new Date();

            // Procesar datos
            terminals.forEach(terminal => {
                // Filtrar préstamos por terminal
                const terminalLoans = loans.filter(loan => {
                    const person = staff.find(s => s.id === loan.person_id);
                    return person && person.terminal === terminal;
                });

                // Contar préstamos activos
                const activeLoans = terminalLoans.filter(loan => loan.status === 'active').length;

                // Contar préstamos vencidos
                const overdueLoans = terminalLoans.filter(loan => {
                    if (loan.status !== 'active') return false;

                    const returnDate = new Date(loan.return_date);
                    return returnDate < today;
                }).length;

                // Calcular porcentaje de devolución a tiempo
                const returnedLoans = terminalLoans.filter(loan => loan.status === 'returned').length;
                const returnedOnTime = terminalLoans.filter(loan => {
                    if (loan.status !== 'returned') return false;

                    const returnDate = new Date(loan.return_date);
                    const actualReturnDate = new Date(loan.actual_return_date || loan.updated_at);

                    return actualReturnDate <= returnDate;
                }).length;

                const onTimePercentage = returnedLoans > 0
                    ? Math.round((returnedOnTime / returnedLoans) * 100)
                    : 0;

                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${getTerminalName(terminal)}</td>
            <td>${activeLoans}</td>
            <td>${terminalLoans.length}</td>
            <td>${overdueLoans}</td>
            <td>${onTimePercentage}%</td>
        `;
                tbody.appendChild(tr);
            });
        }

        /**
         * Actualiza la tabla de próximas devoluciones
         */
        function updateUpcomingReturns() {
            const upcomingReturnsTable = document.getElementById('upcomingReturnsTable');
            if (!upcomingReturnsTable) return;

            upcomingReturnsTable.innerHTML = '';

            // Fecha actual
            const today = new Date();

            // Filtrar préstamos activos ordenados por fecha de devolución
            const activeLoans = loans
                .filter(loan => loan.status === 'active')
                .sort((a, b) => new Date(a.return_date) - new Date(b.return_date));

            if (activeLoans.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="7" class="text-center">No hay préstamos activos</td>';
                upcomingReturnsTable.appendChild(tr);
                return;
            }

            // Mostrar los próximos 5 préstamos
            activeLoans.slice(0, 5).forEach(loan => {
                const item = inventory.find(i => i.id === loan.item_id) || { name: 'Desconocido' };
                const person = staff.find(s => s.id === loan.person_id) || { name: 'Desconocido', terminal: 'desconocido' };

                // Calcular tiempo restante
                const returnDate = new Date(loan.return_date);
                const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                let timeRemainingText = '';
                let timeRemainingClass = '';

                if (daysRemaining < 0) {
                    timeRemainingText = `${Math.abs(daysRemaining)} días de retraso`;
                    timeRemainingClass = 'low-stock';
                } else if (daysRemaining === 0) {
                    timeRemainingText = 'Hoy';
                    timeRemainingClass = 'low-stock';
                } else if (daysRemaining === 1) {
                    timeRemainingText = 'Mañana';
                    timeRemainingClass = '';
                } else {
                    timeRemainingText = `${daysRemaining} días`;
                    timeRemainingClass = '';
                }

                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${loan.id}</td>
            <td>${item.name}</td>
            <td>${person.name}</td>
            <td>${getTerminalName(person.terminal)}</td>
            <td>${formatDate(loan.return_date)}</td>
            <td class="${timeRemainingClass}">${timeRemainingText}</td>
            <td>
                <button class="btn btn-sm btn-success return-loan-btn" data-id="${loan.id}">
                    <i class="fas fa-check"></i> Devolver
                </button>
                <button class="btn btn-sm btn-warning extend-loan-btn" data-id="${loan.id}">
                    <i class="fas fa-clock"></i> Extender
                </button>
            </td>
        `;
                upcomingReturnsTable.appendChild(tr);
            });

            // Agregar eventos a los botones
            upcomingReturnsTable.querySelectorAll('.return-loan-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const loanId = parseInt(this.dataset.id);
                    returnLoan(loanId);
                });
            });

            upcomingReturnsTable.querySelectorAll('.extend-loan-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const loanId = parseInt(this.dataset.id);
                    extendLoan(loanId);
                });
            });
        }

        /**
         * Renderiza la tabla de alertas
         */
        function renderAlertsTable() {
            // Tabla de alertas activas
            const activeAlertsTable = document.getElementById('activeAlertsTable');
            if (activeAlertsTable) {
                const tbody = activeAlertsTable.querySelector('tbody');
                if (tbody) {
                    tbody.innerHTML = '';

                    // Filtrar alertas activas
                    const activeAlerts = alerts.filter(a => a.status === 'active');

                    if (activeAlerts.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = '<td colspan="5" class="text-center">No hay alertas activas</td>';
                        tbody.appendChild(tr);
                    } else {
                        activeAlerts.forEach(alert => {
                            const tr = document.createElement('tr');
                            let priorityBadge = '';

                            if (alert.priority === 'high') {
                                priorityBadge = '<span class="badge badge-danger">Alta</span>';
                            } else if (alert.priority === 'medium') {
                                priorityBadge = '<span class="badge badge-warning">Media</span>';
                            } else {
                                priorityBadge = '<span class="badge badge-info">Baja</span>';
                            }

                            tr.innerHTML = `
                        <td>${formatDate(alert.date)}</td>
                        <td>${getAlertTypeName(alert.type)}</td>
                        <td>${alert.description}</td>
                        <td>${priorityBadge}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-success resolve-alert-btn" data-id="${alert.id}" title="Resolver">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-alert-btn" data-id="${alert.id}" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                            tbody.appendChild(tr);
                        });

                        // Agregar eventos a los botones
                        tbody.querySelectorAll('.resolve-alert-btn').forEach(btn => {
                            btn.addEventListener('click', function () {
                                const alertId = parseInt(this.dataset.id);
                                resolveAlert(alertId);
                            });
                        });

                        tbody.querySelectorAll('.delete-alert-btn').forEach(btn => {
                            btn.addEventListener('click', function () {
                                const alertId = parseInt(this.dataset.id);
                                deleteAlert(alertId);
                            });
                        });
                    }
                }
            }

            // Tabla de historial de alertas
            const alertsHistoryTable = document.getElementById('alertsHistoryTable');
            if (alertsHistoryTable) {
                const tbody = alertsHistoryTable.querySelector('tbody');
                if (tbody) {
                    tbody.innerHTML = '';

                    if (alerts.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = '<td colspan="5" class="text-center">No hay historial de alertas</td>';
                        tbody.appendChild(tr);
                    } else {
                        alerts.forEach(alert => {
                            const tr = document.createElement('tr');
                            const statusBadge = alert.status === 'active'
                                ? '<span class="badge badge-warning">Activa</span>'
                                : '<span class="badge badge-success">Resuelta</span>';

                            tr.innerHTML = `
                        <td>${formatDate(alert.date)}</td>
                        <td>${getAlertTypeName(alert.type)}</td>
                        <td>${alert.description}</td>
                        <td>${statusBadge}</td>
                        <td>${alert.resolution || '-'}</td>
                    `;
                            tbody.appendChild(tr);
                        });
                    }
                }
            }

            // Tabla de alertas de stock bajo
            renderLowStockAlerts();

            // Tabla de préstamos por vencer
            renderLoanDueAlerts();

            // Inicializar gráfico de distribución de alertas si estamos en esa sección
            if (currentSection === 'alerts') {
                initializeAlertsChart();
            }

            // Actualizar contador de alertas
            updateAlertCount();
        }

        /**
         * Renderiza la tabla de alertas de stock bajo
         */
        function renderLowStockAlerts() {
            const alertsLowStockTable = document.getElementById('alertsLowStockTable');
            if (!alertsLowStockTable) return;

            const tbody = alertsLowStockTable.querySelector('tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            // Filtrar artículos con stock bajo
            const lowStockItems = inventory.filter(item =>
                item.stock < (item.min_stock || 10)
            );

            if (lowStockItems.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="6" class="text-center">No hay artículos con stock bajo</td>';
                tbody.appendChild(tr);
                return;
            }

            // Renderizar filas
            lowStockItems.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${item.code || 'N/A'}</td>
            <td class="low-stock">${item.name || 'Sin nombre'}</td>
            <td>${getCategoryName(item.category)}</td>
            <td class="low-stock">${item.stock}</td>
            <td>${item.min_stock || 10}</td>
            <td>
                <button class="btn btn-sm btn-warning request-item-btn" data-id="${item.id}">
                    <i class="fas fa-shopping-cart"></i> Solicitar
                </button>
            </td>
        `;
                tbody.appendChild(tr);
            });

            // Agregar eventos a los botones
            tbody.querySelectorAll('.request-item-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const itemId = parseInt(this.dataset.id);
                    requestItem(itemId);
                });
            });
        }

        /**
         * Renderiza la tabla de préstamos por vencer
         */
        function renderLoanDueAlerts() {
            const alertsLoansTable = document.getElementById('alertsLoansTable');
            if (!alertsLoansTable) return;

            const tbody = alertsLoansTable.querySelector('tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            // Fecha actual
            const today = new Date();

            // Filtrar préstamos por vencer o vencidos
            const dueLoans = loans.filter(loan => {
                if (loan.status !== 'active') return false;

                const returnDate = new Date(loan.return_date);
                const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                return daysRemaining <= 5; // Mostrar préstamos que vencen en 5 días o menos, o ya vencidos
            }).sort((a, b) => new Date(a.return_date) - new Date(b.return_date));

            if (dueLoans.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="7" class="text-center">No hay préstamos por vencer</td>';
                tbody.appendChild(tr);
                return;
            }

            // Renderizar filas
            dueLoans.forEach(loan => {
                const item = inventory.find(i => i.id === loan.item_id) || { name: 'Desconocido' };
                const person = staff.find(s => s.id === loan.person_id) || { name: 'Desconocido', terminal: 'desconocido' };

                // Calcular días restantes
                const returnDate = new Date(loan.return_date);
                const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                let daysText = '';

                if (daysRemaining < 0) {
                    daysText = `<span class="low-stock">${Math.abs(daysRemaining)} días de retraso</span>`;
                } else if (daysRemaining === 0) {
                    daysText = '<span class="low-stock">Vence hoy</span>';
                } else if (daysRemaining === 1) {
                    daysText = '1 día';
                } else {
                    daysText = `${daysRemaining} días`;
                }

                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${loan.id}</td>
            <td>${item.name}</td>
            <td>${person.name}</td>
            <td>${getTerminalName(person.terminal)}</td>
            <td>${formatDate(loan.return_date)}</td>
            <td>${daysText}</td>
            <td>
                <button class="btn btn-sm btn-success return-loan-btn" data-id="${loan.id}">
                    <i class="fas fa-check"></i> Devolver
                </button>
                <button class="btn btn-sm btn-warning extend-loan-btn" data-id="${loan.id}">
                    <i class="fas fa-clock"></i> Extender
                </button>
            </td>
        `;
                tbody.appendChild(tr);
            });

            // Agregar eventos a los botones
            tbody.querySelectorAll('.return-loan-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const loanId = parseInt(this.dataset.id);
                    returnLoan(loanId);
                });
            });

            tbody.querySelectorAll('.extend-loan-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const loanId = parseInt(this.dataset.id);
                    extendLoan(loanId);
                });
            });
        }

        /**
         * Rellena los selectores de artículos en los formularios
         */
        function populateItemSelectors() {
            const itemSelectors = document.querySelectorAll('select[id^="item"], select[id^="transItem"], select[id^="loanItem"]');

            itemSelectors.forEach(selector => {
                const currentValue = selector.value;
                selector.innerHTML = '<option value="">Seleccionar artículo</option>';

                inventory.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.code} - ${item.name} (${item.stock})`;

                    // Marcar artículos con stock bajo
                    if (item.stock < (item.min_stock || 10)) {
                        option.style.color = '#ef4444';
                        option.style.fontWeight = '500';
                    }

                    selector.appendChild(option);
                });

                // Restaurar valor seleccionado si existía
                if (currentValue) {
                    selector.value = currentValue;
                }
            });
        }

        /**
         * Rellena los selectores de personal en los formularios
         */
        function populatePersonSelector() {
            const personSelectors = document.querySelectorAll('select[id^="transactionPerson"], select[id^="loanPerson"], select[id^="personSummarySelect"]');

            personSelectors.forEach(selector => {
                const currentValue = selector.value;
                selector.innerHTML = '<option value="">Seleccionar persona</option>';

                staff.forEach(person => {
                    const option = document.createElement('option');
                    option.value = person.id;
                    option.textContent = `${person.name} - ${getCategoryName(person.role)}`;
                    selector.appendChild(option);
                });

                // Restaurar valor seleccionado si existía
                if (currentValue) {
                    selector.value = currentValue;
                }
            });
        }

        // =============== GESTIÓN DE FORMULARIOS Y VALIDACIÓN ===============

        /**
         * Abre el modal de nuevo artículo
         * @param {number} itemId - ID del artículo a editar (opcional)
         */
        function openNewItemModal(itemId = null) {
            const modal = document.getElementById('newItemModal');
            if (!modal) return;

            // Resetear formulario
            const form = document.getElementById('newItemForm');
            if (form) form.reset();

            // Cambiar título según modo
            const modalTitle = modal.querySelector('.modal-title');
            if (modalTitle) {
                modalTitle.textContent = itemId ? 'Editar Artículo' : 'Nuevo Artículo';
            }

            // Si es edición, cargar datos del artículo
            if (itemId) {
                const item = inventory.find(i => i.id === itemId);
                if (item) {
                    document.getElementById('itemCode').value = item.code || '';
                    document.getElementById('itemName').value = item.name || '';
                    document.getElementById('itemCategory').value = item.category || '';
                    document.getElementById('itemStock').value = item.stock || 0;
                    document.getElementById('itemMinStock').value = item.min_stock || 10;
                    document.getElementById('itemLifeCycle').value = item.life_cycle || 'indefinite';
                    document.getElementById('itemDescription').value = item.description || '';

                    // Guardar ID para identificar que estamos editando
                    const saveBtn = document.getElementById('saveNewItemBtn');
                    if (saveBtn) saveBtn.dataset.itemId = itemId;
                }
            } else {
                // Limpiar ID si es nuevo
                const saveBtn = document.getElementById('saveNewItemBtn');
                if (saveBtn) saveBtn.dataset.itemId = '';
            }

            // Mostrar modal
            modal.classList.add('active');
        }

        /**
         * Guarda o actualiza un artículo
         */
        async function saveItem() {
            toggleLoader(true);

            try {
                // Obtener ID si estamos editando
                const saveBtn = document.getElementById('saveNewItemBtn');
                const itemId = saveBtn ? saveBtn.dataset.itemId : null;
                const isEditing = !!itemId;

                // Recopilar datos del formulario
                const itemData = {
                    code: document.getElementById('itemCode').value,
                    name: document.getElementById('itemName').value,
                    category: document.getElementById('itemCategory').value,
                    stock: parseInt(document.getElementById('itemStock').value),
                    min_stock: parseInt(document.getElementById('itemMinStock').value),
                    life_cycle: document.getElementById('itemLifeCycle').value,
                    description: document.getElementById('itemDescription').value,
                    updated_at: new Date().toISOString()
                };

                // Validar datos
                if (!itemData.code || !itemData.name || !itemData.category) {
                    throw new Error('Todos los campos son obligatorios');
                }

                if (isNaN(itemData.stock) || isNaN(itemData.min_stock)) {
                    throw new Error('Los valores de stock deben ser numéricos');
                }

                // Si estamos online, guardar en Supabase
                if (isOnline && supabase) {
                    let result;

                    if (isEditing) {
                        // Actualizar artículo existente
                        const { data, error } = await supabase
                            .from('superstore_items')
                            .update(itemData)
                            .eq('id', itemId)
                            .select();

                        if (error) throw error;
                        result = data;

                        // Actualizar en el array local
                        const index = inventory.findIndex(i => i.id === parseInt(itemId));
                        if (index !== -1) {
                            inventory[index] = { ...inventory[index], ...itemData };
                        }
                    } else {
                        // Crear nuevo artículo
                        const { data, error } = await supabase
                            .from('superstore_items')
                            .insert([itemData])
                            .select();

                        if (error) throw error;
                        result = data;

                        // Añadir al array local
                        if (data && data.length > 0) {
                            inventory.push(data[0]);
                        }
                    }
                } else {
                    // Modo offline: actualizar en memoria y localStorage
                    if (isEditing) {
                        // Actualizar artículo existente
                        const index = inventory.findIndex(i => i.id === parseInt(itemId));
                        if (index !== -1) {
                            inventory[index] = {
                                ...inventory[index],
                                ...itemData
                            };
                        }
                    } else {
                        // Crear nuevo artículo con ID temporal
                        const newItem = {
                            id: generateUniqueId(),
                            ...itemData,
                            created_at: new Date().toISOString()
                        };
                        inventory.push(newItem);
                    }

                    // Guardar en localStorage
                    saveDataToLocalStorage();
                }

                // Cerrar modal
                const modal = document.getElementById('newItemModal');
                if (modal) modal.classList.remove('active');

                // Actualizar interfaz
                renderInventoryTable();
                updateDashboard();
                updateLowStockTable();
                initializeCharts();

                showNotification(
                    isEditing ? 'Artículo actualizado correctamente' : 'Artículo creado correctamente',
                    'success'
                );
            } catch (error) {
                console.error('Error al guardar artículo:', error);
                showNotification(`Error: ${error.message || 'Error al guardar el artículo'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Elimina un artículo
         * @param {number} itemId - ID del artículo a eliminar
         */
        async function deleteItem(itemId) {
            if (!confirm('¿Está seguro de eliminar este artículo? Esta acción no se puede deshacer.')) {
                return;
            }

            toggleLoader(true);

            try {
                // Comprobar si hay transacciones o préstamos asociados
                const hasTransactions = transactions.some(t => t.item_id === itemId);
                const hasLoans = loans.some(l => l.item_id === itemId);

                if (hasTransactions || hasLoans) {
                    if (!confirm('Este artículo tiene transacciones o préstamos asociados. Si lo elimina, esas relaciones se perderán. ¿Desea continuar?')) {
                        toggleLoader(false);
                        return;
                    }
                }

                // Si estamos online, eliminar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_items')
                        .delete()
                        .eq('id', itemId);

                    if (error) throw error;
                }

                // Eliminar en memoria
                inventory = inventory.filter(i => i.id !== itemId);

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                renderInventoryTable();
                updateDashboard();
                updateLowStockTable();
                initializeCharts();

                showNotification('Artículo eliminado correctamente', 'success');
            } catch (error) {
                console.error('Error al eliminar artículo:', error);
                showNotification(`Error: ${error.message || 'Error al eliminar el artículo'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Abre el modal para ver detalles de un artículo
         * @param {number} itemId - ID del artículo
         */
        function viewItemDetails(itemId) {
            const item = inventory.find(i => i.id === itemId);
            if (!item) {
                showNotification('Artículo no encontrado', 'danger');
                return;
            }

            // Obtener transacciones del artículo
            const itemTransactions = transactions
                .filter(t => t.item_id === itemId)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            // Generar tabla de transacciones HTML
            let transactionsHTML = '';
            if (itemTransactions.length === 0) {
                transactionsHTML = '<tr><td colspan="4" class="text-center">No hay movimientos registrados</td></tr>';
            } else {
                transactionsHTML = itemTransactions.map(t => {
                    const person = staff.find(s => s.id === t.person_id) || { name: 'Desconocido' };
                    return `
                <tr>
                    <td>${formatDate(t.date)}</td>
                    <td>
                        <span class="badge ${t.type === 'in' ? 'badge-success' : 'badge-primary'}">
                            ${t.type === 'in' ? 'Ingreso' : 'Entrega'}
                        </span>
                    </td>
                    <td>${t.quantity}</td>
                    <td>${person.name}</td>
                </tr>
            `;
                }).join('');
            }

            // Crear modal HTML
            const modalHTML = `
    <div class="modal-backdrop active" id="itemDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Detalles del Artículo</h3>
                <button class="close-modal" id="closeItemDetailsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Código</label>
                        <div class="form-control">${item.code || 'N/A'}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nombre</label>
                        <div class="form-control">${item.name || 'Sin nombre'}</div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Categoría</label>
                        <div class="form-control">${getCategoryName(item.category)}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Período de Vida</label>
                        <div class="form-control">${getLifeCycleName(item.life_cycle)}</div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Stock Actual</label>
                        <div class="form-control ${item.stock < (item.min_stock || 10) ? 'low-stock' : ''}">${item.stock} unidades</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Stock Mínimo</label>
                        <div class="form-control">${item.min_stock || 10} unidades</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Última Actualización</label>
                    <div class="form-control">${formatDate(item.updated_at)}</div>
                </div>
                ${item.description ? `
                <div class="form-group">
                    <label class="form-label">Descripción</label>
                    <div class="form-control">${item.description}</div>
                </div>
                ` : ''}
                
                <!-- Historial de movimientos -->
                <h4 class="mt-4 mb-2">Últimos Movimientos</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Responsable</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${transactionsHTML}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="closeItemDetailsBtn">Cerrar</button>
                <button class="btn btn-primary" id="editThisItemBtn" data-id="${item.id}">Editar</button>
            </div>
        </div>
    </div>
    `;

            // Insertar modal en el DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Agregar eventos
            document.getElementById('closeItemDetailsModal').addEventListener('click', function () {
                document.getElementById('itemDetailsModal').remove();
            });

            document.getElementById('closeItemDetailsBtn').addEventListener('click', function () {
                document.getElementById('itemDetailsModal').remove();
            });

            document.getElementById('editThisItemBtn').addEventListener('click', function () {
                const itemId = parseInt(this.dataset.id);
                document.getElementById('itemDetailsModal').remove();
                openNewItemModal(itemId);
            });
        }

        /**
         * Edita un artículo existente
         * @param {number} itemId - ID del artículo a editar
         */
        function editItem(itemId) {
            openNewItemModal(itemId);
        }

        /**
         * Abre el modal de nueva transacción
         */
        function openNewTransactionModal() {
            const modal = document.getElementById('newTransactionModal');
            if (!modal) return;

            // Resetear formulario
            const form = document.getElementById('newTransactionForm');
            if (form) form.reset();

            // Establecer fecha actual
            const now = new Date();
            const dateTimeString = now.toISOString().slice(0, 16);
            const dateInput = document.getElementById('transactionDate');
            if (dateInput) dateInput.value = dateTimeString;

            // Limpiar filas de artículos excepto la primera
            const transactionItems = document.getElementById('transactionItems');
            if (transactionItems) {
                const rows = transactionItems.querySelectorAll('.form-row');
                for (let i = 1; i < rows.length; i++) {
                    rows[i].remove();
                }
            }

            // Actualizar selectores
            populateItemSelectors();
            populatePersonSelector();

            // Mostrar modal
            modal.classList.add('active');
        }

        /**
         * Agrega una fila de artículo al formulario de transacción
         */
        function addTransactionItemRow() {
            const transactionItems = document.getElementById('transactionItems');
            if (!transactionItems) return;

            const rowCount = transactionItems.querySelectorAll('.form-row').length + 1;

            const rowHTML = `
    <div class="form-row">
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label" for="transItem${rowCount}">Artículo</label>
                <select id="transItem${rowCount}" class="form-control form-select transaction-item" required>
                    <option value="">Seleccionar artículo</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="transQuantity${rowCount}">Cantidad</label>
                <input type="number" id="transQuantity${rowCount}" class="form-control" min="1" value="1" required>
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-danger btn-icon remove-item-btn" style="margin-top: 32px;" title="Eliminar fila">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </div>
    `;

            transactionItems.insertAdjacentHTML('beforeend', rowHTML);

            // Llenar el selector de artículos
            populateItemSelectors();

            // Agregar evento para eliminar fila
            const removeBtn = transactionItems.querySelector(`.form-row:last-child .remove-item-btn`);
            removeBtn.addEventListener('click', function () {
                this.closest('.form-row').remove();
            });
        }

        /**
         * Guarda una nueva transacción
         */
        async function saveTransaction() {
            toggleLoader(true);

            try {
                const transactionType = document.getElementById('transactionType').value;
                const transactionDate = document.getElementById('transactionDate').value;
                const personId = parseInt(document.getElementById('transactionPerson').value);
                const notes = document.getElementById('transactionNotes').value;

                // Validaciones
                if (!transactionDate) {
                    throw new Error('La fecha es obligatoria');
                }

                if (!personId) {
                    throw new Error('Debe seleccionar un responsable');
                }

                // Recopilar artículos
                const items = [];
                const transactionItems = document.querySelectorAll('.transaction-item');

                transactionItems.forEach((item, index) => {
                    const itemId = parseInt(item.value);
                    const quantityId = `transQuantity${index + 1}`;
                    const quantity = parseInt(document.getElementById(quantityId).value);

                    if (itemId && quantity > 0) {
                        items.push({
                            item_id: itemId,
                            quantity: quantity
                        });
                    }
                });

                if (items.length === 0) {
                    throw new Error('Debe seleccionar al menos un artículo');
                }

                // Validar stock suficiente para entregas
                if (transactionType === 'out') {
                    for (const item of items) {
                        const inventoryItem = inventory.find(i => i.id === item.item_id);
                        if (inventoryItem && inventoryItem.stock < item.quantity) {
                            throw new Error(`Stock insuficiente para ${inventoryItem.name}. Disponible: ${inventoryItem.stock}`);
                        }
                    }
                }

                // Crear transacciones
                const transactionsData = items.map(item => ({
                    date: new Date(transactionDate).toISOString(),
                    type: transactionType,
                    item_id: item.item_id,
                    quantity: item.quantity,
                    person_id: personId,
                    notes: notes,
                    created_at: new Date().toISOString()
                }));

                // Si estamos online, guardar en Supabase
                if (isOnline && supabase) {
                    // Insertar transacciones
                    const { data, error } = await supabase
                        .from('superstore_transactions')
                        .insert(transactionsData)
                        .select();

                    if (error) throw error;

                    // Actualizar stock de artículos
                    for (const item of items) {
                        const inventoryItem = inventory.find(i => i.id === item.item_id);
                        if (inventoryItem) {
                            let newStock = inventoryItem.stock;

                            if (transactionType === 'out') {
                                // Descontar stock
                                newStock -= item.quantity;
                            } else { // in
                                // Aumentar stock
                                newStock += item.quantity;
                            }

                            // Actualizar en Supabase
                            await supabase
                                .from('superstore_items')
                                .update({
                                    stock: newStock,
                                    updated_at: new Date().toISOString()
                                })
                                .eq('id', item.item_id);

                            // Actualizar en memoria
                            inventoryItem.stock = newStock;
                            inventoryItem.updated_at = new Date().toISOString();
                        }
                    }

                    // Actualizar datos en memoria
                    if (data && data.length > 0) {
                        transactions = [...data, ...transactions];
                    }
                } else {
                    // Modo offline: actualizar en memoria y localStorage
                    const newTransactions = transactionsData.map(t => ({
                        ...t,
                        id: generateUniqueId()
                    }));

                    transactions = [...newTransactions, ...transactions];

                    // Actualizar stock
                    for (const item of items) {
                        const inventoryItem = inventory.find(i => i.id === item.item_id);
                        if (inventoryItem) {
                            if (transactionType === 'out') {
                                inventoryItem.stock -= item.quantity;
                            } else { // in
                                inventoryItem.stock += item.quantity;
                            }
                            inventoryItem.updated_at = new Date().toISOString();
                        }
                    }

                    // Guardar en localStorage
                    saveDataToLocalStorage();
                }

                // Cerrar modal
                const modal = document.getElementById('newTransactionModal');
                if (modal) modal.classList.remove('active');

                // Actualizar interfaz
                renderTransactionsTable();
                renderInventoryTable();
                updateDashboard();
                initializeCharts();

                showNotification('Transacción guardada correctamente', 'success');
            } catch (error) {
                console.error('Error al guardar transacción:', error);
                showNotification(`Error: ${error.message || 'Error al guardar la transacción'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Visualiza los detalles de una transacción
         * @param {number} transactionId - ID de la transacción
         */
        function viewTransactionDetails(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) {
                showNotification('Transacción no encontrada', 'danger');
                return;
            }

            const item = inventory.find(i => i.id === transaction.item_id) || { name: 'Desconocido' };
            const person = staff.find(s => s.id === transaction.person_id) || { name: 'Desconocido', role: 'unknown', terminal: 'unknown' };

            // Crear modal HTML
            const modalHTML = `
    <div class="modal-backdrop active" id="transactionDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Detalles de la Transacción</h3>
                <button class="close-modal" id="closeTransactionDetailsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert ${transaction.type === 'in' ? 'alert-success' : 'alert-primary'}">
                    <div class="alert-icon">
                        <i class="fas ${transaction.type === 'in' ? 'fa-arrow-down' : 'fa-arrow-up'}"></i>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">${transaction.type === 'in' ? 'Ingreso' : 'Entrega'} de Artículo</div>
                        <div>Transacción #${transaction.id}</div>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Fecha</label>
                        <div class="form-control">${formatDate(transaction.date)}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Artículo</label>
                        <div class="form-control">${item.name} (${item.code || 'Sin código'})</div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Cantidad</label>
                        <div class="form-control">${transaction.quantity}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Responsable</label>
                        <div class="form-control">${person.name}</div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Cargo</label>
                        <div class="form-control">${getCategoryName(person.role)}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Terminal</label>
                        <div class="form-control">${getTerminalName(person.terminal)}</div>
                    </div>
                </div>
                ${transaction.notes ? `
                <div class="form-group">
                    <label class="form-label">Observaciones</label>
                    <div class="form-control">${transaction.notes}</div>
                </div>
                ` : ''}
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="closeTransactionDetailsBtn">Cerrar</button>
                <button class="btn btn-danger" id="deleteThisTransactionBtn" data-id="${transaction.id}">Eliminar</button>
            </div>
        </div>
    </div>
    `;

            // Insertar modal en el DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Agregar eventos
            document.getElementById('closeTransactionDetailsModal').addEventListener('click', function () {
                document.getElementById('transactionDetailsModal').remove();
            });

            document.getElementById('closeTransactionDetailsBtn').addEventListener('click', function () {
                document.getElementById('transactionDetailsModal').remove();
            });

            document.getElementById('deleteThisTransactionBtn').addEventListener('click', function () {
                const transactionId = parseInt(this.dataset.id);
                document.getElementById('transactionDetailsModal').remove();
                deleteTransaction(transactionId);
            });
        }

        /**
         * Elimina una transacción
         * @param {number} transactionId - ID de la transacción a eliminar
         */
        async function deleteTransaction(transactionId) {
            if (!confirm('¿Está seguro de eliminar esta transacción? Esta acción no se puede deshacer.')) {
                return;
            }

            toggleLoader(true);

            try {
                // Obtener la transacción antes de eliminarla
                const transaction = transactions.find(t => t.id === transactionId);
                if (!transaction) {
                    throw new Error('Transacción no encontrada');
                }

                // Si estamos online, eliminar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_transactions')
                        .delete()
                        .eq('id', transactionId);

                    if (error) throw error;

                    // Actualizar stock del artículo
                    const item = inventory.find(i => i.id === transaction.item_id);
                    if (item) {
                        let newStock = item.stock;

                        // Si era entrega, devolver stock; si era ingreso, restar stock
                        if (transaction.type === 'out') {
                            newStock += transaction.quantity;
                        } else { // in
                            newStock = Math.max(0, newStock - transaction.quantity);
                        }

                        // Actualizar en Supabase
                        await supabase
                            .from('superstore_items')
                            .update({
                                stock: newStock,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', item.id);

                        // Actualizar en memoria
                        item.stock = newStock;
                        item.updated_at = new Date().toISOString();
                    }
                }

                // Actualizar stock en memoria
                const item = inventory.find(i => i.id === transaction.item_id);
                if (item) {
                    if (transaction.type === 'out') {
                        item.stock += transaction.quantity;
                    } else { // in
                        item.stock = Math.max(0, item.stock - transaction.quantity);
                    }
                    item.updated_at = new Date().toISOString();
                }

                // Eliminar de la lista de transacciones
                transactions = transactions.filter(t => t.id !== transactionId);

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                renderTransactionsTable();
                renderInventoryTable();
                updateDashboard();
                initializeCharts();

                showNotification('Transacción eliminada correctamente', 'success');
            } catch (error) {
                console.error('Error al eliminar transacción:', error);
                showNotification(`Error: ${error.message || 'Error al eliminar la transacción'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Abre el modal de nuevo personal
         * @param {number} staffId - ID del personal a editar (opcional)
         */
        /**
         * Abre el modal de nuevo personal
         * @param {number} staffId - ID del personal a editar (opcional)
         */
        function openNewStaffModal(staffId = null) {
            const modal = document.getElementById('newStaffModal');
            if (!modal) return;

            // Resetear formulario
            const form = document.getElementById('newStaffForm');
            if (form) form.reset();

            // Cambiar título según modo
            const modalTitle = modal.querySelector('.modal-title');
            if (modalTitle) {
                modalTitle.textContent = staffId ? 'Editar Personal' : 'Nuevo Personal';
            }

            // Si es edición, cargar datos del personal
            if (staffId) {
                const person = staff.find(s => s.id === staffId);
                if (person) {
                    document.getElementById('staffName').value = person.name || '';
                    document.getElementById('staffRole').value = person.role || '';
                    document.getElementById('staffTerminal').value = person.terminal || '';
                    document.getElementById('staffContact').value = person.contact || '';
                    document.getElementById('staffId').value = person.staff_id || '';
                    // Omitimos la asignación del start_date
                    document.getElementById('staffNotes').value = person.notes || '';

                    // Guardar ID para identificar que estamos editando
                    const saveBtn = document.getElementById('saveNewStaffBtn');
                    if (saveBtn) saveBtn.dataset.staffId = staffId;
                }
            } else {
                // Limpiar ID si es nuevo
                const saveBtn = document.getElementById('saveNewStaffBtn');
                if (saveBtn) saveBtn.dataset.staffId = '';
            }

            // Mostrar modal
            modal.classList.add('active');
        }

        /**
         * Guarda o actualiza un miembro del personal
         */
        /**
         * Guarda o actualiza un miembro del personal
         */
        /**
         * Guarda o actualiza un miembro del personal
         */
        async function saveStaff() {
            toggleLoader(true);

            try {
                // Obtener ID si estamos editando
                const saveBtn = document.getElementById('saveNewStaffBtn');
                const staffId = saveBtn ? saveBtn.dataset.staffId : null;
                const isEditing = !!staffId;

                // Recopilar datos del formulario
                const staffData = {
                    name: document.getElementById('staffName').value,
                    role: document.getElementById('staffRole').value,
                    terminal: document.getElementById('staffTerminal').value,
                    contact: document.getElementById('staffContact').value,
                    staff_id: document.getElementById('staffId').value,
                    notes: document.getElementById('staffNotes').value
                    // Removed updated_at field since it doesn't exist in the table
                };

                // Validar datos
                if (!staffData.name || !staffData.role || !staffData.terminal) {
                    throw new Error('El nombre, cargo y terminal son obligatorios');
                }

                // Si estamos online, guardar en Supabase
                if (isOnline && supabase) {
                    let result;

                    if (isEditing) {
                        // Actualizar personal existente
                        const { data, error } = await supabase
                            .from('superstore_staff')
                            .update(staffData)
                            .eq('id', staffId)
                            .select();

                        if (error) throw error;
                        result = data;

                        // Actualizar en el array local
                        const index = staff.findIndex(s => s.id === parseInt(staffId));
                        if (index !== -1) {
                            staff[index] = { ...staff[index], ...staffData };
                        }
                    } else {
                        // Crear nuevo personal
                        const { data, error } = await supabase
                            .from('superstore_staff')
                            .insert([staffData])
                            .select();

                        if (error) throw error;
                        result = data;

                        // Añadir al array local
                        if (data && data.length > 0) {
                            staff.push(data[0]);
                        }
                    }
                } else {
                    // Modo offline: actualizar en memoria y localStorage
                    if (isEditing) {
                        // Actualizar personal existente
                        const index = staff.findIndex(s => s.id === parseInt(staffId));
                        if (index !== -1) {
                            staff[index] = {
                                ...staff[index],
                                ...staffData
                            };
                        }
                    } else {
                        // Crear nuevo personal con ID temporal
                        const newStaff = {
                            id: generateUniqueId(),
                            ...staffData,
                            created_at: new Date().toISOString()
                        };
                        staff.push(newStaff);
                    }

                    // Guardar en localStorage
                    saveDataToLocalStorage();
                }

                // Cerrar modal
                const modal = document.getElementById('newStaffModal');
                if (modal) modal.classList.remove('active');

                // Actualizar interfaz
                renderStaffTable();
                populatePersonSelector();

                showNotification(
                    isEditing ? 'Personal actualizado correctamente' : 'Personal creado correctamente',
                    'success'
                );
            } catch (error) {
                console.error('Error al guardar personal:', error);
                showNotification(`Error: ${error.message || 'Error al guardar el personal'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }


        /**
         * Elimina un miembro del personal
         * @param {number} staffId - ID del personal a eliminar
         */
        async function deleteStaff(staffId) {
            if (!confirm('¿Está seguro de eliminar este personal? Esta acción no se puede deshacer.')) {
                return;
            }

            toggleLoader(true);

            try {
                // Comprobar si hay transacciones o préstamos asociados
                const hasTransactions = transactions.some(t => t.person_id === staffId);
                const hasLoans = loans.some(l => l.person_id === staffId);

                if (hasTransactions || hasLoans) {
                    if (!confirm('Esta persona tiene transacciones o préstamos asociados. Si la elimina, esas relaciones se perderán. ¿Desea continuar?')) {
                        toggleLoader(false);
                        return;
                    }
                }

                // Si estamos online, eliminar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_staff')
                        .delete()
                        .eq('id', staffId);

                    if (error) throw error;
                }

                // Eliminar en memoria
                staff = staff.filter(s => s.id !== staffId);

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                renderStaffTable();
                populatePersonSelector();

                showNotification('Personal eliminado correctamente', 'success');
            } catch (error) {
                console.error('Error al eliminar personal:', error);
                showNotification(`Error: ${error.message || 'Error al eliminar el personal'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Abre el modal para ver detalles de personal
         * @param {number} staffId - ID del personal
         */
        function viewStaffDetails(staffId) {
            const person = staff.find(s => s.id === staffId);
            if (!person) {
                showNotification('Personal no encontrado', 'danger');
                return;
            }

            // Obtener transacciones asociadas al personal
            const personTransactions = transactions
                .filter(t => t.person_id === staffId)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            // Obtener préstamos asociados al personal
            const personLoans = loans
                .filter(l => l.person_id === staffId)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            // Generar tabla de transacciones HTML
            let transactionsHTML = '';
            if (personTransactions.length === 0) {
                transactionsHTML = '<tr><td colspan="4" class="text-center">No hay transacciones registradas</td></tr>';
            } else {
                transactionsHTML = personTransactions.map(t => {
                    const item = inventory.find(i => i.id === t.item_id) || { name: 'Desconocido' };
                    return `
                <tr>
                    <td>${formatDate(t.date)}</td>
                    <td>${item.name}</td>
                    <td>
                        <span class="badge ${t.type === 'in' ? 'badge-success' : 'badge-primary'}">
                            ${t.type === 'in' ? 'Ingreso' : 'Entrega'}
                        </span>
                    </td>
                    <td>${t.quantity}</td>
                </tr>
            `;
                }).join('');
            }

            // Generar tabla de préstamos HTML
            let loansHTML = '';
            if (personLoans.length === 0) {
                loansHTML = '<tr><td colspan="5" class="text-center">No hay préstamos registrados</td></tr>';
            } else {
                loansHTML = personLoans.map(l => {
                    const item = inventory.find(i => i.id === l.item_id) || { name: 'Desconocido' };

                    let statusBadge = '';
                    if (l.status === 'active') {
                        const today = new Date();
                        const returnDate = new Date(l.return_date);

                        if (returnDate < today) {
                            statusBadge = '<span class="badge badge-danger">Vencido</span>';
                        } else {
                            statusBadge = '<span class="badge badge-success">Activo</span>';
                        }
                    } else if (l.status === 'returned') {
                        statusBadge = '<span class="badge badge-info">Devuelto</span>';
                    }

                    return `
                <tr>
                    <td>${formatDate(l.date)}</td>
                    <td>${item.name}</td>
                    <td>${l.quantity}</td>
                    <td>${formatDate(l.return_date)}</td>
                    <td>${statusBadge}</td>
                </tr>
            `;
                }).join('');
            }

            // Crear modal HTML
            const modalHTML = `
    <div class="modal-backdrop active" id="staffDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Detalles del Personal</h3>
                <button class="close-modal" id="closeStaffDetailsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nombre</label>
                        <div class="form-control">${person.name || 'Sin nombre'}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ID de Empleado</label>
                        <div class="form-control">${person.staff_id || 'N/A'}</div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Cargo</label>
                        <div class="form-control">${getCategoryName(person.role)}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Terminal</label>
                        <div class="form-control">${getTerminalName(person.terminal)}</div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Contacto</label>
                        <div class="form-control">${person.contact || 'No disponible'}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fecha de Inicio</label>
                        <div class="form-control">${person.start_date ? formatDate(person.start_date) : 'No disponible'}</div>
                    </div>
                </div>
                ${person.notes ? `
                <div class="form-group">
                    <label class="form-label">Observaciones</label>
                    <div class="form-control">${person.notes}</div>
                </div>
                ` : ''}
                
                <!-- Tabs para transacciones y préstamos -->
                <div class="tabs" style="margin-top: 1.5rem;">
                    <div class="tab active" data-tab="transactions">Transacciones Recientes</div>
                    <div class="tab" data-tab="loans">Préstamos</div>
                </div>
                
                <!-- Transacciones -->
                <div class="tab-content active" id="transactions-tab">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Artículo</th>
                                    <th>Tipo</th>
                                    <th>Cantidad</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${transactionsHTML}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Préstamos -->
                <div class="tab-content" id="loans-tab" style="display: none;">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Artículo</th>
                                    <th>Cantidad</th>
                                    <th>Fecha Devolución</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${loansHTML}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="closeStaffDetailsBtn">Cerrar</button>
                <button class="btn btn-primary" id="editThisStaffBtn" data-id="${person.id}">Editar</button>
            </div>
        </div>
    </div>
    `;

            // Insertar modal en el DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Agregar eventos
            document.getElementById('closeStaffDetailsModal').addEventListener('click', function () {
                document.getElementById('staffDetailsModal').remove();
            });

            document.getElementById('closeStaffDetailsBtn').addEventListener('click', function () {
                document.getElementById('staffDetailsModal').remove();
            });

            document.getElementById('editThisStaffBtn').addEventListener('click', function () {
                const staffId = parseInt(this.dataset.id);
                document.getElementById('staffDetailsModal').remove();
                openNewStaffModal(staffId);
            });

            // Eventos para tabs
            const tabElements = document.querySelectorAll('#staffDetailsModal .tab');
            tabElements.forEach(tab => {
                tab.addEventListener('click', function () {
                    const tabName = this.dataset.tab;

                    // Actualizar tabs
                    tabElements.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    // Mostrar contenido correspondiente
                    document.querySelectorAll('#staffDetailsModal .tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    document.getElementById(`${tabName}-tab`).style.display = 'block';
                });
            });
        }

        /**
         * Abre el modal de nuevo préstamo
         */
        function openNewLoanModal() {
            const modal = document.getElementById('newLoanModal');
            if (!modal) return;

            // Resetear formulario
            const form = document.getElementById('newLoanForm');
            if (form) form.reset();

            // Establecer fecha actual
            const now = new Date();
            const dateTimeString = now.toISOString().slice(0, 16);
            const dateInput = document.getElementById('loanDate');
            if (dateInput) dateInput.value = dateTimeString;

            // Establecer fecha de devolución predeterminada (1 semana)
            const returnDate = new Date(now);
            returnDate.setDate(returnDate.getDate() + 7);
            const returnDateString = returnDate.toISOString().slice(0, 16);
            const returnDateInput = document.getElementById('loanReturnDate');
            if (returnDateInput) returnDateInput.value = returnDateString;

            // Actualizar selectores
            populateItemSelectors();
            populatePersonSelector();

            // Mostrar modal
            modal.classList.add('active');
        }

        /**
         * Guarda un nuevo préstamo
         */
        /**
  * Guarda un nuevo préstamo
  */
        async function saveLoan() {
            toggleLoader(true);

            try {
                const loanDate = document.getElementById('loanDate').value;
                const returnDate = document.getElementById('loanReturnDate').value;
                const personId = parseInt(document.getElementById('loanPerson').value);
                const itemId = parseInt(document.getElementById('loanItem').value);
                const quantity = parseInt(document.getElementById('loanQuantity').value);
                const notes = document.getElementById('loanNotes').value;
                const sendReminder = document.getElementById('loanSendReminder')?.checked || false;

                // Validaciones
                if (!loanDate || !returnDate) {
                    throw new Error('Las fechas son obligatorias');
                }

                if (!personId) {
                    throw new Error('Debe seleccionar un responsable');
                }

                if (!itemId) {
                    throw new Error('Debe seleccionar un artículo');
                }

                if (!quantity || quantity <= 0) {
                    throw new Error('La cantidad debe ser mayor que cero');
                }

                // Validar stock suficiente
                const inventoryItem = inventory.find(i => i.id === itemId);
                if (inventoryItem && inventoryItem.stock < quantity) {
                    throw new Error(`Stock insuficiente para ${inventoryItem.name}. Disponible: ${inventoryItem.stock}`);
                }

                // Crear datos del préstamo (versión completa para memoria)
                const loanData = {
                    date: new Date(loanDate).toISOString(),
                    return_date: new Date(returnDate).toISOString(),
                    person_id: personId,
                    item_id: itemId,
                    quantity: quantity,
                    notes: notes,
                    status: 'active',
                    send_reminder: sendReminder,
                    created_at: new Date().toISOString()
                };

                // Si estamos online, guardar en Supabase
                if (isOnline && supabase) {
                    // Crear versión compatible con la estructura de la base de datos
                    // Eliminamos el campo 'send_reminder' que no existe en la tabla
                    const supabaseLoanData = {
                        date: loanData.date,
                        return_date: loanData.return_date,
                        person_id: loanData.person_id,
                        item_id: loanData.item_id,
                        quantity: loanData.quantity,
                        notes: loanData.notes,
                        status: loanData.status,
                        created_at: loanData.created_at
                    };

                    // Insertar préstamo
                    const { data, error } = await supabase
                        .from('superstore_loans')
                        .insert([supabaseLoanData])
                        .select();

                    if (error) throw error;

                    // Actualizar stock de artículo
                    if (inventoryItem) {
                        const newStock = inventoryItem.stock - quantity;

                        // Actualizar en Supabase
                        await supabase
                            .from('superstore_items')
                            .update({
                                stock: newStock,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', itemId);

                        // Actualizar en memoria
                        inventoryItem.stock = newStock;
                        inventoryItem.updated_at = new Date().toISOString();
                    }

                    // Actualizar datos en memoria
                    if (data && data.length > 0) {
                        // Añadir el campo send_reminder que existe en memoria pero no en la BD
                        const completeData = data.map(item => ({
                            ...item,
                            send_reminder: sendReminder
                        }));
                        loans = [...completeData, ...loans];
                    }
                } else {
                    // Modo offline: actualizar en memoria y localStorage
                    const newLoan = {
                        ...loanData,
                        id: generateUniqueId()
                    };

                    loans = [newLoan, ...loans];

                    // Actualizar stock
                    if (inventoryItem) {
                        inventoryItem.stock -= quantity;
                        inventoryItem.updated_at = new Date().toISOString();
                    }

                    // Guardar en localStorage
                    saveDataToLocalStorage();
                }

                // Cerrar modal
                const modal = document.getElementById('newLoanModal');
                if (modal) modal.classList.remove('active');

                // Actualizar interfaz
                renderLoansTable();
                renderInventoryTable();
                updateDashboard();

                showNotification('Préstamo guardado correctamente', 'success');
            } catch (error) {
                console.error('Error al guardar préstamo:', error);
                showNotification(`Error: ${error.message || 'Error al guardar el préstamo'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Abre el modal para registrar devolución de préstamo
         * @param {number} loanId - ID del préstamo
         */
        function returnLoan(loanId) {
            const loan = loans.find(l => l.id === loanId);
            if (!loan) {
                showNotification('Préstamo no encontrado', 'danger');
                return;
            }

            const modal = document.getElementById('returnLoanModal');
            if (!modal) return;

            // Resetear formulario
            const form = document.getElementById('returnLoanForm');
            if (form) form.reset();

            // Establecer ID del préstamo
            document.getElementById('returnLoanId').value = loan.id;

            // Establecer fecha actual
            const now = new Date();
            const dateTimeString = now.toISOString().slice(0, 16);
            document.getElementById('returnLoanDate').value = dateTimeString;

            // Mostrar/ocultar campo de descripción de daño
            document.getElementById('returnLoanCondition').addEventListener('change', function () {
                const damageContainer = document.getElementById('damageDescriptionContainer');
                if (this.value === 'damaged' || this.value === 'lost') {
                    damageContainer.style.display = 'block';
                } else {
                    damageContainer.style.display = 'none';
                }
            });

            // Mostrar modal
            modal.classList.add('active');
        }

        /**
         * Procesa la devolución de un préstamo
         */
        /**
  * Procesa la devolución de un préstamo
  */
        /**
         * Procesa la devolución de un préstamo
         */
        async function processLoanReturn() {
            toggleLoader(true);

            try {
                const loanId = parseInt(document.getElementById('returnLoanId').value);
                const returnDate = document.getElementById('returnLoanDate').value;
                const condition = document.getElementById('returnLoanCondition').value;
                const damageDescription = document.getElementById('returnLoanDamageDescription').value;
                const notes = document.getElementById('returnLoanNotes').value;

                // Validaciones
                if (!loanId) {
                    throw new Error('ID de préstamo no válido');
                }

                if (!returnDate) {
                    throw new Error('La fecha de devolución es obligatoria');
                }

                // Obtener el préstamo
                const loan = loans.find(l => l.id === loanId);
                if (!loan) {
                    throw new Error('Préstamo no encontrado');
                }

                // Crear datos de actualización para memoria
                const updateData = {
                    status: 'returned',
                    actual_return_date: new Date(returnDate).toISOString(),
                    return_condition: condition,
                    damage_description: damageDescription,
                    return_notes: notes,
                    updated_at: new Date().toISOString()
                };

                // Crear datos de actualización compatibles con Supabase
                // Solo incluimos el campo 'status' que sabemos que existe
                const supabaseUpdateData = {
                    status: 'returned'
                };

                // Si estamos online, actualizar en Supabase
                if (isOnline && supabase) {
                    // Actualizar préstamo
                    const { error } = await supabase
                        .from('superstore_loans')
                        .update(supabaseUpdateData)
                        .eq('id', loanId);

                    if (error) throw error;

                    // Si la condición no es "perdido", devolver el stock
                    if (condition !== 'lost') {
                        const inventoryItem = inventory.find(i => i.id === loan.item_id);
                        if (inventoryItem) {
                            const newStock = inventoryItem.stock + loan.quantity;

                            // Actualizar en Supabase
                            await supabase
                                .from('superstore_items')
                                .update({
                                    stock: newStock,
                                    updated_at: new Date().toISOString()
                                })
                                .eq('id', inventoryItem.id);

                            // Actualizar en memoria
                            inventoryItem.stock = newStock;
                            inventoryItem.updated_at = new Date().toISOString();
                        }
                    }
                }

                // Actualizar en memoria
                const loanIndex = loans.findIndex(l => l.id === loanId);
                if (loanIndex !== -1) {
                    loans[loanIndex] = {
                        ...loans[loanIndex],
                        ...updateData
                    };

                    // Si la condición no es "perdido", devolver el stock
                    if (condition !== 'lost') {
                        const inventoryItem = inventory.find(i => i.id === loan.item_id);
                        if (inventoryItem) {
                            inventoryItem.stock += loan.quantity;
                            inventoryItem.updated_at = new Date().toISOString();
                        }
                    }
                }

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Cerrar modal
                const modal = document.getElementById('returnLoanModal');
                if (modal) modal.classList.remove('active');

                // Actualizar interfaz
                renderLoansTable();
                renderInventoryTable();
                updateDashboard();

                showNotification('Devolución registrada correctamente', 'success');
            } catch (error) {
                console.error('Error al procesar devolución:', error);
                showNotification(`Error: ${error.message || 'Error al procesar la devolución'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Extiende la fecha de devolución de un préstamo
         * @param {number} loanId - ID del préstamo
         */
        function extendLoan(loanId) {
            const loan = loans.find(l => l.id === loanId);
            if (!loan) {
                showNotification('Préstamo no encontrado', 'danger');
                return;
            }

            // Crear modal HTML
            const modalHTML = `
    <div class="modal-backdrop active" id="extendLoanModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Extender Préstamo</h3>
                <button class="close-modal" id="closeExtendLoanModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Préstamo ID</label>
                    <div class="form-control">${loan.id}</div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Fecha Actual de Devolución</label>
                        <div class="form-control">${formatDate(loan.return_date)}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="extendedReturnDate">Nueva Fecha de Devolución</label>
                        <input type="datetime-local" id="extendedReturnDate" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="extensionReason">Motivo de la Extensión</label>
                    <textarea id="extensionReason" class="form-control" rows="3" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="cancelExtendLoanBtn">Cancelar</button>
                <button class="btn btn-primary" id="confirmExtendLoanBtn" data-id="${loan.id}">Extender</button>
            </div>
        </div>
    </div>
    `;

            // Insertar modal en el DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Establecer fecha mínima (un día después de la fecha actual)
            const currentReturnDate = new Date(loan.return_date);
            const minDate = new Date(currentReturnDate);
            minDate.setDate(minDate.getDate() + 1);

            // Establecer fecha predeterminada (una semana después de la fecha actual)
            const defaultDate = new Date(currentReturnDate);
            defaultDate.setDate(defaultDate.getDate() + 7);

            document.getElementById('extendedReturnDate').value = defaultDate.toISOString().slice(0, 16);
            document.getElementById('extendedReturnDate').min = minDate.toISOString().slice(0, 16);

            // Agregar eventos
            document.getElementById('closeExtendLoanModal').addEventListener('click', function () {
                document.getElementById('extendLoanModal').remove();
            });

            document.getElementById('cancelExtendLoanBtn').addEventListener('click', function () {
                document.getElementById('extendLoanModal').remove();
            });

            document.getElementById('confirmExtendLoanBtn').addEventListener('click', async function () {
                const loanId = parseInt(this.dataset.id);
                const newReturnDate = document.getElementById('extendedReturnDate').value;
                const reason = document.getElementById('extensionReason').value;

                if (!newReturnDate) {
                    showNotification('La nueva fecha de devolución es obligatoria', 'danger');
                    return;
                }

                if (!reason) {
                    showNotification('El motivo de la extensión es obligatorio', 'danger');
                    return;
                }

                await processLoanExtension(loanId, newReturnDate, reason);
                document.getElementById('extendLoanModal').remove();
            });
        }

        /**
         * Procesa la extensión de un préstamo
         * @param {number} loanId - ID del préstamo
         * @param {string} newReturnDate - Nueva fecha de devolución
         * @param {string} reason - Motivo de la extensión
         */
        async function processLoanExtension(loanId, newReturnDate, reason) {
            toggleLoader(true);

            try {
                // Validaciones
                if (!loanId) {
                    throw new Error('ID de préstamo no válido');
                }

                if (!newReturnDate) {
                    throw new Error('La nueva fecha de devolución es obligatoria');
                }

                // Obtener el préstamo
                const loan = loans.find(l => l.id === loanId);
                if (!loan) {
                    throw new Error('Préstamo no encontrado');
                }

                // Crear datos de actualización
                const updateData = {
                    return_date: new Date(newReturnDate).toISOString(),
                    extension_reason: reason,
                    extended: true,
                    updated_at: new Date().toISOString()
                };

                // Si estamos online, actualizar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_loans')
                        .update(updateData)
                        .eq('id', loanId);

                    if (error) throw error;
                }

                // Actualizar en memoria
                const loanIndex = loans.findIndex(l => l.id === loanId);
                if (loanIndex !== -1) {
                    loans[loanIndex] = {
                        ...loans[loanIndex],
                        ...updateData
                    };
                }

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                renderLoansTable();
                updateUpcomingReturns();

                showNotification('Préstamo extendido correctamente', 'success');
            } catch (error) {
                console.error('Error al extender préstamo:', error);
                showNotification(`Error: ${error.message || 'Error al extender el préstamo'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Elimina un préstamo
         * @param {number} loanId - ID del préstamo a eliminar
         */
        async function deleteLoan(loanId) {
            if (!confirm('¿Está seguro de eliminar este préstamo? Esta acción no se puede deshacer.')) {
                return;
            }

            toggleLoader(true);

            try {
                // Obtener el préstamo antes de eliminarlo
                const loan = loans.find(l => l.id === loanId);
                if (!loan) {
                    throw new Error('Préstamo no encontrado');
                }

                // Si estamos online, eliminar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_loans')
                        .delete()
                        .eq('id', loanId);

                    if (error) throw error;

                    // Si el préstamo está activo, devolver stock
                    if (loan.status === 'active') {
                        const inventoryItem = inventory.find(i => i.id === loan.item_id);
                        if (inventoryItem) {
                            const newStock = inventoryItem.stock + loan.quantity;

                            // Actualizar en Supabase
                            await supabase
                                .from('superstore_items')
                                .update({
                                    stock: newStock,
                                    updated_at: new Date().toISOString()
                                })
                                .eq('id', inventoryItem.id);

                            // Actualizar en memoria
                            inventoryItem.stock = newStock;
                            inventoryItem.updated_at = new Date().toISOString();
                        }
                    }
                }

                // Si el préstamo está activo, devolver stock en memoria
                if (loan.status === 'active') {
                    const inventoryItem = inventory.find(i => i.id === loan.item_id);
                    if (inventoryItem) {
                        inventoryItem.stock += loan.quantity;
                        inventoryItem.updated_at = new Date().toISOString();
                    }
                }

                // Eliminar de la lista de préstamos
                loans = loans.filter(l => l.id !== loanId);

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                renderLoansTable();
                renderInventoryTable();
                updateDashboard();

                showNotification('Préstamo eliminado correctamente', 'success');
            } catch (error) {
                console.error('Error al eliminar préstamo:', error);
                showNotification(`Error: ${error.message || 'Error al eliminar el préstamo'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Resuelve una alerta
         * @param {number} alertId - ID de la alerta
         */
        function resolveAlert(alertId) {
            const alert = alerts.find(a => a.id === alertId);
            if (!alert) {
                showNotification('Alerta no encontrada', 'danger');
                return;
            }

            const modal = document.getElementById('resolveAlertModal');
            if (!modal) return;

            // Resetear formulario
            const form = document.getElementById('resolveAlertForm');
            if (form) form.reset();

            // Establecer datos de la alerta
            document.getElementById('alertId').value = alert.id;
            document.getElementById('alertDescription').textContent = alert.description;

            // Mostrar modal
            modal.classList.add('active');
        }

        /**
         * Procesa la resolución de una alerta
         */
        async function processAlertResolution() {
            toggleLoader(true);

            try {
                const alertId = parseInt(document.getElementById('alertId').value);
                const resolutionType = document.getElementById('resolutionType').value;
                const resolutionNotes = document.getElementById('resolutionNotes').value;

                // Validaciones
                if (!alertId) {
                    throw new Error('ID de alerta no válido');
                }

                if (!resolutionType) {
                    throw new Error('El tipo de resolución es obligatorio');
                }

                if (!resolutionNotes) {
                    throw new Error('Las notas de resolución son obligatorias');
                }

                // Crear datos de actualización
                const updateData = {
                    status: 'resolved',
                    resolution_type: resolutionType,
                    resolution: resolutionNotes,
                    resolution_date: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                // Si estamos online, actualizar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_alerts')
                        .update(updateData)
                        .eq('id', alertId);

                    if (error) throw error;
                }

                // Actualizar en memoria
                const alertIndex = alerts.findIndex(a => a.id === alertId);
                if (alertIndex !== -1) {
                    alerts[alertIndex] = {
                        ...alerts[alertIndex],
                        ...updateData
                    };
                }

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Cerrar modal
                const modal = document.getElementById('resolveAlertModal');
                if (modal) modal.classList.remove('active');

                // Actualizar interfaz
                renderAlertsTable();
                updateAlertCount();

                showNotification('Alerta resuelta correctamente', 'success');
            } catch (error) {
                console.error('Error al resolver alerta:', error);
                showNotification(`Error: ${error.message || 'Error al resolver la alerta'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Elimina una alerta
         * @param {number} alertId - ID de la alerta a eliminar
         */
        async function deleteAlert(alertId) {
            if (!confirm('¿Está seguro de eliminar esta alerta? Esta acción no se puede deshacer.')) {
                return;
            }

            toggleLoader(true);

            try {
                // Si estamos online, eliminar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_alerts')
                        .delete()
                        .eq('id', alertId);

                    if (error) throw error;
                }

                // Eliminar de la lista de alertas
                alerts = alerts.filter(a => a.id !== alertId);

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                renderAlertsTable();
                updateAlertCount();

                showNotification('Alerta eliminada correctamente', 'success');
            } catch (error) {
                console.error('Error al eliminar alerta:', error);
                showNotification(`Error: ${error.message || 'Error al eliminar la alerta'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Crea una nueva alerta para un artículo con stock bajo
         * @param {number} itemId - ID del artículo
         */
        /**
         * Crea una nueva alerta para un artículo con stock bajo
         * @param {number} itemId - ID del artículo
         */
        /**
         * Crea una nueva alerta para un artículo con stock bajo
         * @param {number} itemId - ID del artículo
         */
        async function requestItem(itemId) {
            toggleLoader(true);

            try {
                const item = inventory.find(i => i.id === itemId);
                if (!item) {
                    throw new Error('Artículo no encontrado');
                }

                // Crear datos de la alerta
                const alertData = {
                    date: new Date().toISOString(),
                    type: 'low_stock',
                    description: `Solicitud de reposición para ${item.name} (${item.code || 'Sin código'}). Stock actual: ${item.stock}, Stock mínimo: ${item.min_stock || 10}`,
                    // Removed priority and related_id fields since they don't exist in the table
                    status: 'active',
                    created_at: new Date().toISOString()
                };

                // Si estamos online, guardar en Supabase
                if (isOnline && supabase) {
                    const { data, error } = await supabase
                        .from('superstore_alerts')
                        .insert([alertData])
                        .select();

                    if (error) throw error;

                    // Actualizar datos en memoria
                    if (data && data.length > 0) {
                        alerts = [...data, ...alerts];
                    }
                } else {
                    // Modo offline: actualizar en memoria y localStorage
                    const newAlert = {
                        ...alertData,
                        id: generateUniqueId()
                    };

                    alerts = [newAlert, ...alerts];

                    // Guardar en localStorage
                    saveDataToLocalStorage();
                }

                // Actualizar interfaz
                renderAlertsTable();
                updateAlertCount();

                showNotification('Solicitud de reposición creada correctamente', 'success');
            } catch (error) {
                console.error('Error al crear solicitud:', error);
                showNotification(`Error: ${error.message || 'Error al crear la solicitud de reposición'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }


        /**
         * Genera un código automático para artículos de inventario
         * @returns {string} Código generado
         */
        function generateItemCode() {
            // Obtener la categoría seleccionada
            const categorySelect = document.getElementById('itemCategory');
            if (!categorySelect) return '';

            const category = categorySelect.value;

            // Prefijos según categoría
            const prefixes = {
                'cleaning': 'CL',
                'tools': 'TL',
                'office': 'OF'
            };

            // Obtener el prefijo correspondiente o usar 'XX' como predeterminado
            const prefix = prefixes[category] || 'XX';

            // Filtrar artículos de la misma categoría
            const categoryItems = inventory.filter(item => item.category === category);

            // Buscar el número más alto usado actualmente
            let maxNumber = 0;

            categoryItems.forEach(item => {
                if (!item.code) return;

                // Intentar extraer el número del código (formato esperado: XX-0000)
                const match = item.code.match(/[A-Z]+-(\d+)/);
                if (match && match[1]) {
                    const num = parseInt(match[1], 10);
                    if (!isNaN(num) && num > maxNumber) {
                        maxNumber = num;
                    }
                }
            });

            // Generar el siguiente número
            const nextNumber = maxNumber + 1;

            // Formatear el código con ceros a la izquierda (4 dígitos)
            const formattedNumber = nextNumber.toString().padStart(4, '0');

            // Combinar prefijo y número
            const generatedCode = `${prefix}-${formattedNumber}`;

            // Asignar al campo de entrada
            const codeInput = document.getElementById('itemCode');
            if (codeInput) {
                codeInput.value = generatedCode;
            }

            return generatedCode;
        }

        /**
         * Event listener para generar código al cambiar la categoría
         */
        function setupAutoCodeGeneration() {
            const categorySelect = document.getElementById('itemCategory');
            if (categorySelect) {
                categorySelect.addEventListener('change', generateItemCode);
            }

            // Agregar botón de generación automática junto al campo de código
            const codeInput = document.getElementById('itemCode');
            if (codeInput) {
                // Crear botón
                const generateBtn = document.createElement('button');
                generateBtn.type = 'button';
                generateBtn.className = 'btn btn-sm btn-outline-primary';
                generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generar';
                generateBtn.style.marginTop = '8px';
                generateBtn.onclick = generateItemCode;

                // Insertar después del campo de código
                if (codeInput.parentNode) {
                    codeInput.parentNode.appendChild(generateBtn);
                }
            }

            // Generar código automáticamente al abrir el modal de nuevo artículo
            const oldOpenNewItemModal = window.openNewItemModal;
            window.openNewItemModal = function (itemId = null) {
                // Llamar a la función original
                oldOpenNewItemModal(itemId);

                // Si es un nuevo artículo (no edición), generar código
                if (!itemId) {
                    // Pequeño retraso para asegurar que todos los elementos estén cargados
                    setTimeout(generateItemCode, 100);
                }
            };
        }

        // Llamar a esta función cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function () {
            const oldInitializeEvents = window.initializeEvents;
            window.initializeEvents = function () {
                // Llamar a la función original
                oldInitializeEvents();

                // Configurar generación automática de códigos
                setupAutoCodeGeneration();
            };
        });

        /**
         * Inicializa gráficos del dashboard
         */
        function initializeCharts() {
            if (currentSection !== 'dashboard') return;

            // Gráfico de movimiento de inventario
            initializeInventoryMovementChart();

            // Gráfico de distribución del inventario
            initializeInventoryDistributionChart();
        }

        /**
         * Inicializa el gráfico de movimiento de inventario
         */
        function initializeInventoryMovementChart() {
            const chartContainer = document.getElementById('inventoryMovementChart');
            if (!chartContainer) return;

            try {
                // Obtener datos de los últimos 6 meses
                const today = new Date();
                const months = [];
                const inData = [];
                const outData = [];

                for (let i = 5; i >= 0; i--) {
                    const month = new Date(today.getFullYear(), today.getMonth() - i, 1);
                    const monthName = month.toLocaleString('default', { month: 'short' });
                    const year = month.getFullYear();
                    const monthLabel = `${monthName} ${year}`;

                    months.push(monthLabel);

                    // Filtrar transacciones del mes
                    const monthTransactions = transactions.filter(t => {
                        const tranDate = new Date(t.date);
                        return tranDate.getMonth() === month.getMonth() &&
                            tranDate.getFullYear() === month.getFullYear();
                    });

                    // Contar ingresos y entregas
                    const inCount = monthTransactions
                        .filter(t => t.type === 'in')
                        .reduce((sum, t) => sum + t.quantity, 0);

                    const outCount = monthTransactions
                        .filter(t => t.type === 'out')
                        .reduce((sum, t) => sum + t.quantity, 0);

                    inData.push(inCount);
                    outData.push(outCount);
                }

                // Opciones para ApexCharts
                const options = {
                    series: [
                        {
                            name: 'Ingresos',
                            data: inData
                        },
                        {
                            name: 'Entregas',
                            data: outData
                        }
                    ],
                    chart: {
                        height: 300,
                        type: 'area',
                        toolbar: {
                            show: true
                        }
                    },
                    dataLabels: {
                        enabled: false
                    },
                    stroke: {
                        curve: 'smooth',
                        width: 2
                    },
                    colors: ['#4f46e5', '#ef4444'],
                    fill: {
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.7,
                            opacityTo: 0.2
                        }
                    },
                    xaxis: {
                        categories: months
                    },
                    tooltip: {
                        x: {
                            format: 'MMM yyyy'
                        }
                    },
                    legend: {
                        position: 'top'
                    }
                };

                // Limpiar gráfico existente si lo hay
                if (charts.inventoryMovement) {
                    charts.inventoryMovement.destroy();
                }

                // Crear nuevo gráfico
                charts.inventoryMovement = new ApexCharts(chartContainer, options);
                charts.inventoryMovement.render();

                // Agregar evento al botón de actualizar
                const refreshBtn = document.getElementById('refreshInventoryChart');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', function () {
                        initializeInventoryMovementChart();
                    });
                }

                // Agregar evento al botón de descarga
                const downloadBtn = document.getElementById('downloadInventoryChart');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', function () {
                        if (charts.inventoryMovement) {
                            charts.inventoryMovement.dataURI().then(({ imgURI }) => {
                                const downloadLink = document.createElement('a');
                                downloadLink.href = imgURI;
                                downloadLink.download = 'movimiento-inventario.png';
                                downloadLink.click();
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('Error al inicializar gráfico de movimiento de inventario:', error);
                chartContainer.innerHTML = '<div class="text-center">Error al cargar el gráfico</div>';
            }
        }

        /**
         * Inicializa el gráfico de distribución del inventario
         */
        function initializeInventoryDistributionChart() {
            const chartContainer = document.getElementById('inventoryDistributionChart');
            if (!chartContainer) return;

            try {
                // Agrupar por categoría
                const categories = {};

                inventory.forEach(item => {
                    const category = item.category || 'sin_categoria';
                    if (!categories[category]) {
                        categories[category] = 0;
                    }
                    categories[category] += 1;
                });

                // Convertir a arrays para el gráfico
                const categoryLabels = [];
                const categoryData = [];

                for (const [category, count] of Object.entries(categories)) {
                    categoryLabels.push(getCategoryName(category));
                    categoryData.push(count);
                }

                // Opciones para ApexCharts
                const options = {
                    series: categoryData,
                    chart: {
                        height: 300,
                        type: 'pie',
                        toolbar: {
                            show: true
                        }
                    },
                    labels: categoryLabels,
                    colors: ['#4f46e5', '#06b6d4', '#10b981', '#f59e0b', '#ef4444'],
                    legend: {
                        position: 'bottom'
                    },
                    responsive: [{
                        breakpoint: 480,
                        options: {
                            chart: {
                                height: 250
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }]
                };

                // Limpiar gráfico existente si lo hay
                if (charts.inventoryDistribution) {
                    charts.inventoryDistribution.destroy();
                }

                // Crear nuevo gráfico
                charts.inventoryDistribution = new ApexCharts(chartContainer, options);
                charts.inventoryDistribution.render();
            } catch (error) {
                console.error('Error al inicializar gráfico de distribución del inventario:', error);
                chartContainer.innerHTML = '<div class="text-center">Error al cargar el gráfico</div>';
            }
        }

        /**
         * Inicializa el gráfico de distribución del personal
         */
        function initializeStaffChart() {
            const chartContainer = document.getElementById('staffDistributionChart');
            if (!chartContainer) return;

            try {
                // Agrupar por rol
                const roles = {};

                staff.forEach(person => {
                    const role = person.role || 'sin_rol';
                    if (!roles[role]) {
                        roles[role] = 0;
                    }
                    roles[role] += 1;
                });

                // Convertir a arrays para el gráfico
                const roleLabels = [];
                const roleData = [];

                for (const [role, count] of Object.entries(roles)) {
                    roleLabels.push(getCategoryName(role));
                    roleData.push(count);
                }

                // Opciones para ApexCharts
                const options = {
                    series: roleData,
                    chart: {
                        height: 300,
                        type: 'donut',
                        toolbar: {
                            show: true
                        }
                    },
                    labels: roleLabels,
                    colors: ['#4f46e5', '#06b6d4', '#10b981', '#f59e0b'],
                    legend: {
                        position: 'bottom'
                    },
                    dataLabels: {
                        enabled: true,
                        formatter: function (val) {
                            return Math.round(val) + "%";
                        }
                    },
                    responsive: [{
                        breakpoint: 480,
                        options: {
                            chart: {
                                height: 250
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }]
                };

                // Limpiar gráfico existente si lo hay
                if (charts.staffDistribution) {
                    charts.staffDistribution.destroy();
                }

                // Crear nuevo gráfico
                charts.staffDistribution = new ApexCharts(chartContainer, options);
                charts.staffDistribution.render();
            } catch (error) {
                console.error('Error al inicializar gráfico de distribución del personal:', error);
                chartContainer.innerHTML = '<div class="text-center">Error al cargar el gráfico</div>';
            }
        }

        /**
         * Inicializa el gráfico de distribución de préstamos
         */
        function initializeLoansChart() {
            const chartContainer = document.getElementById('loansStatusChart');
            if (!chartContainer) return;

            try {
                // Contador por estado
                const today = new Date();
                let activeCount = 0;
                let overdueCount = 0;
                let returnedCount = 0;

                loans.forEach(loan => {
                    if (loan.status === 'returned') {
                        returnedCount++;
                    } else if (loan.status === 'active') {
                        const returnDate = new Date(loan.return_date);
                        if (returnDate < today) {
                            overdueCount++;
                        } else {
                            activeCount++;
                        }
                    }
                });

                // Opciones para ApexCharts
                const options = {
                    series: [activeCount, overdueCount, returnedCount],
                    chart: {
                        height: 300,
                        type: 'radialBar',
                        toolbar: {
                            show: true
                        }
                    },
                    plotOptions: {
                        radialBar: {
                            dataLabels: {
                                name: {
                                    fontSize: '22px',
                                },
                                value: {
                                    fontSize: '16px',
                                },
                                total: {
                                    show: true,
                                    label: 'Total',
                                    formatter: function (w) {
                                        return loans.length;
                                    }
                                }
                            }
                        }
                    },
                    labels: ['Activos', 'Vencidos', 'Devueltos'],
                    colors: ['#10b981', '#ef4444', '#3b82f6']
                };

                // Limpiar gráfico existente si lo hay
                if (charts.loansStatus) {
                    charts.loansStatus.destroy();
                }

                // Crear nuevo gráfico
                charts.loansStatus = new ApexCharts(chartContainer, options);
                charts.loansStatus.render();
            } catch (error) {
                console.error('Error al inicializar gráfico de distribución de préstamos:', error);
                chartContainer.innerHTML = '<div class="text-center">Error al cargar el gráfico</div>';
            }
        }

        /**
         * Inicializa el gráfico de distribución de alertas
         */
        function initializeAlertsChart() {
            const chartContainer = document.getElementById('alertsDistributionChart');
            if (!chartContainer) return;

            try {
                // Agrupar por tipo
                const types = {
                    low_stock: 0,
                    loan_due: 0,
                    loan_overdue: 0,
                    system: 0
                };

                // Contar alertas activas por tipo
                alerts.filter(a => a.status === 'active').forEach(alert => {
                    const type = alert.type || 'system';
                    if (types[type] !== undefined) {
                        types[type]++;
                    } else {
                        types.system++;
                    }
                });

                // Añadir alertas especiales
                // Stock bajo
                const lowStockItems = inventory.filter(item =>
                    item.stock < (item.min_stock || 10)
                ).length;

                types.low_stock += lowStockItems;

                // Préstamos por vencer
                const today = new Date();
                const dueLoans = loans.filter(loan => {
                    if (loan.status !== 'active') return false;

                    const returnDate = new Date(loan.return_date);
                    const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                    return daysRemaining >= 0 && daysRemaining <= 3;
                }).length;

                types.loan_due += dueLoans;

                // Préstamos vencidos
                const overdueLoans = loans.filter(loan => {
                    if (loan.status !== 'active') return false;

                    const returnDate = new Date(loan.return_date);
                    return returnDate < today;
                }).length;

                types.loan_overdue += overdueLoans;

                // Convertir a arrays para el gráfico
                const typeLabels = [
                    'Stock Bajo',
                    'Préstamos por Vencer',
                    'Préstamos Vencidos',
                    'Sistema'
                ];

                const typeData = [
                    types.low_stock,
                    types.loan_due,
                    types.loan_overdue,
                    types.system
                ];

                // Opciones para ApexCharts
                const options = {
                    series: [{
                        data: typeData
                    }],
                    chart: {
                        height: 300,
                        type: 'bar',
                        toolbar: {
                            show: true
                        }
                    },
                    colors: ['#ef4444', '#f59e0b', '#dc2626', '#3b82f6'],
                    plotOptions: {
                        bar: {
                            distributed: true,
                            borderRadius: 6,
                            dataLabels: {
                                position: 'top'
                            }
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        formatter: function (val) {
                            return val;
                        },
                        offsetY: -20,
                        style: {
                            fontSize: '12px',
                            colors: ["#304758"]
                        }
                    },
                    xaxis: {
                        categories: typeLabels,
                        position: 'bottom',
                        axisBorder: {
                            show: false
                        },
                        axisTicks: {
                            show: false
                        }
                    },
                    yaxis: {
                        axisBorder: {
                            show: false
                        },
                        axisTicks: {
                            show: false
                        },
                        labels: {
                            show: false
                        }
                    }
                };

                // Limpiar gráfico existente si lo hay
                if (charts.alertsDistribution) {
                    charts.alertsDistribution.destroy();
                }

                // Crear nuevo gráfico
                charts.alertsDistribution = new ApexCharts(chartContainer, options);
                charts.alertsDistribution.render();
            } catch (error) {
                console.error('Error al inicializar gráfico de distribución de alertas:', error);
                chartContainer.innerHTML = '<div class="text-center">Error al cargar el gráfico</div>';
            }
        }

        // =============== NAVEGACIÓN Y EVENTOS ===============

        /**
         * Cambia la sección activa
         * @param {string} sectionName - Nombre de la sección a activar
         */
        function changeSection(sectionName) {
            // Desactivar todas las secciones
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            // Activar la sección seleccionada
            const targetSection = document.getElementById(`${sectionName}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Actualizar elementos de la barra lateral
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            sidebarItems.forEach(item => {
                item.classList.remove('active');
            });

            const targetItem = document.querySelector(`.sidebar-item[data-section="${sectionName}"]`);
            if (targetItem) {
                targetItem.classList.add('active');
            }

            // Actualizar título de la página
            if (elements.pageTitle) {
                elements.pageTitle.textContent = sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
            }

            // Actualizar sección actual
            currentSection = sectionName;

            // Inicializar componentes específicos de la sección
            if (sectionName === 'dashboard') {
                updateDashboard();
                initializeCharts();
            } else if (sectionName === 'inventory') {
                renderInventoryTable();
            } else if (sectionName === 'transactions') {
                renderTransactionsTable();
            } else if (sectionName === 'staff') {
                renderStaffTable();
                initializeStaffChart();
            } else if (sectionName === 'loans') {
                renderLoansTable();
                initializeLoansChart();
            } else if (sectionName === 'alerts') {
                renderAlertsTable();
                initializeAlertsChart();
            }
        }

        /**
         * Alterna el estado de la barra lateral (contraída/expandida)
         */
        function toggleSidebar() {
            elements.sidebar.classList.toggle('collapsed');
            elements.mainContent.classList.toggle('expanded');

            const toggleIcon = document.getElementById('toggleIcon');
            if (toggleIcon) {
                if (elements.sidebar.classList.contains('collapsed')) {
                    toggleIcon.classList.remove('fa-chevron-left');
                    toggleIcon.classList.add('fa-chevron-right');
                } else {
                    toggleIcon.classList.remove('fa-chevron-right');
                    toggleIcon.classList.add('fa-chevron-left');
                }
            }
        }

        /**
         * Alterna el tema oscuro/claro
         */
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const themeSwitch = document.getElementById('themeSwitch');

            // Guardar preferencia de tema
            if (themeSwitch) {
                localStorage.setItem('darkTheme', themeSwitch.checked ? 'true' : 'false');
            }
        }

        /**
         * Inicializa los eventos de la aplicación
         */
        function initializeEvents() {
            // Navegación de la barra lateral
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            sidebarItems.forEach(item => {
                item.addEventListener('click', function () {
                    const section = this.dataset.section;
                    changeSection(section);
                });
            });

            // Botón para alternar barra lateral
            const toggleSidebarBtn = document.getElementById('toggleSidebar');
            if (toggleSidebarBtn) {
                toggleSidebarBtn.addEventListener('click', toggleSidebar);
            }

            // Switch de tema
            const themeSwitch = document.getElementById('themeSwitch');
            if (themeSwitch) {
                // Establecer estado inicial según preferencia guardada
                const savedTheme = localStorage.getItem('darkTheme');
                if (savedTheme === 'true') {
                    themeSwitch.checked = true;
                    document.body.classList.add('dark-theme');
                }

                themeSwitch.addEventListener('change', toggleTheme);
            }

            // Botón para añadir nuevo artículo
            const addNewItemBtn = document.getElementById('addNewItemBtn');
            if (addNewItemBtn) {
                addNewItemBtn.addEventListener('click', function () {
                    openNewItemModal();
                });
            }

            // Botones del modal de nuevo artículo
            const saveNewItemBtn = document.getElementById('saveNewItemBtn');
            if (saveNewItemBtn) {
                saveNewItemBtn.addEventListener('click', saveItem);
            }

            const cancelNewItemBtn = document.getElementById('cancelNewItemBtn');
            if (cancelNewItemBtn) {
                cancelNewItemBtn.addEventListener('click', function () {
                    document.getElementById('newItemModal').classList.remove('active');
                });
            }

            const closeNewItemModal = document.getElementById('closeNewItemModal');
            if (closeNewItemModal) {
                closeNewItemModal.addEventListener('click', function () {
                    document.getElementById('newItemModal').classList.remove('active');
                });
            }

            // Botón para añadir nueva transacción
            const addNewTransactionBtn = document.getElementById('addNewTransactionBtn');
            if (addNewTransactionBtn) {
                addNewTransactionBtn.addEventListener('click', function () {
                    openNewTransactionModal();
                });
            }

            // Botón para añadir artículo a la transacción
            const addTransactionItemBtn = document.getElementById('addTransactionItemBtn');
            if (addTransactionItemBtn) {
                addTransactionItemBtn.addEventListener('click', addTransactionItemRow);
            }

            // Botones del modal de nueva transacción
            const saveNewTransactionBtn = document.getElementById('saveNewTransactionBtn');
            if (saveNewTransactionBtn) {
                saveNewTransactionBtn.addEventListener('click', saveTransaction);
            }

            const cancelNewTransactionBtn = document.getElementById('cancelNewTransactionBtn');
            if (cancelNewTransactionBtn) {
                cancelNewTransactionBtn.addEventListener('click', function () {
                    document.getElementById('newTransactionModal').classList.remove('active');
                });
            }

            const closeNewTransactionModal = document.getElementById('closeNewTransactionModal');
            if (closeNewTransactionModal) {
                closeNewTransactionModal.addEventListener('click', function () {
                    document.getElementById('newTransactionModal').classList.remove('active');
                });
            }

            // Botón para añadir nuevo personal
            const addNewStaffBtn = document.getElementById('addNewStaffBtn');
            if (addNewStaffBtn) {
                addNewStaffBtn.addEventListener('click', function () {
                    openNewStaffModal();
                });
            }

            // Botones del modal de nuevo personal
            const saveNewStaffBtn = document.getElementById('saveNewStaffBtn');
            if (saveNewStaffBtn) {
                saveNewStaffBtn.addEventListener('click', saveStaff);
            }

            const cancelNewStaffBtn = document.getElementById('cancelNewStaffBtn');
            if (cancelNewStaffBtn) {
                cancelNewStaffBtn.addEventListener('click', function () {
                    document.getElementById('newStaffModal').classList.remove('active');
                });
            }

            const closeNewStaffModal = document.getElementById('closeNewStaffModal');
            if (closeNewStaffModal) {
                closeNewStaffModal.addEventListener('click', function () {
                    document.getElementById('newStaffModal').classList.remove('active');
                });
            }

            // Botón para añadir nuevo préstamo
            const addNewLoanBtn = document.getElementById('addNewLoanBtn');
            if (addNewLoanBtn) {
                addNewLoanBtn.addEventListener('click', function () {
                    openNewLoanModal();
                });
            }

            // Botones del modal de nuevo préstamo
            const saveNewLoanBtn = document.getElementById('saveNewLoanBtn');
            if (saveNewLoanBtn) {
                saveNewLoanBtn.addEventListener('click', saveLoan);
            }

            const cancelNewLoanBtn = document.getElementById('cancelNewLoanBtn');
            if (cancelNewLoanBtn) {
                cancelNewLoanBtn.addEventListener('click', function () {
                    document.getElementById('newLoanModal').classList.remove('active');
                });
            }

            const closeNewLoanModal = document.getElementById('closeNewLoanModal');
            if (closeNewLoanModal) {
                closeNewLoanModal.addEventListener('click', function () {
                    document.getElementById('newLoanModal').classList.remove('active');
                });
            }

            // Botones del modal de devolución de préstamo
            const confirmReturnLoanBtn = document.getElementById('confirmReturnLoanBtn');
            if (confirmReturnLoanBtn) {
                confirmReturnLoanBtn.addEventListener('click', processLoanReturn);
            }

            const cancelReturnLoanBtn = document.getElementById('cancelReturnLoanBtn');
            if (cancelReturnLoanBtn) {
                cancelReturnLoanBtn.addEventListener('click', function () {
                    document.getElementById('returnLoanModal').classList.remove('active');
                });
            }

            const closeReturnLoanModal = document.getElementById('closeReturnLoanModal');
            if (closeReturnLoanModal) {
                closeReturnLoanModal.addEventListener('click', function () {
                    document.getElementById('returnLoanModal').classList.remove('active');
                });
            }

            // Botones del modal de resolución de alertas
            const confirmResolveAlertBtn = document.getElementById('confirmResolveAlertBtn');
            if (confirmResolveAlertBtn) {
                confirmResolveAlertBtn.addEventListener('click', processAlertResolution);
            }

            const cancelResolveAlertBtn = document.getElementById('cancelResolveAlertBtn');
            if (cancelResolveAlertBtn) {
                cancelResolveAlertBtn.addEventListener('click', function () {
                    document.getElementById('resolveAlertModal').classList.remove('active');
                });
            }

            const closeResolveAlertModal = document.getElementById('closeResolveAlertModal');
            if (closeResolveAlertModal) {
                closeResolveAlertModal.addEventListener('click', function () {
                    document.getElementById('resolveAlertModal').classList.remove('active');
                });
            }

            // Botón para solicitar todos los artículos con stock bajo
            const requestAllItemsBtn = document.getElementById('requestAllItemsBtn');
            if (requestAllItemsBtn) {
                requestAllItemsBtn.addEventListener('click', async function () {
                    if (!confirm('¿Desea solicitar la reposición de todos los artículos con stock bajo?')) {
                        return;
                    }

                    toggleLoader(true);

                    try {
                        const lowStockItems = inventory.filter(item =>
                            item.stock < (item.min_stock || 10)
                        );

                        if (lowStockItems.length === 0) {
                            showNotification('No hay artículos con stock bajo', 'warning');
                            return;
                        }

                        // Crear alertas para cada artículo
                        for (const item of lowStockItems) {
                            await requestItem(item.id);
                        }

                        showNotification(`Se han generado ${lowStockItems.length} solicitudes de reposición`, 'success');
                    } catch (error) {
                        console.error('Error al solicitar artículos:', error);
                        showNotification(`Error: ${error.message || 'Error al solicitar artículos'}`, 'danger');
                    } finally {
                        toggleLoader(false);
                    }
                });
            }

            // Botón para notificar a todos los préstamos por vencer
            const notifyAllLoansBtn = document.getElementById('notifyAllLoansBtn');
            if (notifyAllLoansBtn) {
                notifyAllLoansBtn.addEventListener('click', function () {
                    if (!confirm('¿Desea enviar notificaciones a todos los responsables de préstamos por vencer?')) {
                        return;
                    }

                    toggleLoader(true);

                    try {
                        const today = new Date();
                        const dueLoans = loans.filter(loan => {
                            if (loan.status !== 'active') return false;

                            const returnDate = new Date(loan.return_date);
                            const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                            return daysRemaining <= 5; // Préstamos que vencen en 5 días o menos
                        });

                        if (dueLoans.length === 0) {
                            showNotification('No hay préstamos por vencer', 'warning');
                            return;
                        }

                        // Simulación de envío de notificaciones
                        showNotification(`Se han enviado ${dueLoans.length} notificaciones`, 'success');
                    } catch (error) {
                        console.error('Error al enviar notificaciones:', error);
                        showNotification(`Error: ${error.message || 'Error al enviar notificaciones'}`, 'danger');
                    } finally {
                        toggleLoader(false);
                    }
                });
            }

            // Botón para actualizar alertas
            const refreshAlertsBtn = document.getElementById('refreshAlertsBtn');
            if (refreshAlertsBtn) {
                refreshAlertsBtn.addEventListener('click', function () {
                    renderAlertsTable();
                    showNotification('Alertas actualizadas', 'success');
                });
            }

            // Botón para marcar todas las alertas como leídas
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', async function () {
                    if (!confirm('¿Desea marcar todas las alertas como leídas?')) {
                        return;
                    }

                    toggleLoader(true);

                    try {
                        const activeAlerts = alerts.filter(a => a.status === 'active');

                        if (activeAlerts.length === 0) {
                            showNotification('No hay alertas activas', 'warning');
                            return;
                        }

                        if (isOnline && supabase) {
                            // Actualizar todas las alertas activas
                            const { error } = await supabase
                                .from('superstore_alerts')
                                .update({
                                    status: 'resolved',
                                    resolution: 'Marcada como leída automáticamente',
                                    resolution_date: new Date().toISOString(),
                                    updated_at: new Date().toISOString()
                                })
                                .eq('status', 'active');

                            if (error) throw error;
                        }

                        // Actualizar en memoria
                        alerts = alerts.map(alert => {
                            if (alert.status === 'active') {
                                return {
                                    ...alert,
                                    status: 'resolved',
                                    resolution: 'Marcada como leída automáticamente',
                                    resolution_date: new Date().toISOString(),
                                    updated_at: new Date().toISOString()
                                };
                            }
                            return alert;
                        });

                        // Guardar en localStorage
                        saveDataToLocalStorage();

                        // Actualizar interfaz
                        renderAlertsTable();
                        updateAlertCount();

                        showNotification(`Se han marcado ${activeAlerts.length} alertas como leídas`, 'success');
                    } catch (error) {
                        console.error('Error al marcar alertas como leídas:', error);
                        showNotification(`Error: ${error.message || 'Error al marcar alertas como leídas'}`, 'danger');
                    } finally {
                        toggleLoader(false);
                    }
                });
            }

            // Selector para filtrar por persona en transacciones
            const personSummarySelect = document.getElementById('personSummarySelect');
            if (personSummarySelect) {
                personSummarySelect.addEventListener('change', function () {
                    const personId = parseInt(this.value);
                    if (!personId) {
                        document.getElementById('personSummaryContent').style.display = 'none';
                        return;
                    }

                    const person = staff.find(s => s.id === personId);
                    if (!person) {
                        document.getElementById('personSummaryContent').style.display = 'none';
                        return;
                    }

                    // Mostrar contenido
                    document.getElementById('personSummaryContent').style.display = 'block';

                    // Actualizar información de la persona
                    document.getElementById('personName').textContent = person.name;
                    document.getElementById('personRole').textContent = `${getCategoryName(person.role)} - ${getTerminalName(person.terminal)}`;

                    // Cargar transacciones de la persona
                    const personTransactions = transactions
                        .filter(t => t.person_id === personId)
                        .sort((a, b) => new Date(b.date) - new Date(a.date));

                    const tbody = document.getElementById('personTransactionsTable').querySelector('tbody');
                    tbody.innerHTML = '';

                    if (personTransactions.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = '<td colspan="4" class="text-center">No hay transacciones registradas</td>';
                        tbody.appendChild(tr);
                    } else {
                        personTransactions.forEach(transaction => {
                            const item = inventory.find(i => i.id === transaction.item_id) || { name: 'Desconocido', category: 'unknown' };

                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                        <td>${formatDate(transaction.date)}</td>
                        <td>${item.name}</td>
                        <td>${getCategoryName(item.category)}</td>
                        <td>${transaction.quantity} ${transaction.type === 'in' ? '(Ingreso)' : '(Entrega)'}</td>
                    `;
                            tbody.appendChild(tr);
                        });
                    }
                });
            }

            // Tabs para filtrar inventario
            const inventoryTabs = document.getElementById('inventoryTabs');
            if (inventoryTabs) {
                const tabs = inventoryTabs.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        // Actualizar tabs
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Filtrar tabla
                        const category = this.dataset.category;
                        filterInventoryTable(category);
                    });
                });
            }

            // Tabs para filtrar transacciones
            const transactionsTabs = document.getElementById('transactionsTabs');
            if (transactionsTabs) {
                const tabs = transactionsTabs.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        // Actualizar tabs
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Filtrar tabla
                        const type = this.dataset.type;
                        filterTransactionsTable(type);
                    });
                });
            }

            // Tabs para filtrar personal
            const staffTabs = document.getElementById('staffTabs');
            if (staffTabs) {
                const tabs = staffTabs.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        // Actualizar tabs
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Filtrar tabla
                        const role = this.dataset.role;
                        filterStaffTable(role);
                    });
                });
            }

            // Tabs para filtrar préstamos
            const loansTabs = document.getElementById('loansTabs');
            if (loansTabs) {
                const tabs = loansTabs.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        // Actualizar tabs
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Filtrar tabla
                        const status = this.dataset.status;
                        filterLoansTable(status);
                    });
                });
            }

            // Tabs para filtrar alertas
            const alertsTabs = document.getElementById('alertsTabs');
            if (alertsTabs) {
                const tabs = alertsTabs.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        // Actualizar tabs
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Filtrar tabla
                        const type = this.dataset.type;
                        filterAlertsTable(type);
                    });
                });
            }

            // Botón para configuración de alertas
            const alertSettingsBtn = document.getElementById('alertSettingsBtn');
            if (alertSettingsBtn) {
                alertSettingsBtn.addEventListener('click', function () {
                    document.getElementById('alertSettingsModal').classList.add('active');
                });
            }

            // Campo para habilitar notificaciones por correo
            const enableEmailAlerts = document.getElementById('enableEmailAlerts');
            if (enableEmailAlerts) {
                enableEmailAlerts.addEventListener('change', function () {
                    const emailContainer = document.getElementById('emailSettingsContainer');
                    if (emailContainer) {
                        emailContainer.style.display = this.checked ? 'block' : 'none';
                    }
                });
            }

            // Botones para cerrar modal de configuración de alertas
            const closeAlertSettingsModal = document.getElementById('closeAlertSettingsModal');
            if (closeAlertSettingsModal) {
                closeAlertSettingsModal.addEventListener('click', function () {
                    document.getElementById('alertSettingsModal').classList.remove('active');
                });
            }

            const cancelAlertSettingsBtn = document.getElementById('cancelAlertSettingsBtn');
            if (cancelAlertSettingsBtn) {
                cancelAlertSettingsBtn.addEventListener('click', function () {
                    document.getElementById('alertSettingsModal').classList.remove('active');
                });
            }

            const saveAlertSettingsBtn = document.getElementById('saveAlertSettingsBtn');
            if (saveAlertSettingsBtn) {
                saveAlertSettingsBtn.addEventListener('click', function () {
                    // Aquí se implementaría la lógica para guardar la configuración
                    document.getElementById('alertSettingsModal').classList.remove('active');
                    showNotification('Configuración guardada correctamente', 'success');
                });
            }

            // Inicialización de gráficos
            const analysisTabs = document.getElementById('analysisTabs');
            if (analysisTabs) {
                const tabs = analysisTabs.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        // Actualizar tabs
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Mostrar contenedor correspondiente
                        const analysis = this.dataset.analysis;
                        document.querySelectorAll('.analysis-container').forEach(container => {
                            container.style.display = 'none';
                        });
                        document.getElementById(`${analysis}AnalysisContainer`).style.display = 'block';
                    });
                });
            }
        }

        /**
         * Filtra la tabla de inventario por categoría
         * @param {string} category - Categoría a filtrar ('all' para todas)
         */
        function filterInventoryTable(category) {
            const inventoryTable = document.getElementById('inventoryTable');
            if (!inventoryTable) return;

            const tbody = inventoryTable.querySelector('tbody');
            if (!tbody) return;

            // Ocultar/mostrar filas según la categoría
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                if (category === 'all') {
                    row.style.display = '';
                } else {
                    const categoryCell = row.cells[2].textContent;
                    if (getCategoryName(category) === categoryCell) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        /**
         * Filtra la tabla de transacciones por tipo
         * @param {string} type - Tipo de transacción a filtrar ('all' para todas)
         */
        function filterTransactionsTable(type) {
            const transactionsTable = document.getElementById('transactionsTable');
            if (!transactionsTable) return;

            const tbody = transactionsTable.querySelector('tbody');
            if (!tbody) return;

            // Ocultar/mostrar filas según el tipo
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                if (type === 'all') {
                    row.style.display = '';
                } else {
                    // Verifica que la celda exista antes de acceder a textContent
                    if (row.cells && row.cells.length > 2) {
                        const typeCell = row.cells[2].textContent.trim();
                        const isOut = typeCell.includes('Entrega');

                        if ((type === 'out' && isOut) || (type === 'in' && !isOut)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                }
            });
        }

        /**
         * Filtra la tabla de personal por rol
         * @param {string} role - Rol a filtrar ('all' para todos)
         */
        function filterStaffTable(role) {
            const staffTable = document.getElementById('staffTable');
            if (!staffTable) return;

            const tbody = staffTable.querySelector('tbody');
            if (!tbody) return;

            // Ocultar/mostrar filas según el rol
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                if (role === 'all') {
                    row.style.display = '';
                } else {
                    // Verifica que la celda exista antes de acceder a textContent
                    if (row.cells && row.cells.length > 2) {
                        const roleCell = row.cells[2].textContent;
                        if (getCategoryName(role) === roleCell) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                }
            });
        }

        /**
         * Filtra la tabla de préstamos por estado
         * @param {string} status - Estado a filtrar ('all' para todos)
         */
        function filterLoansTable(status) {
            const loansTable = document.getElementById('loansTable');
            if (!loansTable) return;

            const tbody = loansTable.querySelector('tbody');
            if (!tbody) return;

            // Ocultar/mostrar filas según el estado
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    const statusText = row.cells[7].textContent.trim().toLowerCase();
                    let match = false;

                    if (status === 'active' && (statusText === 'activo' || statusText === 'por vencer')) {
                        match = true;
                    } else if (status === 'returned' && statusText === 'devuelto') {
                        match = true;
                    } else if (status === 'overdue' && statusText === 'vencido') {
                        match = true;
                    }

                    row.style.display = match ? '' : 'none';
                }
            });
        }

        /**
         * Filtra la tabla de alertas por tipo
         * @param {string} type - Tipo de alerta a filtrar ('all' para todas)
         */
        function filterAlertsTable(type) {
            const activeAlertsTable = document.getElementById('activeAlertsTable');
            if (!activeAlertsTable) return;

            const tbody = activeAlertsTable.querySelector('tbody');
            if (!tbody) return;

            // Ocultar/mostrar filas según el tipo
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                if (type === 'all') {
                    row.style.display = '';
                } else {
                    // Verifica que la celda exista antes de acceder a textContent
                    if (row.cells && row.cells.length > 1) {
                        const typeCell = row.cells[1].textContent.trim();
                        if (getAlertTypeName(type) === typeCell) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                }
            });
        }

        // =============== INICIALIZACIÓN DE LA APLICACIÓN ===============

        /**
         * Inicializa la aplicación
         */
        function initializeApp() {
            try {
                // Mostrar loader
                toggleLoader(true);

                console.log('Inicializando aplicación de gestión de bodega...');

                // Inicializar Supabase
                initializeSupabase();

                // Cargar datos
                loadAllData().then(() => {
                    // Inicializar eventos
                    initializeEvents();

                    // Establecer sección predeterminada
                    changeSection('dashboard');

                    // Configurar intervalo de sincronización
                    setupSyncInterval();

                    console.log('Aplicación inicializada correctamente');

                    // Ocultar loader
                    toggleLoader(false);
                });
            } catch (error) {
                console.error('Error al inicializar la aplicación:', error);
                showNotification('Error al inicializar la aplicación', 'danger');
                toggleLoader(false);
            }
        }

        // Inicialización de la aplicación cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>

    <script>

        /**
 * Funciones para gestionar la configuración del sistema
 */

        // Configuración por defecto del sistema
        const defaultSettings = {
            // Configuración general
            general: {
                companyName: 'Mi Empresa',
                defaultView: 'dashboard',
                itemsPerPage: 20,
                dateFormat: 'DD/MM/YYYY',
                timeZone: 'UTC-3',
                compactMode: false,
                confirmActions: true,
                language: 'es'
            },
            // Configuración de apariencia
            appearance: {
                theme: 'blue',
                darkMode: false,
                darkModeSystem: false,
                fontSize: 'medium',
                fontFamily: 'Inter',
                borderRadius: 'rounded',
                showStatsCards: true,
                showInventoryChart: true,
                showLowStockTable: true,
                showRecentActivity: true,
                logoUrl: ''
            },
            // Configuración de notificaciones
            notifications: {
                enableNotifications: true,
                enableSoundAlerts: true,
                notificationDuration: 5000,
                showLowStockAlerts: true,
                showTransactionAlerts: true,
                showLoanAlerts: true,
                showSystemAlerts: true,
                lowStockThreshold: 10,
                loanReminderDays: 3,
                enableEmailNotifications: false,
                emailRecipients: '',
                emailFrequency: 'weekly',
                emailLowStock: true,
                emailLoanReminders: true,
                emailSystemReports: true
            },
            // Configuración de base de datos
            database: {
                supabaseUrl: 'https://tcmtxvuucjttngcazgff.supabase.co',
                supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjbXR4dnV1Y2p0dG5nY2F6Z2ZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTExNjIxMjIsImV4cCI6MjAyNjczODEyMn0.2lU7Jdi3Z7jcvNNLFnOkEYlYnuK0KgOe7rDpH7YwMQI',
                syncInterval: 60000,
                offlineMode: false
            },
            // Configuración avanzada
            advanced: {
                logLevel: 'info',
                cacheTime: 30,
                maxUploadSize: 10,
                debugMode: false,
                customCSS: ''
            }
        };

        /**
         * Carga la configuración del sistema
         * @returns {Object} Configuración del sistema
         */
        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem('systemSettings');
                if (savedSettings) {
                    return JSON.parse(savedSettings);
                }
                return defaultSettings;
            } catch (error) {
                console.error('Error al cargar la configuración:', error);
                return defaultSettings;
            }
        }

        /**
         * Guarda la configuración del sistema
         * @param {Object} settings - Configuración a guardar
         */
        function saveSettings(settings) {
            try {
                localStorage.setItem('systemSettings', JSON.stringify(settings));
                return true;
            } catch (error) {
                console.error('Error al guardar la configuración:', error);
                return false;
            }
        }

        /**
         * Aplica la configuración del sistema
         * @param {Object} settings - Configuración a aplicar
         */
        function applySettings(settings) {
            // Aplicar tema
            applyTheme(settings.appearance.theme);

            // Aplicar modo oscuro
            if (settings.appearance.darkMode) {
                document.body.classList.add('dark-theme');
                const themeSwitch = document.getElementById('themeSwitch');
                if (themeSwitch) themeSwitch.checked = true;
            } else {
                document.body.classList.remove('dark-theme');
                const themeSwitch = document.getElementById('themeSwitch');
                if (themeSwitch) themeSwitch.checked = false;
            }

            // Aplicar tamaño de fuente
            applyFontSize(settings.appearance.fontSize);

            // Aplicar familia de fuente
            applyFontFamily(settings.appearance.fontFamily);

            // Aplicar radio de bordes
            applyBorderRadius(settings.appearance.borderRadius);

            // Aplicar modo compacto
            if (settings.general.compactMode) {
                document.body.classList.add('compact-mode');
            } else {
                document.body.classList.remove('compact-mode');
            }

            // Aplicar CSS personalizado
            applyCustomCSS(settings.advanced.customCSS);

            // Actualizar duración de las notificaciones
            updateNotificationDuration(settings.notifications.notificationDuration);

            // Actualizar intervalo de sincronización
            updateSyncInterval(settings.database.syncInterval);
        }

        /**
         * Aplica un tema de color
         * @param {string} theme - Nombre del tema (blue, green, red, pink, dark)
         */
        function applyTheme(theme) {
            // Eliminar clases de tema anteriores
            document.body.classList.remove('theme-blue', 'theme-green', 'theme-red', 'theme-pink', 'theme-dark');

            // Aplicar nueva clase de tema
            document.body.classList.add(`theme-${theme}`);

            // Actualizar colores CSS variables basados en el tema
            const colors = getThemeColors(theme);

            Object.entries(colors).forEach(([variable, value]) => {
                document.documentElement.style.setProperty(`--${variable}`, value);
            });
        }

        /**
         * Obtiene los colores de un tema
         * @param {string} theme - Nombre del tema
         * @returns {Object} Objeto con variables CSS y valores
         */
        function getThemeColors(theme) {
            const themes = {
                blue: {
                    'primary-color': '#4f46e5',
                    'primary-color-light': '#818cf8',
                    'primary-color-dark': '#3730a3',
                    'secondary-color': '#06b6d4',
                    'accent-color': '#f97316',
                    'primary-rgb': '79, 70, 229'
                },
                green: {
                    'primary-color': '#10b981',
                    'primary-color-light': '#34d399',
                    'primary-color-dark': '#059669',
                    'secondary-color': '#0ea5e9',
                    'accent-color': '#f97316',
                    'primary-rgb': '16, 185, 129'
                },
                red: {
                    'primary-color': '#ef4444',
                    'primary-color-light': '#f87171',
                    'primary-color-dark': '#dc2626',
                    'secondary-color': '#06b6d4',
                    'accent-color': '#8b5cf6',
                    'primary-rgb': '239, 68, 68'
                },
                pink: {
                    'primary-color': '#ec4899',
                    'primary-color-light': '#f472b6',
                    'primary-color-dark': '#db2777',
                    'secondary-color': '#8b5cf6',
                    'accent-color': '#0ea5e9',
                    'primary-rgb': '236, 72, 153'
                },
                dark: {
                    'primary-color': '#6366f1',
                    'primary-color-light': '#818cf8',
                    'primary-color-dark': '#4f46e5',
                    'secondary-color': '#06b6d4',
                    'accent-color': '#f97316',
                    'primary-rgb': '99, 102, 241',
                    'background-color': '#0f172a',
                    'surface-color': '#1e293b',
                    'text-primary': '#f8fafc',
                    'text-secondary': '#cbd5e1'
                }
            };

            return themes[theme] || themes.blue;
        }

        /**
         * Aplica un tamaño de fuente
         * @param {string} size - Tamaño de fuente (small, medium, large)
         */
        function applyFontSize(size) {
            const sizes = {
                small: {
                    'font-size-base': '0.875rem',
                    'font-size-sm': '0.75rem',
                    'font-size-lg': '1rem',
                    'font-size-xl': '1.125rem',
                    'font-size-2xl': '1.25rem'
                },
                medium: {
                    'font-size-base': '1rem',
                    'font-size-sm': '0.875rem',
                    'font-size-lg': '1.125rem',
                    'font-size-xl': '1.25rem',
                    'font-size-2xl': '1.5rem'
                },
                large: {
                    'font-size-base': '1.125rem',
                    'font-size-sm': '1rem',
                    'font-size-lg': '1.25rem',
                    'font-size-xl': '1.5rem',
                    'font-size-2xl': '1.75rem'
                }
            };

            const sizeValues = sizes[size] || sizes.medium;

            Object.entries(sizeValues).forEach(([variable, value]) => {
                document.documentElement.style.setProperty(`--${variable}`, value);
            });
        }

        /**
         * Aplica una familia de fuente
         * @param {string} fontFamily - Nombre de la familia de fuente
         */
        function applyFontFamily(fontFamily) {
            document.documentElement.style.setProperty('--font-family', `'${fontFamily}', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif`);
        }

        /**
         * Aplica un radio de bordes
         * @param {string} style - Estilo de bordes (sharp, rounded, extraRounded)
         */
        function applyBorderRadius(style) {
            const styles = {
                sharp: {
                    'border-radius-sm': '0.125rem',
                    'border-radius': '0.25rem',
                    'border-radius-md': '0.375rem',
                    'border-radius-lg': '0.5rem'
                },
                rounded: {
                    'border-radius-sm': '0.375rem',
                    'border-radius': '0.5rem',
                    'border-radius-md': '0.75rem',
                    'border-radius-lg': '1rem'
                },
                extraRounded: {
                    'border-radius-sm': '0.5rem',
                    'border-radius': '0.75rem',
                    'border-radius-md': '1rem',
                    'border-radius-lg': '1.5rem'
                }
            };

            const radiusValues = styles[style] || styles.rounded;

            Object.entries(radiusValues).forEach(([variable, value]) => {
                document.documentElement.style.setProperty(`--${variable}`, value);
            });
        }

        /**
         * Aplica CSS personalizado
         * @param {string} css - Código CSS personalizado
         */
        function applyCustomCSS(css) {
            // Buscar o crear elemento de estilo personalizado
            let customStyle = document.getElementById('custom-css');

            if (!customStyle) {
                customStyle = document.createElement('style');
                customStyle.id = 'custom-css';
                document.head.appendChild(customStyle);
            }

            // Actualizar contenido
            customStyle.textContent = css;
        }

        /**
         * Actualiza la duración de las notificaciones
         * @param {number} duration - Duración en milisegundos
         */
        function updateNotificationDuration(duration) {
            window.notificationDuration = duration;
        }

        /**
         * Actualiza el intervalo de sincronización
         * @param {number} interval - Intervalo en milisegundos
         */
        function updateSyncInterval(interval) {
            if (window.syncInterval) {
                clearInterval(window.syncInterval);
            }

            if (interval > 0) {
                window.syncInterval = setInterval(() => {
                    if (window.checkOnlineStatus()) {
                        window.loadAllData();
                    }
                }, interval);
            }
        }

        /**
         * Actualiza la interfaz de configuración con los valores actuales
         * @param {Object} settings - Configuración actual
         */
        function updateSettingsUI(settings) {
            // General
            document.getElementById('companyName').value = settings.general.companyName;
            document.getElementById('defaultView').value = settings.general.defaultView;
            document.getElementById('itemsPerPage').value = settings.general.itemsPerPage;
            document.getElementById('dateFormat').value = settings.general.dateFormat;
            document.getElementById('timeZone').value = settings.general.timeZone;
            document.getElementById('compactMode').checked = settings.general.compactMode;
            document.getElementById('confirmActions').checked = settings.general.confirmActions;
            document.getElementById('language').value = settings.general.language;

            // Apariencia
            const themeButtons = document.querySelectorAll('.theme-selector-btn');
            themeButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === settings.appearance.theme) {
                    btn.classList.add('active');
                }
            });

            document.getElementById('darkModeSystem').checked = settings.appearance.darkModeSystem;
            document.getElementById('fontSize').value = settings.appearance.fontSize;
            document.getElementById('fontFamily').value = settings.appearance.fontFamily;
            document.getElementById('borderRadius').value = settings.appearance.borderRadius;
            document.getElementById('showStatsCards').checked = settings.appearance.showStatsCards;
            document.getElementById('showInventoryChart').checked = settings.appearance.showInventoryChart;
            document.getElementById('showLowStockTable').checked = settings.appearance.showLowStockTable;
            document.getElementById('showRecentActivity').checked = settings.appearance.showRecentActivity;

            // Notificaciones
            document.getElementById('enableNotifications').checked = settings.notifications.enableNotifications;
            document.getElementById('enableSoundAlerts').checked = settings.notifications.enableSoundAlerts;
            document.getElementById('notificationDuration').value = settings.notifications.notificationDuration;
            document.getElementById('showLowStockAlerts').checked = settings.notifications.showLowStockAlerts;
            document.getElementById('showTransactionAlerts').checked = settings.notifications.showTransactionAlerts;
            document.getElementById('showLoanAlerts').checked = settings.notifications.showLoanAlerts;
            document.getElementById('showSystemAlerts').checked = settings.notifications.showSystemAlerts;
            document.getElementById('lowStockThreshold').value = settings.notifications.lowStockThreshold;
            document.getElementById('loanReminderDays').value = settings.notifications.loanReminderDays;
            document.getElementById('enableEmailNotifications').checked = settings.notifications.enableEmailNotifications;

            const emailContainer = document.getElementById('emailNotificationsContainer');
            if (emailContainer) {
                emailContainer.style.display = settings.notifications.enableEmailNotifications ? 'block' : 'none';
            }

            document.getElementById('emailRecipients').value = settings.notifications.emailRecipients;
            document.getElementById('emailFrequency').value = settings.notifications.emailFrequency;
            document.getElementById('emailLowStock').checked = settings.notifications.emailLowStock;
            document.getElementById('emailLoanReminders').checked = settings.notifications.emailLoanReminders;
            document.getElementById('emailSystemReports').checked = settings.notifications.emailSystemReports;

            // Base de datos
            document.getElementById('supabaseUrl').value = settings.database.supabaseUrl;
            document.getElementById('supabaseKey').value = settings.database.supabaseKey;
            document.getElementById('syncInterval').value = settings.database.syncInterval;
            document.getElementById('offlineMode').checked = settings.database.offlineMode;

            // Avanzado
            document.getElementById('logLevel').value = settings.advanced.logLevel;
            document.getElementById('cacheTime').value = settings.advanced.cacheTime;
            document.getElementById('maxUploadSize').value = settings.advanced.maxUploadSize;
            document.getElementById('debugMode').checked = settings.advanced.debugMode;
            document.getElementById('customCSS').value = settings.advanced.customCSS;
        }

        /**
         * Recopila los valores de configuración de la interfaz
         * @returns {Object} Configuración actualizada
         */
        function collectSettingsFromUI() {
            const settings = {
                general: {
                    companyName: document.getElementById('companyName').value,
                    defaultView: document.getElementById('defaultView').value,
                    itemsPerPage: parseInt(document.getElementById('itemsPerPage').value),
                    dateFormat: document.getElementById('dateFormat').value,
                    timeZone: document.getElementById('timeZone').value,
                    compactMode: document.getElementById('compactMode').checked,
                    confirmActions: document.getElementById('confirmActions').checked,
                    language: document.getElementById('language').value
                },
                appearance: {
                    theme: document.querySelector('.theme-selector-btn.active')?.dataset.theme || 'blue',
                    darkMode: document.getElementById('themeSwitch')?.checked || false,
                    darkModeSystem: document.getElementById('darkModeSystem').checked,
                    fontSize: document.getElementById('fontSize').value,
                    fontFamily: document.getElementById('fontFamily').value,
                    borderRadius: document.getElementById('borderRadius').value,
                    showStatsCards: document.getElementById('showStatsCards').checked,
                    showInventoryChart: document.getElementById('showInventoryChart').checked,
                    showLowStockTable: document.getElementById('showLowStockTable').checked,
                    showRecentActivity: document.getElementById('showRecentActivity').checked,
                    logoUrl: '' // Se manejaría con la subida de archivos
                },
                notifications: {
                    enableNotifications: document.getElementById('enableNotifications').checked,
                    enableSoundAlerts: document.getElementById('enableSoundAlerts').checked,
                    notificationDuration: parseInt(document.getElementById('notificationDuration').value),
                    showLowStockAlerts: document.getElementById('showLowStockAlerts').checked,
                    showTransactionAlerts: document.getElementById('showTransactionAlerts').checked,
                    showLoanAlerts: document.getElementById('showLoanAlerts').checked,
                    showSystemAlerts: document.getElementById('showSystemAlerts').checked,
                    lowStockThreshold: parseInt(document.getElementById('lowStockThreshold').value),
                    loanReminderDays: parseInt(document.getElementById('loanReminderDays').value),
                    enableEmailNotifications: document.getElementById('enableEmailNotifications').checked,
                    emailRecipients: document.getElementById('emailRecipients').value,
                    emailFrequency: document.getElementById('emailFrequency').value,
                    emailLowStock: document.getElementById('emailLowStock').checked,
                    emailLoanReminders: document.getElementById('emailLoanReminders').checked,
                    emailSystemReports: document.getElementById('emailSystemReports').checked
                },
                database: {
                    supabaseUrl: document.getElementById('supabaseUrl').value,
                    supabaseKey: document.getElementById('supabaseKey').value,
                    syncInterval: parseInt(document.getElementById('syncInterval').value),
                    offlineMode: document.getElementById('offlineMode').checked
                },
                advanced: {
                    logLevel: document.getElementById('logLevel').value,
                    cacheTime: parseInt(document.getElementById('cacheTime').value),
                    maxUploadSize: parseInt(document.getElementById('maxUploadSize').value),
                    debugMode: document.getElementById('debugMode').checked,
                    customCSS: document.getElementById('customCSS').value
                }
            };

            return settings;
        }

        /**
         * Guarda todos los ajustes de configuración
         */
        function saveAllSettings() {
            try {
                toggleLoader(true);

                // Recopilar configuración de la interfaz
                const settings = collectSettingsFromUI();

                // Guardar configuración
                if (saveSettings(settings)) {
                    // Aplicar configuración
                    applySettings(settings);

                    showNotification('Configuración guardada correctamente', 'success');
                } else {
                    showNotification('Error al guardar la configuración', 'danger');
                }
            } catch (error) {
                console.error('Error al guardar la configuración:', error);
                showNotification('Error al guardar la configuración', 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Restablece todos los ajustes de configuración a los valores predeterminados
         */
        function resetAllSettings() {
            try {
                if (!confirm('¿Está seguro de restablecer toda la configuración a los valores predeterminados? Esta acción no se puede deshacer.')) {
                    return;
                }

                toggleLoader(true);

                // Guardar configuración predeterminada
                if (saveSettings(defaultSettings)) {
                    // Actualizar interfaz
                    updateSettingsUI(defaultSettings);

                    // Aplicar configuración
                    applySettings(defaultSettings);

                    showNotification('Configuración restablecida correctamente', 'success');
                } else {
                    showNotification('Error al restablecer la configuración', 'danger');
                }
            } catch (error) {
                console.error('Error al restablecer la configuración:', error);
                showNotification('Error al restablecer la configuración', 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Exporta la configuración a un archivo JSON
         */
        function exportSettings() {
            try {
                const settings = loadSettings();
                const settingsJson = JSON.stringify(settings, null, 2);
                const blob = new Blob([settingsJson], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = 'sistema-bodega-configuracion.json';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);

                URL.revokeObjectURL(url);

                showNotification('Configuración exportada correctamente', 'success');
            } catch (error) {
                console.error('Error al exportar la configuración:', error);
                showNotification('Error al exportar la configuración', 'danger');
            }
        }

        /**
         * Importa la configuración desde un archivo JSON
         * @param {Event} event - Evento de cambio de archivo
         */
        function importSettings(event) {
            try {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();

                reader.onload = function (e) {
                    try {
                        const settings = JSON.parse(e.target.result);

                        // Validar estructura básica
                        if (!settings.general || !settings.appearance || !settings.notifications ||
                            !settings.database || !settings.advanced) {
                            throw new Error('El archivo no contiene una configuración válida');
                        }

                        // Guardar configuración
                        if (saveSettings(settings)) {
                            // Actualizar interfaz
                            updateSettingsUI(settings);

                            // Aplicar configuración
                            applySettings(settings);

                            showNotification('Configuración importada correctamente', 'success');
                        } else {
                            showNotification('Error al importar la configuración', 'danger');
                        }
                    } catch (error) {
                        console.error('Error al procesar el archivo:', error);
                        showNotification('El archivo no contiene una configuración válida', 'danger');
                    }
                };

                reader.readAsText(file);
            } catch (error) {
                console.error('Error al importar la configuración:', error);
                showNotification('Error al importar la configuración', 'danger');
            }
        }

        /**
         * Alterna la visibilidad de la contraseña
         */
        function togglePasswordVisibility() {
            const passwordField = document.getElementById('supabaseKey');
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                document.getElementById('toggleKeyVisibility').innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                passwordField.type = 'password';
                document.getElementById('toggleKeyVisibility').innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        /**
         * Prueba la conexión con Supabase
         */
        async function testDatabaseConnection() {
            try {
                toggleLoader(true);

                const url = document.getElementById('supabaseUrl').value;
                const key = document.getElementById('supabaseKey').value;

                if (!url || !key) {
                    showNotification('URL y clave son obligatorios', 'warning');
                    return;
                }

                // Crear cliente temporal
                const tempSupabase = supabase.createClient(url, key);

                // Probar conexión
                const { data, error } = await tempSupabase
                    .from('superstore_items')
                    .select('*')
                    .limit(1);

                if (error) throw error;

                showNotification('Conexión exitosa con la base de datos', 'success');
            } catch (error) {
                console.error('Error al probar conexión:', error);
                showNotification(`Error al conectar: ${error.message || 'Revise las credenciales'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Sincroniza los datos con Supabase
         */
        async function syncDatabase() {
            try {
                if (!confirm('¿Desea sincronizar los datos con la base de datos ahora?')) {
                    return;
                }

                toggleLoader(true);

                await loadAllData();

                showNotification('Datos sincronizados correctamente', 'success');

                // Actualizar timestamp de última sincronización
                const lastSyncTimeElement = document.getElementById('lastSyncTime');
                if (lastSyncTimeElement) {
                    lastSyncTimeElement.textContent = 'Última sincronización: ' + new Date().toLocaleString();
                }
            } catch (error) {
                console.error('Error al sincronizar datos:', error);
                showNotification('Error al sincronizar datos', 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Exporta la base de datos local
         */
        function exportLocalDatabase() {
            try {
                // Recopilar todos los datos
                const data = {
                    inventory: inventory,
                    transactions: transactions,
                    staff: staff,
                    loans: loans,
                    alerts: alerts,
                    exportDate: new Date().toISOString()
                };

                // Convertir a JSON
                const dataJson = JSON.stringify(data, null, 2);
                const blob = new Blob([dataJson], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                // Crear enlace de descarga
                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = 'sistema-bodega-datos.json';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);

                URL.revokeObjectURL(url);

                showNotification('Datos exportados correctamente', 'success');
            } catch (error) {
                console.error('Error al exportar datos:', error);
                showNotification('Error al exportar datos', 'danger');
            }
        }

        /**
         * Importa datos desde un archivo JSON
         * @param {Event} event - Evento de cambio de archivo
         */
        function importDatabase(event) {
            try {
                const file = event.target.files[0];
                if (!file) return;

                if (!confirm('¿Está seguro de importar datos? Esta acción reemplazará todos los datos actuales.')) {
                    return;
                }

                toggleLoader(true);

                const reader = new FileReader();

                reader.onload = function (e) {
                    try {
                        const data = JSON.parse(e.target.result);

                        // Validar estructura básica
                        if (!data.inventory || !data.transactions || !data.staff ||
                            !data.loans || !data.alerts) {
                            throw new Error('El archivo no contiene datos válidos');
                        }

                        // Asignar datos
                        inventory = data.inventory;
                        transactions = data.transactions;
                        staff = data.staff;
                        loans = data.loans;
                        alerts = data.alerts;

                        // Guardar en localStorage
                        saveDataToLocalStorage();

                        // Actualizar interfaz
                        updateDashboard();
                        renderInventoryTable();
                        renderTransactionsTable();
                        renderStaffTable();
                        renderLoansTable();
                        renderAlertsTable();

                        showNotification('Datos importados correctamente', 'success');
                        toggleLoader(false);
                    } catch (error) {
                        console.error('Error al procesar el archivo:', error);
                        showNotification('El archivo no contiene datos válidos', 'danger');
                        toggleLoader(false);
                    }
                };

                reader.readAsText(file);
            } catch (error) {
                console.error('Error al importar datos:', error);
                showNotification('Error al importar datos', 'danger');
                toggleLoader(false);
            }
        }

        /**
         * Limpia la caché del sistema
         */
        function clearCache() {
            try {
                if (!confirm('¿Está seguro de limpiar la caché? Se perderán los datos no guardados.')) {
                    return;
                }

                // Limpiar caché de aplicación
                localStorage.removeItem('inventoryData');
                localStorage.removeItem('transactionsData');
                localStorage.removeItem('staffData');
                localStorage.removeItem('loansData');
                localStorage.removeItem('alertsData');
                localStorage.removeItem('lastSync');

                showNotification('Caché limpiada correctamente. Recargando datos...', 'success');

                // Recargar datos desde la base de datos
                setTimeout(() => {
                    loadAllData();
                }, 1000);
            } catch (error) {
                console.error('Error al limpiar caché:', error);
                showNotification('Error al limpiar caché', 'danger');
            }
        }

        /**
         * Optimiza la base de datos (Simulación)
         */
        function optimizeDatabase() {
            try {
                if (!confirm('¿Está seguro de optimizar la base de datos? Este proceso puede tardar unos minutos.')) {
                    return;
                }

                toggleLoader(true);

                // Simulación de optimización
                setTimeout(() => {
                    toggleLoader(false);
                    showNotification('Base de datos optimizada correctamente', 'success');
                }, 2000);
            } catch (error) {
                console.error('Error al optimizar base de datos:', error);
                showNotification('Error al optimizar base de datos', 'danger');
                toggleLoader(false);
            }
        }

        /**
         * Inicializa los eventos de la sección de configuración
         */
        function initializeSettingsEvents() {
            // Eventos de tabs de configuración
            const settingsTabs = document.getElementById('settingsTabs');
            if (settingsTabs) {
                const tabs = settingsTabs.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        // Actualizar tabs
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        // Mostrar contenedor correspondiente
                        const setting = this.dataset.setting;
                        document.querySelectorAll('.settings-container').forEach(container => {
                            container.style.display = 'none';
                        });
                        document.getElementById(`${setting}SettingsContainer`).style.display = 'block';
                    });
                });
            }

            // Botones de selector de tema
            const themeButtons = document.querySelectorAll('.theme-selector-btn');
            themeButtons.forEach(btn => {
                btn.addEventListener('click', function () {
                    themeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Notificaciones por email
            const enableEmailNotifications = document.getElementById('enableEmailNotifications');
            if (enableEmailNotifications) {
                enableEmailNotifications.addEventListener('change', function () {
                    const emailContainer = document.getElementById('emailNotificationsContainer');
                    if (emailContainer) {
                        emailContainer.style.display = this.checked ? 'block' : 'none';
                    }
                });
            }

            // Botón de visibilidad de clave
            const toggleKeyVisibility = document.getElementById('toggleKeyVisibility');
            if (toggleKeyVisibility) {
                toggleKeyVisibility.addEventListener('click', togglePasswordVisibility);
            }

            // Botón de probar conexión
            const testConnection = document.getElementById('testConnection');
            if (testConnection) {
                testConnection.addEventListener('click', testDatabaseConnection);
            }

            // Botón de sincronizar ahora
            const syncNowBtn = document.getElementById('syncNowBtn');
            if (syncNowBtn) {
                syncNowBtn.addEventListener('click', syncDatabase);
            }

            // Botón de exportar base de datos
            const exportDatabaseBtn = document.getElementById('exportDatabaseBtn');
            if (exportDatabaseBtn) {
                exportDatabaseBtn.addEventListener('click', exportLocalDatabase);
            }

            // Botón de importar base de datos
            const importDatabaseBtn = document.getElementById('importDatabaseBtn');
            if (importDatabaseBtn) {
                importDatabaseBtn.addEventListener('click', function () {
                    const databaseFile = document.getElementById('databaseFile');
                    if (databaseFile) {
                        databaseFile.click();
                    }
                });
            }

            // Cambio en input de archivo para importar base de datos
            const databaseFile = document.getElementById('databaseFile');
            if (databaseFile) {
                databaseFile.addEventListener('change', importDatabase);
            }

            // Botón de limpiar caché
            const clearCacheBtn = document.getElementById('clearCacheBtn');
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', clearCache);
            }

            // Botón de optimizar base de datos
            const optimizeDbBtn = document.getElementById('optimizeDbBtn');
            if (optimizeDbBtn) {
                optimizeDbBtn.addEventListener('click', optimizeDatabase);
            }

            // Botón de guardar configuración
            const saveAllSettingsBtn = document.getElementById('saveAllSettingsBtn');
            if (saveAllSettingsBtn) {
                saveAllSettingsBtn.addEventListener('click', saveAllSettings);
            }

            // Botón de restablecer configuración
            const resetAllSettingsBtn = document.getElementById('resetAllSettingsBtn');
            if (resetAllSettingsBtn) {
                resetAllSettingsBtn.addEventListener('click', resetAllSettings);
            }

            // Botón de exportar configuración
            const exportSettingsBtn = document.getElementById('exportSettingsBtn');
            if (exportSettingsBtn) {
                exportSettingsBtn.addEventListener('click', exportSettings);
            }

            // Botón de importar configuración
            const importSettingsBtn = document.getElementById('importSettingsBtn');
            if (importSettingsBtn) {
                importSettingsBtn.addEventListener('click', function () {
                    const settingsFile = document.createElement('input');
                    settingsFile.type = 'file';
                    settingsFile.accept = '.json';
                    settingsFile.addEventListener('change', importSettings);
                    settingsFile.click();
                });
            }

            // Botones modales de restablecimiento
            const resetSettingsBtn = document.getElementById('resetSettingsBtn');
            if (resetSettingsBtn) {
                resetSettingsBtn.addEventListener('click', function () {
                    document.getElementById('resetConfirmModal').classList.add('active');
                });
            }

            const factoryResetBtn = document.getElementById('factoryResetBtn');
            if (factoryResetBtn) {
                factoryResetBtn.addEventListener('click', function () {
                    document.getElementById('factoryResetConfirmModal').classList.add('active');
                });
            }

            // Confirmación de texto para reset
            const resetConfirmText = document.getElementById('resetConfirmText');
            if (resetConfirmText) {
                resetConfirmText.addEventListener('input', function () {
                    const confirmResetBtn = document.getElementById('confirmResetBtn');
                    if (confirmResetBtn) {
                        confirmResetBtn.disabled = this.value !== 'CONFIRMAR';
                    }
                });
            }

            // Confirmación de texto para factory reset
            const factoryResetConfirmText = document.getElementById('factoryResetConfirmText');
            if (factoryResetConfirmText) {
                factoryResetConfirmText.addEventListener('input', function () {
                    const confirmFactoryResetBtn = document.getElementById('confirmFactoryResetBtn');
                    if (confirmFactoryResetBtn) {
                        confirmFactoryResetBtn.disabled = this.value !== 'RESTAURAR FÁBRICA';
                    }
                });
            }

            // Botones para cerrar modales de confirmación
            const closeResetConfirmModal = document.getElementById('closeResetConfirmModal');
            if (closeResetConfirmModal) {
                closeResetConfirmModal.addEventListener('click', function () {
                    document.getElementById('resetConfirmModal').classList.remove('active');
                });
            }

            const closeFactoryResetConfirmModal = document.getElementById('closeFactoryResetConfirmModal');
            if (closeFactoryResetConfirmModal) {
                closeFactoryResetConfirmModal.addEventListener('click', function () {
                    document.getElementById('factoryResetConfirmModal').classList.remove('active');
                });
            }

            const cancelResetBtn = document.getElementById('cancelResetBtn');
            if (cancelResetBtn) {
                cancelResetBtn.addEventListener('click', function () {
                    document.getElementById('resetConfirmModal').classList.remove('active');
                });
            }

            const cancelFactoryResetBtn = document.getElementById('cancelFactoryResetBtn');
            if (cancelFactoryResetBtn) {
                cancelFactoryResetBtn.addEventListener('click', function () {
                    document.getElementById('factoryResetConfirmModal').classList.remove('active');
                });
            }

            // Botones de confirmar restablecimiento
            const confirmResetBtn = document.getElementById('confirmResetBtn');
            if (confirmResetBtn) {
                confirmResetBtn.addEventListener('click', function () {
                    document.getElementById('resetConfirmModal').classList.remove('active');
                    resetAllSettings();
                });
            }

            const confirmFactoryResetBtn = document.getElementById('confirmFactoryResetBtn');
            if (confirmFactoryResetBtn) {
                confirmFactoryResetBtn.addEventListener('click', function () {
                    document.getElementById('factoryResetConfirmModal').classList.remove('active');
                    factoryReset();
                });
            }

            // Guardar configuración de base de datos
            const saveDbSettings = document.getElementById('saveDbSettings');
            if (saveDbSettings) {
                saveDbSettings.addEventListener('click', function () {
                    const settings = loadSettings();

                    settings.database = {
                        supabaseUrl: document.getElementById('supabaseUrl').value,
                        supabaseKey: document.getElementById('supabaseKey').value,
                        syncInterval: parseInt(document.getElementById('syncInterval').value),
                        offlineMode: document.getElementById('offlineMode').checked
                    };

                    if (saveSettings(settings)) {
                        updateSyncInterval(settings.database.syncInterval);
                        showNotification('Configuración de base de datos guardada', 'success');
                    } else {
                        showNotification('Error al guardar configuración', 'danger');
                    }
                });
            }

            // Restablecer configuración de base de datos
            const resetDbSettings = document.getElementById('resetDbSettings');
            if (resetDbSettings) {
                resetDbSettings.addEventListener('click', function () {
                    document.getElementById('supabaseUrl').value = defaultSettings.database.supabaseUrl;
                    document.getElementById('supabaseKey').value = defaultSettings.database.supabaseKey;
                    document.getElementById('syncInterval').value = defaultSettings.database.syncInterval;
                    document.getElementById('offlineMode').checked = defaultSettings.database.offlineMode;
                });
            }
        }

        /**
         * Realiza un restablecimiento completo de fábrica
         */
        function factoryReset() {
            try {
                toggleLoader(true);

                // Limpiar todo el almacenamiento local
                localStorage.clear();

                // Guardar configuración predeterminada
                saveSettings(defaultSettings);

                // Mostrar mensaje
                showNotification('Restauración de fábrica completada. Recargando...', 'success');

                // Recargar la página después de un breve retraso
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } catch (error) {
                console.error('Error al realizar restauración de fábrica:', error);
                showNotification('Error al realizar restauración de fábrica', 'danger');
                toggleLoader(false);
            }
        }

        /**
         * Inicializa la configuración del sistema
         */
        function initializeSettings() {
            try {
                // Cargar configuración
                const settings = loadSettings();

                // Actualizar interfaz
                updateSettingsUI(settings);

                // Aplicar configuración
                applySettings(settings);

                // Inicializar eventos
                initializeSettingsEvents();

                console.log('Configuración inicializada correctamente');
            } catch (error) {
                console.error('Error al inicializar la configuración:', error);
            }
        }

        // Llamar a esta función cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function () {
            const oldInitializeEvents = window.initializeEvents;
            window.initializeEvents = function () {
                // Llamar a la función original
                oldInitializeEvents();

                // Inicializar configuración
                initializeSettings();
            };
        });

        /**
         * Sistema Completo de Gestión de Alertas
         */

        // Tipos de alerta soportados por el sistema
        const ALERT_TYPES = {
            LOW_STOCK: 'low_stock',
            LOAN_DUE: 'loan_due',
            LOAN_OVERDUE: 'loan_overdue',
            TRANSACTION: 'transaction',
            ITEM_EXPIRED: 'item_expired',
            SYSTEM: 'system',
            SECURITY: 'security',
            MAINTENANCE: 'maintenance'
        };

        // Niveles de prioridad de alertas
        const ALERT_PRIORITIES = {
            HIGH: 'high',
            MEDIUM: 'medium',
            LOW: 'low'
        };

        /**
         * Crea una nueva alerta en el sistema
         * @param {Object} alertData - Datos de la alerta
         * @returns {Promise<Object>} - Alerta creada
         */
        async function createAlert(alertData) {
            try {
                // Validar datos mínimos
                if (!alertData.type || !alertData.description) {
                    throw new Error('Tipo y descripción son obligatorios para crear una alerta');
                }

                // Estructurar datos de la alerta
                const newAlert = {
                    date: alertData.date || new Date().toISOString(),
                    type: alertData.type,
                    description: alertData.description,
                    status: alertData.status || 'active',
                    created_at: new Date().toISOString(),
                    // Campos opcionales
                    related_item: alertData.related_item || null,
                    related_loan: alertData.related_loan || null,
                    related_transaction: alertData.related_transaction || null,
                    related_staff: alertData.related_staff || null,
                    notify_users: alertData.notify_users || false,
                    expiration_date: alertData.expiration_date || null
                };

                // Si estamos online, guardar en Supabase
                if (isOnline && supabase) {
                    const { data, error } = await supabase
                        .from('superstore_alerts')
                        .insert([newAlert])
                        .select();

                    if (error) throw error;

                    // Actualizar datos en memoria
                    if (data && data.length > 0) {
                        alerts.unshift(data[0]);

                        // Reproducir sonido de alerta si está habilitado
                        if (alertData.notify_users) {
                            playAlertSound(alertData.type);
                        }

                        // Mostrar notificación si está configurado
                        if (alertData.show_notification) {
                            const settings = loadSettings();
                            const enabledTypes = {
                                [ALERT_TYPES.LOW_STOCK]: settings.notifications.showLowStockAlerts,
                                [ALERT_TYPES.LOAN_DUE]: settings.notifications.showLoanAlerts,
                                [ALERT_TYPES.LOAN_OVERDUE]: settings.notifications.showLoanAlerts,
                                [ALERT_TYPES.TRANSACTION]: settings.notifications.showTransactionAlerts,
                                [ALERT_TYPES.SYSTEM]: settings.notifications.showSystemAlerts
                            };

                            if (enabledTypes[alertData.type]) {
                                showAlertNotification(data[0]);
                            }
                        }

                        return data[0];
                    }
                } else {
                    // Modo offline: actualizar en memoria y localStorage
                    const newAlertWithId = {
                        ...newAlert,
                        id: generateUniqueId()
                    };

                    alerts.unshift(newAlertWithId);

                    // Guardar en localStorage
                    saveDataToLocalStorage();

                    // Reproducir sonido de alerta si está habilitado
                    if (alertData.notify_users) {
                        playAlertSound(alertData.type);
                    }

                    // Mostrar notificación si está configurado
                    if (alertData.show_notification) {
                        const settings = loadSettings();
                        const enabledTypes = {
                            [ALERT_TYPES.LOW_STOCK]: settings.notifications.showLowStockAlerts,
                            [ALERT_TYPES.LOAN_DUE]: settings.notifications.showLoanAlerts,
                            [ALERT_TYPES.LOAN_OVERDUE]: settings.notifications.showLoanAlerts,
                            [ALERT_TYPES.TRANSACTION]: settings.notifications.showTransactionAlerts,
                            [ALERT_TYPES.SYSTEM]: settings.notifications.showSystemAlerts
                        };

                        if (enabledTypes[alertData.type]) {
                            showAlertNotification(newAlertWithId);
                        }
                    }

                    return newAlertWithId;
                }
            } catch (error) {
                console.error('Error al crear alerta:', error);
                throw error;
            }
        }

        /**
         * Muestra una notificación para una alerta específica
         * @param {Object} alert - Alerta a notificar
         */
        function showAlertNotification(alert) {
            const typeIcons = {
                [ALERT_TYPES.LOW_STOCK]: 'fas fa-boxes-stacked',
                [ALERT_TYPES.LOAN_DUE]: 'fas fa-clock',
                [ALERT_TYPES.LOAN_OVERDUE]: 'fas fa-exclamation-triangle',
                [ALERT_TYPES.TRANSACTION]: 'fas fa-exchange-alt',
                [ALERT_TYPES.ITEM_EXPIRED]: 'fas fa-calendar-times',
                [ALERT_TYPES.SYSTEM]: 'fas fa-server',
                [ALERT_TYPES.SECURITY]: 'fas fa-shield-alt',
                [ALERT_TYPES.MAINTENANCE]: 'fas fa-tools'
            };

            const typeColors = {
                [ALERT_TYPES.LOW_STOCK]: 'warning',
                [ALERT_TYPES.LOAN_DUE]: 'info',
                [ALERT_TYPES.LOAN_OVERDUE]: 'danger',
                [ALERT_TYPES.TRANSACTION]: 'primary',
                [ALERT_TYPES.ITEM_EXPIRED]: 'warning',
                [ALERT_TYPES.SYSTEM]: 'info',
                [ALERT_TYPES.SECURITY]: 'danger',
                [ALERT_TYPES.MAINTENANCE]: 'warning'
            };

            const icon = typeIcons[alert.type] || 'fas fa-bell';
            const color = typeColors[alert.type] || 'info';

            // Mostrar notificación
            showNotification(alert.description, color, icon, getAlertTypeName(alert.type));
        }

        /**
         * Reproduce un sonido de alerta según el tipo
         * @param {string} alertType - Tipo de alerta
         */
        function playAlertSound(alertType) {
            const settings = loadSettings();

            // Si los sonidos están desactivados, no hacer nada
            if (!settings.notifications.enableSoundAlerts) {
                return;
            }

            // Mapeo de tipos de alerta a sonidos
            const alertSounds = {
                [ALERT_TYPES.LOW_STOCK]: 'low_stock_alert.mp3',
                [ALERT_TYPES.LOAN_DUE]: 'loan_due_alert.mp3',
                [ALERT_TYPES.LOAN_OVERDUE]: 'loan_overdue_alert.mp3',
                [ALERT_TYPES.SECURITY]: 'security_alert.mp3',
                'default': 'notification.mp3'
            };

            // Seleccionar el sonido según el tipo
            const soundFile = alertSounds[alertType] || alertSounds.default;

            // Crear y reproducir elemento de audio
            // Nota: En una implementación real, estos archivos deberían existir
            try {
                const audio = new Audio(`assets/sounds/${soundFile}`);
                audio.volume = 0.7;
                audio.play().catch(e => console.log('No se pudo reproducir el sonido de alerta'));
            } catch (error) {
                console.log('Error al reproducir sonido de alerta');
            }
        }

        /**
         * Genera alertas automáticas para el sistema basadas en el estado actual
         * Este método se puede llamar periódicamente para mantener el sistema de alertas actualizado
         */
        async function generateSystemAlerts() {
            try {
                // Verificar si hay artículos con stock bajo
                await generateLowStockAlerts();

                // Verificar préstamos por vencer
                await generateLoanDueAlerts();

                // Verificar préstamos vencidos
                await generateLoanOverdueAlerts();

                // Verificar artículos caducados (para artículos con ciclo de vida)
                await generateItemExpirationAlerts();

                // Actualizar contador e interfaz de alertas
                updateAlertCount();
                renderAlertsTable();
            } catch (error) {
                console.error('Error al generar alertas del sistema:', error);
            }
        }

        /**
         * Genera alertas para artículos con stock bajo
         */
        async function generateLowStockAlerts() {
            try {
                const settings = loadSettings();
                const threshold = settings.notifications.lowStockThreshold || 10;

                // Obtener artículos con stock bajo que no tengan alertas activas
                const lowStockItems = inventory.filter(item => {
                    // Verificar si el stock está por debajo del umbral
                    const isLowStock = item.stock < (item.min_stock || threshold);

                    // Verificar si ya existe una alerta activa para este artículo
                    const hasActiveAlert = alerts.some(a =>
                        a.status === 'active' &&
                        a.type === ALERT_TYPES.LOW_STOCK &&
                        a.related_item === item.id
                    );

                    return isLowStock && !hasActiveAlert;
                });

                // Crear alertas para cada artículo con stock bajo
                for (const item of lowStockItems) {
                    await createAlert({
                        type: ALERT_TYPES.LOW_STOCK,
                        description: `Stock bajo: ${item.name} (${item.code || 'Sin código'}). Stock actual: ${item.stock}, Stock mínimo: ${item.min_stock || threshold}`,
                        related_item: item.id,
                        notify_users: true,
                        show_notification: true
                    });
                }
            } catch (error) {
                console.error('Error al generar alertas de stock bajo:', error);
            }
        }

        /**
         * Genera alertas para préstamos por vencer
         */
        async function generateLoanDueAlerts() {
            try {
                const settings = loadSettings();
                const daysThreshold = settings.notifications.loanReminderDays || 3;

                // Fecha actual
                const today = new Date();

                // Filtrar préstamos activos que vencen pronto y no tienen alertas asociadas
                const dueLoans = loans.filter(loan => {
                    // Verificar si el préstamo está activo
                    if (loan.status !== 'active') return false;

                    // Calcular días restantes
                    const returnDate = new Date(loan.return_date);
                    const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                    // Verificar si está dentro del umbral (positivo y <= daysThreshold)
                    const isDueSoon = daysRemaining >= 0 && daysRemaining <= daysThreshold;

                    // Verificar si ya existe una alerta activa para este préstamo
                    const hasActiveAlert = alerts.some(a =>
                        a.status === 'active' &&
                        a.type === ALERT_TYPES.LOAN_DUE &&
                        a.related_loan === loan.id
                    );

                    return isDueSoon && !hasActiveAlert;
                });

                // Crear alertas para cada préstamo por vencer
                for (const loan of dueLoans) {
                    const returnDate = new Date(loan.return_date);
                    const daysRemaining = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));

                    const item = inventory.find(i => i.id === loan.item_id) || { name: 'Artículo desconocido' };
                    const person = staff.find(s => s.id === loan.person_id) || { name: 'Personal desconocido' };

                    let description = '';
                    if (daysRemaining === 0) {
                        description = `Préstamo vence HOY: ${item.name} prestado a ${person.name}. Devolución: ${formatDate(loan.return_date)}`;
                    } else if (daysRemaining === 1) {
                        description = `Préstamo vence MAÑANA: ${item.name} prestado a ${person.name}. Devolución: ${formatDate(loan.return_date)}`;
                    } else {
                        description = `Préstamo por vencer: ${item.name} prestado a ${person.name}. Devolución en ${daysRemaining} días (${formatDate(loan.return_date)})`;
                    }

                    await createAlert({
                        type: ALERT_TYPES.LOAN_DUE,
                        description: description,
                        related_loan: loan.id,
                        related_item: loan.item_id,
                        related_staff: loan.person_id,
                        notify_users: daysRemaining <= 1, // Notificar si vence hoy o mañana
                        show_notification: true
                    });
                }
            } catch (error) {
                console.error('Error al generar alertas de préstamos por vencer:', error);
            }
        }

        /**
         * Genera alertas para préstamos vencidos
         */
        async function generateLoanOverdueAlerts() {
            try {
                // Fecha actual
                const today = new Date();

                // Filtrar préstamos activos vencidos que no tienen alertas asociadas
                const overdueLoans = loans.filter(loan => {
                    // Verificar si el préstamo está activo
                    if (loan.status !== 'active') return false;

                    // Verificar si está vencido
                    const returnDate = new Date(loan.return_date);
                    const isOverdue = returnDate < today;

                    // Verificar si ya existe una alerta activa para este préstamo
                    const hasActiveAlert = alerts.some(a =>
                        a.status === 'active' &&
                        a.type === ALERT_TYPES.LOAN_OVERDUE &&
                        a.related_loan === loan.id
                    );

                    return isOverdue && !hasActiveAlert;
                });

                // Crear alertas para cada préstamo vencido
                for (const loan of overdueLoans) {
                    const returnDate = new Date(loan.return_date);
                    const daysOverdue = Math.ceil((today - returnDate) / (1000 * 60 * 60 * 24));

                    const item = inventory.find(i => i.id === loan.item_id) || { name: 'Artículo desconocido' };
                    const person = staff.find(s => s.id === loan.person_id) || { name: 'Personal desconocido' };

                    await createAlert({
                        type: ALERT_TYPES.LOAN_OVERDUE,
                        description: `Préstamo VENCIDO: ${item.name} prestado a ${person.name}. Vencido hace ${daysOverdue} días (${formatDate(loan.return_date)})`,
                        related_loan: loan.id,
                        related_item: loan.item_id,
                        related_staff: loan.person_id,
                        notify_users: true,
                        show_notification: true
                    });
                }
            } catch (error) {
                console.error('Error al generar alertas de préstamos vencidos:', error);
            }
        }

        /**
         * Genera alertas para artículos con ciclo de vida caducado
         */
        async function generateItemExpirationAlerts() {
            try {
                // Fecha actual
                const today = new Date();

                // Filtrar artículos con ciclo de vida caducado o por caducar
                const expiringItems = inventory.filter(item => {
                    // Si no tiene ciclo de vida o es indefinido, no aplica
                    if (!item.life_cycle || item.life_cycle === 'indefinite') {
                        return false;
                    }

                    // Si no tiene fecha de actualización, no se puede calcular
                    if (!item.updated_at) {
                        return false;
                    }

                    // Calcular fecha de caducidad basada en el ciclo de vida
                    const updatedDate = new Date(item.updated_at);
                    let expirationDate = new Date(updatedDate);

                    switch (item.life_cycle) {
                        case 'daily':
                            expirationDate.setDate(updatedDate.getDate() + 1);
                            break;
                        case '1week':
                            expirationDate.setDate(updatedDate.getDate() + 7);
                            break;
                        case '2weeks':
                            expirationDate.setDate(updatedDate.getDate() + 14);
                            break;
                        case '3weeks':
                            expirationDate.setDate(updatedDate.getDate() + 21);
                            break;
                        case '1month':
                            expirationDate.setMonth(updatedDate.getMonth() + 1);
                            break;
                        default:
                            return false;
                    }

                    // Verificar si está caducado o caduca en los próximos 3 días
                    const daysToExpiration = Math.ceil((expirationDate - today) / (1000 * 60 * 60 * 24));
                    const isExpiringSoon = daysToExpiration >= 0 && daysToExpiration <= 3;
                    const isExpired = daysToExpiration < 0;

                    // Verificar si ya existe una alerta activa para este artículo
                    const hasActiveAlert = alerts.some(a =>
                        a.status === 'active' &&
                        a.type === ALERT_TYPES.ITEM_EXPIRED &&
                        a.related_item === item.id
                    );

                    return (isExpiringSoon || isExpired) && !hasActiveAlert;
                });

                // Crear alertas para cada artículo caducado o por caducar
                for (const item of expiringItems) {
                    const updatedDate = new Date(item.updated_at);
                    let expirationDate = new Date(updatedDate);

                    switch (item.life_cycle) {
                        case 'daily':
                            expirationDate.setDate(updatedDate.getDate() + 1);
                            break;
                        case '1week':
                            expirationDate.setDate(updatedDate.getDate() + 7);
                            break;
                        case '2weeks':
                            expirationDate.setDate(updatedDate.getDate() + 14);
                            break;
                        case '3weeks':
                            expirationDate.setDate(updatedDate.getDate() + 21);
                            break;
                        case '1month':
                            expirationDate.setMonth(updatedDate.getMonth() + 1);
                            break;
                    }

                    const daysToExpiration = Math.ceil((expirationDate - today) / (1000 * 60 * 60 * 24));
                    let description = '';

                    if (daysToExpiration < 0) {
                        description = `Artículo CADUCADO: ${item.name} (${item.code || 'Sin código'}). Caducó hace ${Math.abs(daysToExpiration)} días.`;
                    } else if (daysToExpiration === 0) {
                        description = `Artículo caduca HOY: ${item.name} (${item.code || 'Sin código'}).`;
                    } else {
                        description = `Artículo por caducar: ${item.name} (${item.code || 'Sin código'}). Caduca en ${daysToExpiration} días.`;
                    }

                    await createAlert({
                        type: ALERT_TYPES.ITEM_EXPIRED,
                        description: description,
                        related_item: item.id,
                        notify_users: daysToExpiration <= 0, // Notificar si caduca hoy o ya caducó
                        show_notification: true
                    });
                }
            } catch (error) {
                console.error('Error al generar alertas de caducidad:', error);
            }
        }

        /**
         * Crea una alerta de transacción cuando se realizan movimientos importantes
         * @param {Object} transaction - Datos de la transacción
         */
        async function createTransactionAlert(transaction) {
            try {
                if (!transaction) return;

                const item = inventory.find(i => i.id === transaction.item_id) || { name: 'Artículo desconocido' };
                const person = staff.find(s => s.id === transaction.person_id) || { name: 'Personal desconocido' };

                // Solo crear alertas para transacciones significativas (ej: grandes cantidades)
                if (transaction.quantity >= 50) {
                    let description = '';
                    if (transaction.type === 'in') {
                        description = `Ingreso importante: ${transaction.quantity} unidades de ${item.name} por ${person.name}`;
                    } else { // out
                        description = `Entrega importante: ${transaction.quantity} unidades de ${item.name} a ${person.name}`;
                    }

                    await createAlert({
                        type: ALERT_TYPES.TRANSACTION,
                        description: description,
                        related_transaction: transaction.id,
                        related_item: transaction.item_id,
                        related_staff: transaction.person_id,
                        notify_users: transaction.quantity >= 100, // Notificar solo para cantidades muy grandes
                        show_notification: true
                    });
                }
            } catch (error) {
                console.error('Error al crear alerta de transacción:', error);
            }
        }

        /**
         * Crea una alerta de seguridad (acceso, cambios de configuración, etc.)
         * @param {string} description - Descripción de la alerta
         * @param {Object} options - Opciones adicionales
         */
        async function createSecurityAlert(description, options = {}) {
            try {
                await createAlert({
                    type: ALERT_TYPES.SECURITY,
                    description: description,
                    notify_users: true,
                    show_notification: true,
                    ...options
                });
            } catch (error) {
                console.error('Error al crear alerta de seguridad:', error);
            }
        }

        /**
         * Crea una alerta de mantenimiento del sistema
         * @param {string} description - Descripción de la alerta
         * @param {Object} options - Opciones adicionales
         */
        async function createMaintenanceAlert(description, options = {}) {
            try {
                await createAlert({
                    type: ALERT_TYPES.MAINTENANCE,
                    description: description,
                    notify_users: options.notify_users || false,
                    show_notification: options.show_notification || false,
                    ...options
                });
            } catch (error) {
                console.error('Error al crear alerta de mantenimiento:', error);
            }
        }

        /**
         * Marca una alerta como leída
         * @param {number} alertId - ID de la alerta
         */
        async function markAlertAsRead(alertId) {
            try {
                // Si estamos online, actualizar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_alerts')
                        .update({
                            status: 'read',
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', alertId);

                    if (error) throw error;
                }

                // Actualizar en memoria
                const alertIndex = alerts.findIndex(a => a.id === alertId);
                if (alertIndex !== -1) {
                    alerts[alertIndex].status = 'read';
                    alerts[alertIndex].updated_at = new Date().toISOString();
                }

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                updateAlertCount();
                renderAlertsTable();
            } catch (error) {
                console.error('Error al marcar alerta como leída:', error);
                throw error;
            }
        }

        /**
         * Marca todas las alertas como leídas
         */
        async function markAllAlertsAsRead() {
            try {
                // Verificar si hay alertas activas
                const activeAlerts = alerts.filter(a => a.status === 'active');
                if (activeAlerts.length === 0) {
                    showNotification('No hay alertas activas para marcar como leídas', 'info');
                    return;
                }

                // Si estamos online, actualizar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_alerts')
                        .update({
                            status: 'read',
                            updated_at: new Date().toISOString()
                        })
                        .eq('status', 'active');

                    if (error) throw error;
                }

                // Actualizar en memoria
                alerts = alerts.map(alert => {
                    if (alert.status === 'active') {
                        return {
                            ...alert,
                            status: 'read',
                            updated_at: new Date().toISOString()
                        };
                    }
                    return alert;
                });

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                updateAlertCount();
                renderAlertsTable();

                showNotification(`Se han marcado ${activeAlerts.length} alertas como leídas`, 'success');
            } catch (error) {
                console.error('Error al marcar todas las alertas como leídas:', error);
                showNotification('Error al marcar las alertas como leídas', 'danger');
            }
        }

        /**
         * Resuelve una alerta con notas de resolución
         * @param {number} alertId - ID de la alerta
         * @param {string} resolutionType - Tipo de resolución
         * @param {string} resolutionNotes - Notas de resolución
         */
        /**
  * Resuelve una alerta
  * @param {number} alertId - ID de la alerta
  * @param {string} resolutionType - Tipo de resolución (no se guardará en DB)
  * @param {string} resolutionNotes - Notas de resolución (no se guardará en DB)
  */
        async function resolveAlert(alertId) {
            try {
                // Simplificar los datos de actualización para que funcionen con tu esquema actual
                const updateData = {
                    status: 'resolved',
                    updated_at: new Date().toISOString()
                };

                // Si estamos online, actualizar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_alerts')
                        .update(updateData)
                        .eq('id', alertId);

                    if (error) throw error;
                }

                // Actualizar en memoria
                const alertIndex = alerts.findIndex(a => a.id === alertId);
                if (alertIndex !== -1) {
                    alerts[alertIndex] = {
                        ...alerts[alertIndex],
                        ...updateData
                    };
                }

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                updateAlertCount();
                renderAlertsTable();

                return true;
            } catch (error) {
                console.error('Error al resolver alerta:', error);
                throw error;
            }
        }

        /**
         * Procesa la resolución de una alerta desde el modal
         */
        async function processAlertResolution() {
            toggleLoader(true);

            try {
                const alertId = parseInt(document.getElementById('alertId').value);
                // Obtenemos estos valores para mostrarlos en la interfaz, pero no los usamos en la DB
                const resolutionType = document.getElementById('resolutionType').value;
                const resolutionNotes = document.getElementById('resolutionNotes').value;

                // Validaciones
                if (!alertId) {
                    throw new Error('ID de alerta no válido');
                }

                if (!resolutionType) {
                    throw new Error('El tipo de resolución es obligatorio');
                }

                if (!resolutionNotes) {
                    throw new Error('Las notas de resolución son obligatorias');
                }

                // Resolver alerta (con la versión simplificada)
                const success = await resolveAlert(alertId);

                if (success) {
                    // Cerrar modal
                    const modal = document.getElementById('resolveAlertModal');
                    if (modal) modal.classList.remove('active');

                    showNotification('Alerta resuelta correctamente', 'success');
                } else {
                    throw new Error('No se pudo resolver la alerta');
                }
            } catch (error) {
                console.error('Error al resolver alerta:', error);
                showNotification(`Error: ${error.message || 'Error al resolver la alerta'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Elimina una alerta
         * @param {number} alertId - ID de la alerta a eliminar
         */
        async function deleteAlert(alertId) {
            try {
                // Si estamos online, eliminar en Supabase
                if (isOnline && supabase) {
                    const { error } = await supabase
                        .from('superstore_alerts')
                        .delete()
                        .eq('id', alertId);

                    if (error) throw error;
                }

                // Eliminar de la lista de alertas
                alerts = alerts.filter(a => a.id !== alertId);

                // Guardar en localStorage
                saveDataToLocalStorage();

                // Actualizar interfaz
                updateAlertCount();
                renderAlertsTable();

                return true;
            } catch (error) {
                console.error('Error al eliminar alerta:', error);
                throw error;
            }
        }

        /**
         * Procesa la resolución de una alerta desde el modal
         */
        async function processAlertResolution() {
            toggleLoader(true);

            try {
                const alertId = parseInt(document.getElementById('alertId').value);
                const resolutionType = document.getElementById('resolutionType').value;
                const resolutionNotes = document.getElementById('resolutionNotes').value;

                // Validaciones
                if (!alertId) {
                    throw new Error('ID de alerta no válido');
                }

                if (!resolutionType) {
                    throw new Error('El tipo de resolución es obligatorio');
                }

                if (!resolutionNotes) {
                    throw new Error('Las notas de resolución son obligatorias');
                }

                // Resolver alerta
                const success = await resolveAlert(alertId, resolutionType, resolutionNotes);

                if (success) {
                    // Cerrar modal
                    const modal = document.getElementById('resolveAlertModal');
                    if (modal) modal.classList.remove('active');

                    showNotification('Alerta resuelta correctamente', 'success');
                } else {
                    throw new Error('No se pudo resolver la alerta');
                }
            } catch (error) {
                console.error('Error al resolver alerta:', error);
                showNotification(`Error: ${error.message || 'Error al resolver la alerta'}`, 'danger');
            } finally {
                toggleLoader(false);
            }
        }

        /**
         * Obtiene el nombre legible del tipo de alerta
         * @param {string} type - Tipo de alerta
         * @returns {string} Nombre legible del tipo
         */
        function getAlertTypeName(type) {
            const types = {
                [ALERT_TYPES.LOW_STOCK]: 'Stock Bajo',
                [ALERT_TYPES.LOAN_DUE]: 'Préstamo por Vencer',
                [ALERT_TYPES.LOAN_OVERDUE]: 'Préstamo Vencido',
                [ALERT_TYPES.TRANSACTION]: 'Transacción',
                [ALERT_TYPES.ITEM_EXPIRED]: 'Artículo Caducado',
                [ALERT_TYPES.SYSTEM]: 'Sistema',
                [ALERT_TYPES.SECURITY]: 'Seguridad',
                [ALERT_TYPES.MAINTENANCE]: 'Mantenimiento'
            };

            return types[type] || type;
        }

        /**
         * Actualiza el contador de alertas en la interfaz
         */
        function updateAlertCount() {
            if (!elements.alertsCount) return;

            // Contar alertas activas
            const activeAlerts = alerts.filter(a => a.status === 'active').length;

            elements.alertsCount.textContent = activeAlerts;
            elements.alertsCount.style.display = activeAlerts > 0 ? 'flex' : 'none';

            // Actualizar título de la página para mostrar notificaciones
            document.title = activeAlerts > 0
                ? `(${activeAlerts}) Sistema de Gestión de Bodega`
                : 'Sistema de Gestión de Bodega';
        }

        /**
         * Renderiza la tabla de alertas activas
         */
        function renderAlertsTable() {
            // Tabla de alertas activas
            const activeAlertsTable = document.getElementById('activeAlertsTable');
            if (activeAlertsTable) {
                const tbody = activeAlertsTable.querySelector('tbody');
                if (tbody) {
                    tbody.innerHTML = '';

                    // Filtrar alertas activas
                    const activeAlerts = alerts.filter(a => a.status === 'active');

                    if (activeAlerts.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = '<td colspan="5" class="text-center">No hay alertas activas</td>';
                        tbody.appendChild(tr);
                    } else {
                        activeAlerts.forEach(alert => {
                            const tr = document.createElement('tr');

                            // Determinar clases y estilos según tipo
                            let priorityClass = '';
                            let priorityLabel = '';

                            switch (alert.type) {
                                case ALERT_TYPES.LOW_STOCK:
                                    priorityClass = 'badge-warning';
                                    priorityLabel = 'Media';
                                    break;
                                case ALERT_TYPES.LOAN_DUE:
                                    priorityClass = 'badge-info';
                                    priorityLabel = 'Media';
                                    break;
                                case ALERT_TYPES.LOAN_OVERDUE:
                                    priorityClass = 'badge-danger';
                                    priorityLabel = 'Alta';
                                    break;
                                case ALERT_TYPES.SECURITY:
                                    priorityClass = 'badge-danger';
                                    priorityLabel = 'Alta';
                                    break;
                                default:
                                    priorityClass = 'badge-info';
                                    priorityLabel = 'Normal';
                            }

                            tr.innerHTML = `
                        <td>${formatDate(alert.date)}</td>
                        <td>${getAlertTypeName(alert.type)}</td>
                        <td>${alert.description}</td>
                        <td><span class="badge ${priorityClass}">${priorityLabel}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-success resolve-alert-btn" data-id="${alert.id}" title="Resolver">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-primary read-alert-btn" data-id="${alert.id}" title="Marcar como leída">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-alert-btn" data-id="${alert.id}" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                            tbody.appendChild(tr);
                        });

                        // Agregar eventos a los botones
                        tbody.querySelectorAll('.resolve-alert-btn').forEach(btn => {
                            btn.addEventListener('click', function () {
                                const alertId = parseInt(this.dataset.id);
                                openResolveAlertModal(alertId);
                            });
                        });

                        tbody.querySelectorAll('.read-alert-btn').forEach(btn => {
                            btn.addEventListener('click', function () {
                                const alertId = parseInt(this.dataset.id);
                                markAlertAsRead(alertId);
                            });
                        });

                        tbody.querySelectorAll('.delete-alert-btn').forEach(btn => {
                            btn.addEventListener('click', function () {
                                const alertId = parseInt(this.dataset.id);
                                deleteAlert(alertId);
                            });
                        });
                    }
                }
            }

            // Tabla de historial de alertas
            renderAlertHistory();

            // Inicializar gráfico de distribución de alertas si estamos en esa sección
            if (currentSection === 'alerts') {
                initializeAlertsChart();
            }
        }

        /**
         * Renderiza la tabla de historial de alertas
         */
        function renderAlertHistory() {
            const alertsHistoryTable = document.getElementById('alertsHistoryTable');
            if (!alertsHistoryTable) return;

            const tbody = alertsHistoryTable.querySelector('tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            // Ordenar alertas por fecha (más recientes primero)
            const sortedAlerts = [...alerts].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sortedAlerts.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="5" class="text-center">No hay historial de alertas</td>';
                tbody.appendChild(tr);
            } else {
                // Mostrar las 30 alertas más recientes
                sortedAlerts.slice(0, 30).forEach(alert => {
                    const tr = document.createElement('tr');

                    let statusBadge = '';
                    if (alert.status === 'active') {
                        statusBadge = '<span class="badge badge-warning">Activa</span>';
                    } else if (alert.status === 'read') {
                        statusBadge = '<span class="badge badge-info">Leída</span>';
                    } else if (alert.status === 'resolved') {
                        statusBadge = '<span class="badge badge-success">Resuelta</span>';
                    }

                    tr.innerHTML = `
                <td>${formatDate(alert.date)}</td>
                <td>${getAlertTypeName(alert.type)}</td>
                <td>${alert.description}</td>
                <td>${statusBadge}</td>
                <td>${alert.resolution || '-'}</td>
            `;
                    tbody.appendChild(tr);
                });
            }
        }

        /**
         * Abre el modal para resolver una alerta
         * @param {number} alertId - ID de la alerta
         */
        function openResolveAlertModal(alertId) {
            const alert = alerts.find(a => a.id === alertId);
            if (!alert) {
                showNotification('Alerta no encontrada', 'danger');
                return;
            }

            const modal = document.getElementById('resolveAlertModal');
            if (!modal) return;

            // Resetear formulario
            const form = document.getElementById('resolveAlertForm');
            if (form) form.reset();

            // Establecer datos de la alerta
            document.getElementById('alertId').value = alert.id;
            document.getElementById('alertDescription').textContent = alert.description;

            // Mostrar modal
            modal.classList.add('active');
        }

        /**
         * Configura los eventos del sistema de alertas
         */
        function setupAlertEvents() {
            // Botón para actualizar alertas
            const refreshAlertsBtn = document.getElementById('refreshAlertsBtn');
            if (refreshAlertsBtn) {
                refreshAlertsBtn.addEventListener('click', async function () {
                    toggleLoader(true);
                    try {
                        await generateSystemAlerts();
                        showNotification('Alertas actualizadas correctamente', 'success');
                    } catch (error) {
                        console.error('Error al actualizar alertas:', error);
                        showNotification('Error al actualizar alertas', 'danger');
                    } finally {
                        toggleLoader(false);
                    }
                });
            }

            // Botón para marcar todas como leídas
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', markAllAlertsAsRead);
            }

            // Botones del modal de resolución de alertas
            const confirmResolveAlertBtn = document.getElementById('confirmResolveAlertBtn');
            if (confirmResolveAlertBtn) {
                confirmResolveAlertBtn.addEventListener('click', processAlertResolution);
            }

            const cancelResolveAlertBtn = document.getElementById('cancelResolveAlertBtn');
            if (cancelResolveAlertBtn) {
                cancelResolveAlertBtn.addEventListener('click', function () {
                    document.getElementById('resolveAlertModal').classList.remove('active');
                });
            }

            const closeResolveAlertModal = document.getElementById('closeResolveAlertModal');
            if (closeResolveAlertModal) {
                closeResolveAlertModal.addEventListener('click', function () {
                    document.getElementById('resolveAlertModal').classList.remove('active');
                });
            }

            // Eventos para filtrar por tipo de alerta
            const alertsTabs = document.getElementById('alertsTabs');
            if (alertsTabs) {
                const tabs = alertsTabs.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        const type = this.dataset.type;
                        filterAlertsByType(type);
                    });
                });
            }
        }

        /**
         * Filtra las alertas por tipo
         * @param {string} type - Tipo de alerta a filtrar ('all' para todas)
         */
        function filterAlertsByType(type) {
            const alertsTable = document.getElementById('activeAlertsTable');
            if (!alertsTable) return;

            const rows = alertsTable.querySelectorAll('tbody tr');

            rows.forEach(row => {
                if (type === 'all') {
                    row.style.display = '';
                } else {
                    // Verificar que haya al menos 2 celdas (para evitar errores con filas vacías)
                    if (row.cells && row.cells.length > 1) {
                        const alertType = row.cells[1].textContent.trim();
                        const matchesType = alertType === getAlertTypeName(type);

                        row.style.display = matchesType ? '' : 'none';
                    }
                }
            });
        }

        /**
         * Inicializa el sistema de alertas
         */
        function initializeAlertSystem() {
            // Configurar eventos
            setupAlertEvents();

            // Generar alertas iniciales
            generateSystemAlerts();

            // Configurar temporizador para generar alertas periódicamente
            setInterval(generateSystemAlerts, 300000); // Cada 5 minutos

            console.log('Sistema de alertas inicializado correctamente');
        }

        // Inicializar sistema de alertas cuando se carga la aplicación
        document.addEventListener('DOMContentLoaded', function () {
            const oldInitializeApp = window.initializeApp;
            window.initializeApp = function () {
                // Llamar a la función original
                oldInitializeApp();

                // Inicializar sistema de alertas
                setTimeout(initializeAlertSystem, 1000);
            };
        });

        /**
         * Versión mejorada de la función showNotification para soportar iconos personalizados y títulos
         * @param {string} message - Mensaje a mostrar
         * @param {string} type - Tipo de notificación (success, warning, danger, info)
         * @param {string} icon - Clase de icono (opcional)
         * @param {string} title - Título de la notificación (opcional)
         */
        function showNotification(message, type = 'info', icon = null, title = null) {
            if (!elements.notificationContainer) return;

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;

            // Determinar icono según tipo si no se proporciona
            let iconClass = icon;
            if (!iconClass) {
                if (type === 'success') iconClass = 'fa-check-circle';
                else if (type === 'warning') iconClass = 'fa-exclamation-triangle';
                else if (type === 'danger') iconClass = 'fa-times-circle';
                else iconClass = 'fa-info-circle';
            }

            // Determinar título según tipo si no se proporciona
            let notificationTitle = title;
            if (!notificationTitle) {
                if (type === 'success') notificationTitle = 'Éxito';
                else if (type === 'warning') notificationTitle = 'Advertencia';
                else if (type === 'danger') notificationTitle = 'Error';
                else notificationTitle = 'Información';
            }

            notification.innerHTML = `
        <div class="notification-icon">
            <i class="fas ${iconClass}"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">${notificationTitle}</div>
            <div class="notification-message">${message}</div>
        </div>
        <button class="close-notification">
            <i class="fas fa-times"></i>
        </button>
    `;

            elements.notificationContainer.appendChild(notification);

            // Obtener duración de las notificaciones desde la configuración
            const settings = loadSettings();
            const duration = settings.notifications.notificationDuration || 5000;

            // Auto cerrar después del tiempo configurado
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, duration);

            // Cerrar manualmente
            const closeButton = notification.querySelector('.close-notification');
            closeButton.addEventListener('click', () => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            });
        }

        /**
 * Procesa la descarga de camión
 */
        function initializeTruckUnloadForm() {
            // Obtener referencia al formulario
            const truckUnloadForm = document.getElementById('truckUnloadForm');
            if (!truckUnloadForm) return;

            // Contador para los campos de artículos
            let itemCounter = 1;

            // Añadir evento para el botón de agregar artículo
            const addTruckItemBtn = document.getElementById('addTruckItemBtn');
            if (addTruckItemBtn) {
                addTruckItemBtn.addEventListener('click', function () {
                    itemCounter++;

                    // Crear nuevo campo de artículo
                    const newItemHtml = `
                <div class="form-row">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="item${itemCounter}">Artículo</label>
                            <select id="item${itemCounter}" class="form-control form-select" required>
                                <option value="">Seleccionar artículo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="quantity${itemCounter}">Cantidad</label>
                            <input type="number" id="quantity${itemCounter}" class="form-control" min="1" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="lifeCycle${itemCounter}">Período de Vida</label>
                            <select id="lifeCycle${itemCounter}" class="form-control form-select" required>
                                <option value="daily">Diario</option>
                                <option value="1week">1 Semana</option>
                                <option value="2weeks">2 Semanas</option>
                                <option value="3weeks">3 Semanas</option>
                                <option value="1month">1 Mes</option>
                                <option value="indefinite">Indefinido</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-danger btn-icon remove-item-btn" style="margin-top: 32px;" title="Eliminar fila">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;

                    // Añadir al contenedor
                    const itemsContainer = document.getElementById('truckUnloadItems');
                    if (itemsContainer) {
                        itemsContainer.insertAdjacentHTML('beforeend', newItemHtml);

                        // Añadir evento para eliminar
                        const removeBtn = itemsContainer.querySelector(`.form-row:last-child .remove-item-btn`);
                        if (removeBtn) {
                            removeBtn.addEventListener('click', function () {
                                this.closest('.form-row').remove();
                            });
                        }

                        // Actualizar selector de artículos
                        populateItemSelectors();
                    }
                });
            }

            // Procesar envío del formulario
            truckUnloadForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                toggleLoader(true);

                try {
                    // Recopilar datos del formulario
                    const unloadDate = document.getElementById('truckUnloadDate').value;
                    const reference = document.getElementById('truckUnloadReference').value;
                    const notes = document.getElementById('truckUnloadNotes').value;

                    // Validaciones
                    if (!unloadDate) {
                        throw new Error('La fecha de descarga es obligatoria');
                    }

                    if (!reference) {
                        throw new Error('La referencia es obligatoria');
                    }

                    // Obtener items
                    const items = [];
                    const itemSelectors = document.querySelectorAll('#truckUnloadItems select[id^="item"]');

                    for (let i = 0; i < itemSelectors.length; i++) {
                        const selector = itemSelectors[i];
                        const itemId = parseInt(selector.value);

                        if (!itemId) continue; // Ignorar items no seleccionados

                        // Obtener índice del item
                        const itemIndex = selector.id.replace('item', '');

                        // Obtener cantidad y ciclo de vida
                        const quantityInput = document.getElementById(`quantity${itemIndex}`);
                        const lifeCycleSelect = document.getElementById(`lifeCycle${itemIndex}`);

                        if (!quantityInput || !lifeCycleSelect) continue;

                        const quantity = parseInt(quantityInput.value);
                        const lifeCycle = lifeCycleSelect.value;

                        if (!quantity || quantity <= 0) continue;

                        // Añadir a la lista
                        items.push({
                            item_id: itemId,
                            quantity: quantity,
                            life_cycle: lifeCycle
                        });
                    }

                    if (items.length === 0) {
                        throw new Error('Debe ingresar al menos un artículo');
                    }

                    // Crear transacciones y actualizar inventario
                    for (const item of items) {
                        // Encontrar el artículo en el inventario
                        const inventoryItem = inventory.find(i => i.id === item.item_id);

                        if (inventoryItem) {
                            // Actualizar ciclo de vida si es diferente
                            if (inventoryItem.life_cycle !== item.life_cycle) {
                                // Guardar ciclo de vida original para referencia
                                const originalLifeCycle = inventoryItem.life_cycle;

                                // Actualizar en Supabase
                                if (isOnline && supabase) {
                                    await supabase
                                        .from('superstore_items')
                                        .update({
                                            life_cycle: item.life_cycle,
                                            updated_at: new Date().toISOString()
                                        })
                                        .eq('id', item.item_id);
                                }

                                // Actualizar en memoria
                                inventoryItem.life_cycle = item.life_cycle;
                                inventoryItem.updated_at = new Date().toISOString();

                                // Notificar cambio
                                console.log(`Ciclo de vida actualizado para ${inventoryItem.name}: ${originalLifeCycle} -> ${item.life_cycle}`);
                            }

                            // Crear transacción de ingreso
                            const transactionData = {
                                date: new Date(unloadDate).toISOString(),
                                type: 'in',
                                item_id: item.item_id,
                                quantity: item.quantity,
                                person_id: 1, // Usuario actual o administrador
                                notes: `Descarga de camión. Ref: ${reference}. ${notes || ''}`,
                                created_at: new Date().toISOString()
                            };

                            // Guardar en Supabase
                            if (isOnline && supabase) {
                                const { data, error } = await supabase
                                    .from('superstore_transactions')
                                    .insert([transactionData])
                                    .select();

                                if (error) throw error;

                                // Añadir a la lista en memoria
                                if (data && data.length > 0) {
                                    transactions = [...data, ...transactions];
                                }
                            } else {
                                // Modo offline
                                const newTransaction = {
                                    ...transactionData,
                                    id: generateUniqueId()
                                };

                                transactions.unshift(newTransaction);
                            }

                            // Actualizar stock
                            const newStock = inventoryItem.stock + item.quantity;

                            // Actualizar en Supabase
                            if (isOnline && supabase) {
                                await supabase
                                    .from('superstore_items')
                                    .update({
                                        stock: newStock,
                                        updated_at: new Date().toISOString()
                                    })
                                    .eq('id', item.item_id);
                            }

                            // Actualizar en memoria
                            inventoryItem.stock = newStock;
                            inventoryItem.updated_at = new Date().toISOString();
                        }
                    }

                    // Guardar en localStorage
                    saveDataToLocalStorage();

                    // Actualizar UI
                    renderInventoryTable();
                    renderTransactionsTable();
                    updateDashboard();

                    // Resetear formulario
                    truckUnloadForm.reset();

                    // Mantener solo la primera fila de artículos
                    const itemsContainer = document.getElementById('truckUnloadItems');
                    if (itemsContainer) {
                        const rows = itemsContainer.querySelectorAll('.form-row');
                        for (let i = 1; i < rows.length; i++) {
                            rows[i].remove();
                        }
                    }

                    // Establecer fecha actual
                    const dateInput = document.getElementById('truckUnloadDate');
                    if (dateInput) {
                        const now = new Date();
                        dateInput.value = now.toISOString().slice(0, 16);
                    }

                    showNotification('Descarga de camión registrada correctamente', 'success');
                } catch (error) {
                    console.error('Error al registrar descarga de camión:', error);
                    showNotification(`Error: ${error.message || 'Error al registrar la descarga'}`, 'danger');
                } finally {
                    toggleLoader(false);
                }
            });

            // Establecer fecha actual al cargar
            const dateInput = document.getElementById('truckUnloadDate');
            if (dateInput) {
                const now = new Date();
                dateInput.value = now.toISOString().slice(0, 16);
            }

            // Inicializar selectores
            populateItemSelectors();

            console.log('Formulario de descarga de camión inicializado');
        }

        // Llamar a esta función cuando la página esté lista
        document.addEventListener('DOMContentLoaded', function () {
            const oldInitializeEvents = window.initializeEvents;
            window.initializeEvents = function () {
                // Llamar a la función original
                oldInitializeEvents();

                // Inicializar formulario de descarga
                initializeTruckUnloadForm();
            };
        });

        /**
 * Abre el modal para editar un miembro del personal
 * @param {number} staffId - ID del personal a editar
 */
function editStaff(staffId) {
    // Reutilizar la función de abrir modal para nuevo personal, pasando el ID
    openNewStaffModal(staffId);
}
    </script>

</body>

</html>
